<?xml version="1.0" encoding="utf-8" ?>
<Sqls>
	<Sql>
		<key>GetTransmisionProyecto</key>
		<query>
			SELECT
			TR.PROYCODI,
			TR.PERICODI,
			TR.PLANCODI,
			TR.TIPOCODI,
			TR.EMPRESACODI,
			TR.EMPRESANOM,
			TR.PROYNOMBRE,
			TR.PROYDESCRIPCION,
			TR.PROYCONFIDENCIAL,
			TR.USU_CREACION,
			TR.FEC_CREACION,
			TR.IND_DEL,
			TR.TIPOFICODI,
			TR.AREADEMANDA,
			TR.PROYESTADO,
			TI.TIPONOMBRE,
			TF.TIPOFINOMBRE
			FROM CAM_TRNSMPROYECTO TR INNER JOIN CAM_TIPOPROYECTO TI ON TR.TIPOCODI = TI.TIPOCODI LEFT JOIN CAM_TIPOFICHAPROYECTO TF ON TR.TIPOFICODI = TF.TIPOFICODI WHERE TR.IND_DEL = :IND_DEL AND TR.PLANCODI = :PLANCODI  ORDER BY PROYCODI ASC
		</query>
	</Sql>
	
	
	<Sql>
		<key>SaveTransmisionProyecto</key>
		<query>
			INSERT INTO CAM_TRNSMPROYECTO (
			PROYCODI,
			PERICODI,
			TIPOCODI,
			PLANCODI,
			EMPRESACODI,
			EMPRESANOM,
			PROYNOMBRE,
			PROYDESCRIPCION,
			PROYCONFIDENCIAL,
			USU_CREACION,
			FEC_CREACION,
			IND_DEL,
			TIPOFICODI,
			AREADEMANDA,
			PROYESTADO
			) VALUES (
			:PROYCODI,
			:PERICODI,
			:TIPOCODI,
			:PLANCODI,
			:EMPRESACODI,
			:EMPRESANOM,
			:PROYNOMBRE,
			:PROYDESCRIPCION,
			:PROYCONFIDENCIAL,
			:USU_CREACION,
			:FEC_CREACION,
			:IND_DEL,
			:TIPOFICODI,
			:AREADEMANDA,
			:PROYESTADO
			)
		</query>
	</Sql>

	<Sql>
		<key>UpdateTransmisionProyecto</key>
		<query>
			UPDATE CAM_TRNSMPROYECTO
			SET
			PERICODI = :PERICODI,
			TIPOCODI = :TIPOCODI,
			PLANCODI = :PLANCODI,
			EMPRESACODI = :EMPRESACODI,
			EMPRESANOM = :EMPRESANOM,
			PROYNOMBRE = :PROYNOMBRE,
			PROYDESCRIPCION = :PROYDESCRIPCION,
			PROYCONFIDENCIAL = :PROYCONFIDENCIAL,
			USU_MODIFICACION = :USU_MODIFICACION,
			FEC_MODIFICACION = :FEC_MODIFICACION,
			TIPOFICODI = :TIPOFICODI,
			AREADEMANDA = :AREADEMANDA
			PROYESTADO = :PROYESTADO
			WHERE
			PROYCODI = :PROYCODI
		</query>
	</Sql>

	<Sql>
		<key>GetLastTransmisionProyectoId</key>
		<query>
			SELECT * FROM CAM_TRNSMPROYECTO
			ORDER BY PROYCODI DESC
			FETCH FIRST 1 ROWS ONLY
		</query>
	</Sql>


	<Sql>
		<key>DeleteTransmisionProyectoById</key>
		<query>
			UPDATE CAM_TRNSMPROYECTO SET IND_DEL = :IND_DEL,  USU_MODIFICACION = :USU_MODIFICACION, FEC_MODIFICACION = :FEC_MODIFICACION WHERE PROYCODI = :ID
		</query>
	</Sql>

	<Sql>
		<key>GetTransmisionProyectoById</key>
		<query>
			SELECT P.*, PT.CORREOUSU,PER.PERINOMBRE
			FROM CAM_TRNSMPROYECTO P
			INNER JOIN CAM_PERIODO PER ON P.PERICODI=PER.PERICODI
			INNER JOIN CAM_PLANTRANSMISION PT ON P.PLANCODI = PT.PLANCODI
			WHERE PROYCODI = :ID AND P.IND_DEL = :IND_DEL
		</query>
	</Sql>

	<Sql>
		<key>GetTransmisionProyectoByPeriodo</key>
		<query>
			SELECT * FROM CAM_TRNSMPROYECTO WHERE PERICODI = :PERICODI AND IND_DEL = :IND_DEL
		</query>
	</Sql>

	<Sql>
		<key>UpdateProyEstadoById</key>
		<query>
			UPDATE CAM_TRNSMPROYECTO 
			SET PROYESTADO = :PROYESTADO
			WHERE PLANCODI = :ID AND IND_DEL = :IND_DEL
		</query>
	</Sql>

	<Sql>
		<key>UpdateProyEstadoByIdProy</key>
		<query>
			UPDATE CAM_TRNSMPROYECTO
			SET PROYESTADO = CASE
								WHEN EXISTS (
									SELECT 1
									FROM CAM_OBSERVACIONES O
									WHERE O.PROYCODI = :IDP
									AND O.IND_DEL = :IND_DELP
								) THEN :PROYESTADO
								ELSE :PROYESTADOINI
							END
			WHERE PROYCODI = :ID
			AND IND_DEL = :IND_DEL

		</query>
	</Sql>

	<Sql>
		<key>UpdateProyFechaEnvioObsById</key>
		<query>
			UPDATE CAM_TRNSMPROYECTO 
			SET FECHAENVIOOBS = :FECHAENVIOOBS
			WHERE PROYCODI = :ID AND IND_DEL = :IND_DEL
		</query>
	</Sql>
</Sqls>
