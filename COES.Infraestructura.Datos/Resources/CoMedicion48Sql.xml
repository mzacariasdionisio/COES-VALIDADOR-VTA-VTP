<?xml version="1.0" encoding="utf-8" ?>
<Sqls>

  <Sql>
    <key>GetMaxId</key>
    <query>
      select nvl(max(comedcodi), 0) + 1 from co_medicion48
    </query>
  </Sql>

  <Sql>
    <key>Save</key>
    <query>
      insert into co_medicion48(
      comedcodi,
      cotinfcodi,
      grupocodi,
      copercodi,
      covercodi,
      comedfecha,
      h1,
      h2,
      h3,
      h4,
      h5,
      h6,
      h7,
      h8,
      h9,
      h10,
      h11,
      h12,
      h13,
      h14,
      h15,
      h16,
      h17,
      h18,
      h19,
      h20,
      h21,
      h22,
      h23,
      h24,
      h25,
      h26,
      h27,
      h28,
      h29,
      h30,
      h31,
      h32,
      h33,
      h34,
      h35,
      h36,
      h37,
      h38,
      h39,
      h40,
      h41,
      h42,
      h43,
      h44,
      h45,
      h46,
      h47,
      h48
      )
      values(
      :comedcodi,
      :cotinfcodi,
      :grupocodi,
      :copercodi,
      :covercodi,
      :comedfecha,
      :h1,
      :h2,
      :h3,
      :h4,
      :h5,
      :h6,
      :h7,
      :h8,
      :h9,
      :h10,
      :h11,
      :h12,
      :h13,
      :h14,
      :h15,
      :h16,
      :h17,
      :h18,
      :h19,
      :h20,
      :h21,
      :h22,
      :h23,
      :h24,
      :h25,
      :h26,
      :h27,
      :h28,
      :h29,
      :h30,
      :h31,
      :h32,
      :h33,
      :h34,
      :h35,
      :h36,
      :h37,
      :h38,
      :h39,
      :h40,
      :h41,
      :h42,
      :h43,
      :h44,
      :h45,
      :h46,
      :h47,
      :h48
      )
    </query>
  </Sql>

  <Sql>
    <key>Update</key>
    <query>
      update co_medicion48
      set
      cotinfcodi = :cotinfcodi,
      grupocodi = :grupocodi,
      copercodi = :copercodi,
      covercodi = :covercodi,
      comedfecha = :comedfecha,
      h1 = :h1,
      h2 = :h2,
      h3 = :h3,
      h4 = :h4,
      h5 = :h5,
      h6 = :h6,
      h7 = :h7,
      h8 = :h8,
      h9 = :h9,
      h10 = :h10,
      h11 = :h11,
      h12 = :h12,
      h13 = :h13,
      h14 = :h14,
      h15 = :h15,
      h16 = :h16,
      h17 = :h17,
      h18 = :h18,
      h19 = :h19,
      h20 = :h20,
      h21 = :h21,
      h22 = :h22,
      h23 = :h23,
      h24 = :h24,
      h25 = :h25,
      h26 = :h26,
      h27 = :h27,
      h28 = :h28,
      h29 = :h29,
      h30 = :h30,
      h31 = :h31,
      h32 = :h32,
      h33 = :h33,
      h34 = :h34,
      h35 = :h35,
      h36 = :h36,
      h37 = :h37,
      h38 = :h38,
      h39 = :h39,
      h40 = :h40,
      h41 = :h41,
      h42 = :h42,
      h43 = :h43,
      h44 = :h44,
      h45 = :h45,
      h46 = :h46,
      h47 = :h47,
      h48 = :h48
      where
      comedcodi = :comedcodi
    </query>
  </Sql>

  <Sql>
    <key>Delete</key>
    <query>
      delete from co_medicion48
      where
      copercodi = {0} and
      covercodi = {1} and
      cotinfcodi = {2} and
      (comedfecha >= to_date('{3}', 'YYYY-MM-DD') and comedfecha &lt;= to_date('{4}', 'YYYY-MM-DD'))
    </query>
  </Sql>

  <Sql>
    <key>GetById</key>
    <query>
      select
      comedcodi,
      cotinfcodi,
      grupocodi,
      copercodi,
      covercodi,
      comedfecha,
      h1,
      h2,
      h3,
      h4,
      h5,
      h6,
      h7,
      h8,
      h9,
      h10,
      h11,
      h12,
      h13,
      h14,
      h15,
      h16,
      h17,
      h18,
      h19,
      h20,
      h21,
      h22,
      h23,
      h24,
      h25,
      h26,
      h27,
      h28,
      h29,
      h30,
      h31,
      h32,
      h33,
      h34,
      h35,
      h36,
      h37,
      h38,
      h39,
      h40,
      h41,
      h42,
      h43,
      h44,
      h45,
      h46,
      h47,
      h48
      from
      co_medicion48
      where
      comedcodi = :comedcodi
    </query>
  </Sql>

  <Sql>
    <key>List</key>
    <query>
      select
      comedcodi,
      cotinfcodi,
      grupocodi,
      copercodi,
      covercodi,
      comedfecha,
      h1,
      h2,
      h3,
      h4,
      h5,
      h6,
      h7,
      h8,
      h9,
      h10,
      h11,
      h12,
      h13,
      h14,
      h15,
      h16,
      h17,
      h18,
      h19,
      h20,
      h21,
      h22,
      h23,
      h24,
      h25,
      h26,
      h27,
      h28,
      h29,
      h30,
      h31,
      h32,
      h33,
      h34,
      h35,
      h36,
      h37,
      h38,
      h39,
      h40,
      h41,
      h42,
      h43,
      h44,
      h45,
      h46,
      h47,
      h48
      from
      co_medicion48
    </query>
  </Sql>

  <Sql>
    <key>GetByCriteria</key>
    <query>
      select
      comedcodi,
      cotinfcodi,
      grupocodi,
      copercodi,
      covercodi,
      comedfecha,
      h1,
      h2,
      h3,
      h4,
      h5,
      h6,
      h7,
      h8,
      h9,
      h10,
      h11,
      h12,
      h13,
      h14,
      h15,
      h16,
      h17,
      h18,
      h19,
      h20,
      h21,
      h22,
      h23,
      h24,
      h25,
      h26,
      h27,
      h28,
      h29,
      h30,
      h31,
      h32,
      h33,
      h34,
      h35,
      h36,
      h37,
      h38,
      h39,
      h40,
      h41,
      h42,
      h43,
      h44,
      h45,
      h46,
      h47,
      h48
      from
      co_medicion48
    </query>
  </Sql>

  <Sql>
    <key>ObtenerTopologias</key>
    <query>
      select topcodi1, topcodi, topfecha, topfinal, tophorareprog as topiniciohora from (
      select top.topcodi as topcodi1, top.* from cp_topologia top where top.topfinal = 1 and top.toptipo = 1 and top.topsinrsf &lt;= 0 and
      (top.topfecha >= to_date('{0}','YYYY-MM-DD') and top.topfecha &lt;= to_date('{1}','YYYY-MM-DD'))
      union all
      select reprog.topcodi1, top.* from
      (select topcodi1, topcodi2 from cp_reprograma where topcodi1 in (
      select topcodi from cp_topologia where topfinal = 1 and toptipo = 1 and topsinrsf &lt;=0 and
      (topfecha >= to_date('{0}','YYYY-MM-DD') and topfecha &lt;= to_date('{1}','YYYY-MM-DD'))
      )) reprog inner join cp_topologia top on reprog.topcodi2 = top.topcodi)
    </query>
  </Sql>

  <Sql>
    <key>ObtenerReporteReprograma</key>
    <query>

		select topfecha, topcodi, topnombre, 0 as topiniciohora from (
		select top.topcodi as topcodi1, top.* from cp_topologia top where top.topfinal = 1 and top.toptipo = 1 and top.topsinrsf &lt;= 0 and
		(top.topfecha >= to_date('{0}','YYYY-MM-DD') and top.topfecha &lt;= to_date('{1}','YYYY-MM-DD')))
		union all

		select topfecha, topcodi, topnombre, tophorareprog as topiniciohora from (
		select reprog.topcodi1, top.* from
		(select topcodi1, topcodi2 from cp_reprograma where topcodi1 in (
		select topcodi from cp_topologia where topfinal = 1 and toptipo = 1 and topsinrsf &lt;=0 and
      (topfecha >= to_date('{0}','YYYY-MM-DD') and topfecha &lt;= to_date('{1}','YYYY-MM-DD'))
      )) reprog inner join cp_topologia top on reprog.topcodi2 = top.topcodi)
      order by 1 asc, 2 asc
    </query>
  </Sql>

  <Sql>
    <key>ObtenerReporteReprogramaSinRSF</key>
    <query>
		select topcodi, topfecha, 0 as topiniciohora, topnombre from (
		select top.topcodi as topcodi1, top.* from cp_topologia top where top.topfinal = 1 and top.toptipo = 1
		and top.topsinrsf in (
		select top1.topcodi from cp_topologia top1 where top1.topfinal = 1 and top1.toptipo = 1 and top1.topsinrsf &lt;= 0 and
		(top.topfecha >= to_date('{0}','YYYY-MM-DD') and top.topfecha &lt;= to_date('{1}','YYYY-MM-DD'))
		)
		)
		union all
		select  topcodi, topfecha, tophorareprog as topiniciohora, topnombre from
		(
		select
		(select reprog.topcodi1 from cp_reprograma reprog where reprog.topcodi2 = topsinrsf.topsinrsf) as topcodi1,
		topsinrsf.topcodi, topsinrsf.topfecha, 0 as  topfinal, topsinrsf.tophorareprog,
		topsinrsf.topnombre
		from cp_topologia topsinrsf where topsinrsf.toptipo = 3 and
		topsinrsf.topfinal = 1 and topsinrsf.topsinrsf in (
		select  topcodi2 from cp_reprograma where topcodi1 in (
		select topcodi from cp_topologia where topfinal = 1 and toptipo = 1 and topsinrsf &lt;=0 and
      (topfecha >= to_date('{0}','YYYY-MM-DD') and topfecha &lt;= to_date('{1}','YYYY-MM-DD'))
      )) and
      (topsinrsf.topfecha >= to_date('{0}','YYYY-MM-DD') and topsinrsf.topfecha &lt;= to_date('{1}','YYYY-MM-DD'))
      )
    </query>
  </Sql>

  <Sql>
    <key>ObtenerTopologiasSinReserva</key>
    <query>
      select topcodi1, topcodi, topfecha, topfinal, tophorareprog as topiniciohora from
      (
      select topsinrsf.topsinrsf as topcodi1,
      topsinrsf.topcodi, topsinrsf.topfecha, topsinrsf.topfinal, topconrsf.tophorareprog
      from cp_topologia topsinrsf
      inner join cp_topologia topconrsf on topsinrsf.topsinrsf = topconrsf.topcodi
      where topsinrsf.toptipo = 1 and topsinrsf.topfinal = 1 and topsinrsf.topsinrsf in (
      select top.topcodi from cp_topologia top where top.topfinal = 1 and top.toptipo = 1 and top.topsinrsf &lt;=0 and
      (top.topfecha >= to_date('{0}','YYYY-MM-DD') and top.topfecha &lt;= to_date('{1}','YYYY-MM-DD'))) and
      (topsinrsf.topfecha >= to_date('{0}','YYYY-MM-DD') and topsinrsf.topfecha &lt;= to_date('{1}','YYYY-MM-DD'))
      union all
      select
      (select reprog.topcodi1 from cp_reprograma reprog where reprog.topcodi2 = topsinrsf.topsinrsf) as topcodi1,
      topsinrsf.topcodi, topsinrsf.topfecha, 0 as  topfinal, topconrsf.tophorareprog
      from cp_topologia topsinrsf
      inner join cp_topologia topconrsf on topsinrsf.topsinrsf = topconrsf.topcodi
      where topsinrsf.toptipo = 3 and
      topsinrsf.topfinal = 1 and topsinrsf.topsinrsf in (
      select  topcodi2 from cp_reprograma where topcodi1 in (
      select topcodi from cp_topologia where topfinal = 1 and toptipo = 1 and topsinrsf &lt;=0 and
      (topfecha >= to_date('{0}','YYYY-MM-DD') and topfecha &lt;= to_date('{1}','YYYY-MM-DD'))
      )) and
      (topsinrsf.topfecha >= to_date('{0}','YYYY-MM-DD') and topsinrsf.topfecha &lt;= to_date('{1}','YYYY-MM-DD'))
      )
    </query>
  </Sql>

  <Sql>
    <key>ObtenerDatosYupana</key>
    <query>
      select distinct urs.grupocodi as recurcodisicoes, urs.grupocodi, cent.gruponomb as recurnombre, urs.gruponomb,
      m48.*  from cp_medicion48 m48
      inner join cp_recurso re on re.recurcodi = m48.recurcodi and re.topcodi in({1}) and re.recurestado=1
      inner join pr_grupo urs on urs.grupocodi = re.recurcodisicoes
      inner join pr_grupo mo on mo.grupourspadre = urs.grupocodi
      inner join pr_grupo gr on mo.grupopadre = gr.grupocodi
      inner join pr_grupo cent on gr.grupopadre = cent.grupocodi
      where m48.medifecha = TO_DATE('{0}', 'YYYY-MM-DD') and m48.topcodi in ({1}) and m48.srestcodi in({2})
      and cent.grupoactivo = 'S'
      order by 1
    </query>
  </Sql>

  <Sql>
    <key>ObtenerDatosYupanaAgrupado</key>
    <query>
      select
      famcodi, srestcodi, topcodi, recurso as recurcodisicoes, medifecha,
      case famcodi
      when 1 then (select eq.equinomb from eq_equipo eq where eq.equicodi = recurso)
      when 2 then (select pr.gruponomb from pr_grupo pr where pr.grupocodi = recurso) else '' end as recurnombre,
      sum(h1) as h1, sum(h2) as h2, sum(h3) as h3, sum(h4) as h4,
      sum(h5) as h5, sum(h6) as h6, sum(h7) as h7, sum(h8) as h8,
      sum(h9) as h9, sum(h10) as h10, sum(h11) as h11, sum(h12) as h12,
      sum(h13) as h13, sum(h14) as h14, sum(h15) as h15, sum(h16) as h16,
      sum(h17) as h17, sum(h18) as h18, sum(h19) as h19, sum(h20) as h20,
      sum(h21) as h21, sum(h22) as h22, sum(h23) as h23, sum(h24) as h24,
      sum(h25) as h25, sum(h26) as h26, sum(h27) as h27, sum(h28) as h28,
      sum(h29) as h29, sum(h30) as h30, sum(h31) as h31, sum(h32) as h32,
      sum(h33) as h33, sum(h34) as h34, sum(h35) as h35, sum(h36) as h36,
      sum(h37) as h37, sum(h38) as h38, sum(h39) as h39, sum(h40) as h40,
      sum(h41) as h41, sum(h42) as h42, sum(h43) as h43, sum(h44) as h44,
      sum(h45) as h45, sum(h46) as h46, sum(h47) as h47, sum(h48) as h48
      from
      (select distinct
      case re.tablasicoes when 'EQ_EQUIPO' then 1 when 'PR_GRUPO' then 2 when 'Prgrupo' then 2 else 0 end as famcodi,
      case re.tablasicoes
      when 'EQ_EQUIPO' then (select case eq.famcodi when 4 then eq.equicodi when 2 then eq.equipadre else 0 end as equicodi
      from eq_equipo eq where eq.equicodi = re.recurcodisicoes)
      when 'Prgrupo' then (select cent.grupocodi from pr_grupo padre inner join pr_grupo cent on padre.grupopadre = cent.grupocodi
      inner join pr_grupo modo on modo.grupopadre = padre.grupocodi where modo.grupocodi =  re.recurcodisicoes)
      when 'PR_GRUPO' then (select cent.grupocodi from pr_grupo padre inner join pr_grupo cent on padre.grupopadre = cent.grupocodi
      inner join pr_grupo modo on modo.grupopadre = padre.grupocodi where modo.grupocodi =  re.recurcodisicoes) else 0 end as recurso,
      m48.*
      from cp_medicion48 m48
      inner join cp_recurso re on re.recurcodi=m48.recurcodi and re.topcodi in({1}) and re.recurestado=1 and re.recurcodisicoes > 0 
      where m48.medifecha=TO_DATE('{0}', 'YYYY-MM-DD') and m48.topcodi in({1}) and m48.srestcodi in({2})
      ) tabla
      group by  tabla.famcodi, tabla.srestcodi, tabla.topcodi, tabla.recurso, tabla.medifecha
      order by 4 asc
    </query>
  </Sql>

  <Sql>
    <key>ObtenerDatosRAEjecutado</key>
    <query>
      select distinct tabla.*, urs.gruponomb as ursnomb, cent.gruponomb as gruponomb--,
      --case cent.grupotipo when 'T' then cent.grupocodi when 'H' then  (select eq.equicodi from eq_equipo eq where eq.grupocodi = cent.grupocodi) else 0 end as equicodi,
      --case cent.grupotipo when 'T' then 2 when 'H' then  1 else 0 end as famcodi
      from (
      select  hora.rsfhorfecha, hora.rsfhorinicio, hora.rsfhorfin, detalle.grupocodi,
      sum(detalle.rsfdetsub) as rsfdetsub, sum(detalle.rsfdetbaj) as rsfdetbaj  from eve_rsfdetalle detalle
      inner join eve_rsfhora hora on detalle.rsfhorcodi = hora.rsfhorcodi
      where hora.rsfhorfecha >= to_date('{0}','YYYY-MM-DD') and hora.rsfhorfecha &lt;= to_date('{1}','YYYY-MM-DD')
      and detalle.equicodi not in (
      select  (select equicodi from eq_equipo where grupocodi = gp2.grupocodi)
      from pr_grupo urs
      inner join pr_grupo mo on mo.grupourspadre=urs.grupocodi
      inner join pr_grupo gp on mo.grupopadre = gp.grupocodi
      inner join pr_grupo gp2 on gp.grupopadre = gp2.grupocodi
      where urs.catecodi=12 and mo.grupoactivo='S' and mo.catecodi in (2,9) and urs.grupocodi != 1916
      )
      group by hora.rsfhorfecha, hora.rsfhorinicio, hora.rsfhorfin, detalle.grupocodi) tabla
      inner join pr_grupo urs on tabla.grupocodi = urs.grupocodi
      inner join pr_grupo mo on mo.grupourspadre = urs.grupocodi
      inner join pr_grupo gr on mo.grupopadre = gr.grupocodi
      inner join pr_grupo cent on gr.grupopadre = cent.grupocodi
      where cent.grupoactivo = 'S' and urs.catecodi=12 and mo.grupoactivo='S' and mo.catecodi in (2,9) and urs.grupocodi != 1916
      order by 1, 2, 4 asc
    </query>
  </Sql>

  <Sql>
    <key>ObtenerDatosProgramaFinal</key>
    <query>
      select med.*,
      case med.comedtipo
      when 1 then (select eq.equinomb from eq_equipo eq where eq.equicodi = med.equicodi)
      when 2 then (select gr.gruponomb from pr_grupo gr where gr.grupocodi = med.grupocodi)
      else '' end gruponomb
      from co_medicion48 med
      where med.covercodi = {0} and med.cotinfcodi = {1} and (comedfecha >= to_date('{2}', 'YYYY-MM-DD') and comedfecha &lt;= to_date('{3}', 'YYYY-MM-DD') )
    </query>
  </Sql>

  <Sql>
    <key>ObtenerDatosResultadoFinal</key>
    <query>
      select distinct tabla.*,
      case tabla.famcodi
      when 1 then (select eq.equinomb from eq_equipo eq where eq.equicodi = tabla.equicodi1)
      when 2 then (select gr.gruponomb from pr_grupo gr where gr.grupocodi = tabla.equicodi1)
      else '' end gruponomb
      from (
      select med.*,
      case cent.grupotipo when 'T' then cent.grupocodi when 'H' then  (select eq.equicodi from eq_equipo eq where eq.grupocodi = cent.grupocodi) else 0 end as equicodi1,
      case cent.grupotipo when 'T' then 2 when 'H' then  1 else 0 end as famcodi,
      urs.gruponomb as ursnomb
      from co_medicion48 med
      inner join pr_grupo urs on med.grupocodi = urs.grupocodi
      inner join pr_grupo mo on mo.grupourspadre = urs.grupocodi
      inner join pr_grupo gr on mo.grupopadre = gr.grupocodi
      inner join pr_grupo cent on gr.grupopadre = cent.grupocodi
      where med.covercodi = {0} and med.cotinfcodi = {1} and
      cent.grupoactivo = 'S' and urs.catecodi=12 and mo.grupoactivo='S' and mo.catecodi in (2,9) and urs.grupocodi != 1916
      ) tabla
    </query>
  </Sql>

  <Sql>
    <key>ObtenerDatosReservaFinal</key>
    <query>
      select distinct tabla.*,
      case tabla.famcodi
      when 1 then (select eq.equinomb from eq_equipo eq where eq.equicodi = tabla.equicodi1)
      when 2 then (select gr.gruponomb from pr_grupo gr where gr.grupocodi = tabla.equicodi1)
      else '' end gruponomb
      from (
      select med.*,
      case cent.grupotipo when 'T' then cent.grupocodi when 'H' then  (select eq.equicodi from eq_equipo eq where eq.grupocodi = cent.grupocodi) else 0 end as equicodi1,
      case cent.grupotipo when 'T' then 2 when 'H' then  1 else 0 end as famcodi,
      urs.gruponomb as ursnomb
      from co_medicion48 med
      inner join pr_grupo urs on med.grupocodi = urs.grupocodi
      inner join pr_grupo mo on mo.grupourspadre = urs.grupocodi
      inner join pr_grupo gr on mo.grupopadre = gr.grupocodi
      inner join pr_grupo cent on gr.grupopadre = cent.grupocodi
      where med.covercodi = {0} and med.cotinfcodi = {1} and
      ( comedfecha >= to_date('{2}', 'YYYY-MM-DD') and comedfecha &lt;= to_date('{3}', 'YYYY-MM-DD')  ) and
      cent.grupoactivo = 'S' and urs.catecodi=12 and mo.grupoactivo='S' and mo.catecodi in (2,9) and urs.grupocodi != 1916
      ) tabla
    </query>
  </Sql>

  <Sql>
    <key>ObtenerListadoURS</key>
    <query>
      select 
	  distinct
	  tabla.*,
      case tabla.famcodi
      when 1 then (select eq.equinomb from eq_equipo eq where eq.equicodi = tabla.equicodi1)
      when 2 then (select gr.gruponomb from pr_grupo gr where gr.grupocodi = tabla.equicodi1)
      else '' end gruponomb
      from (
      select
      urs.grupocodi,
      case cent.grupotipo when 'T' then cent.grupocodi when 'H' then  (select eq.equicodi from eq_equipo eq where eq.grupocodi = cent.grupocodi) else 0 end as equicodi1,
      case cent.grupotipo when 'T' then 2 when 'H' then  1 else 0 end as famcodi,
      urs.gruponomb as ursnomb
      from  pr_grupo urs
      inner join pr_grupo mo on mo.grupourspadre = urs.grupocodi
      inner join pr_grupo gr on mo.grupopadre = gr.grupocodi
      inner join pr_grupo cent on gr.grupopadre = cent.grupocodi
      where
      cent.grupoactivo = 'S' and urs.catecodi=12 and mo.grupoactivo='S' and mo.catecodi in (2,9) and urs.grupocodi != 1916
      ) tabla
      
    </query>
  </Sql>

  <Sql>
    <key>ObtenerPropiedadHidraulica</key>
    <query>
      select topcodi, equicodi, min(pmin) as pmin, sum(pmax) as pmax from (
      select
      topcodi,
      equicodi,
      recurcodi,
      to_number(FN_SDATOACTUALRECURSO(tabla.recurcodi, 84, tabla.topcodi)) as pmin,
      to_number(FN_SDATOACTUALRECURSO(tabla.recurcodi, 85, tabla.topcodi)) as pmax--,
      --(select to_number(prop.valor) from cp_proprecurso prop where prop.recurcodi = tabla.recurcodi and prop.propcodi = 84 and prop.topcodi = tabla.topcodi and rownum = 1) as pmin,
      --(select to_number(prop.valor) from cp_proprecurso prop where prop.recurcodi = tabla.recurcodi and prop.propcodi = 85 and prop.topcodi = tabla.topcodi and rownum = 1) as pmax
      from (
      select
      top.topcodi,
      rec.recurcodi,
      rec.recurcodisicoes,
      rec.recurconsideragams,
      case rec.recurfamsic when 1 then eq.equicodi when 2 then eq.equipadre else 0 end as equicodi
      from cp_recurso rec
      inner join eq_equipo eq on rec.recurcodisicoes = eq.equicodi
      inner join cp_topologia top on rec.topcodi = top.topcodi
      where
      top.topfinal = 1 and top.toptipo = 1 and topsinrsf &lt;=0 and
      (top.topfecha >= to_date('{0}','YYYY-MM-DD') and top.topfecha &lt;= to_date('{1}','YYYY-MM-DD'))
      and rec.tablasicoes = 'EQ_EQUIPO' and rec.recurestado = 1) tabla
      where tabla.equicodi in (
      select
      eq.equicodi
      from  pr_grupo urs
      inner join pr_grupo mo on mo.grupourspadre = urs.grupocodi
      inner join pr_grupo gr on mo.grupopadre = gr.grupocodi
      inner join pr_grupo cent on gr.grupopadre = cent.grupocodi
      inner join eq_equipo eq on eq.grupocodi = cent.grupocodi
      where
      cent.grupoactivo = 'S' and urs.catecodi=12 and mo.grupoactivo='S' and mo.catecodi in (2,9) and urs.grupocodi != 1916
      and cent.grupotipo = 'H'
      )
      and tabla.recurconsideragams = 1)
      group by topcodi, equicodi
    </query>
  </Sql>

  <Sql>
    <key>ObtenerReporteBandas</key>
    <query>
      select topfecha, topcodi, equicodi, 0 grupocodi, equinomb as gruponomb, min(pmin) as pmin, sum(pmax) as pmax from (
      select
      topfecha,
      topcodi,
      equicodi,
      equinomb,
      recurcodi,
      to_number(FN_SDATOACTUALRECURSO(tabla.recurcodi, 84, tabla.topcodi)) as pmin,
      to_number(FN_SDATOACTUALRECURSO(tabla.recurcodi, 85, tabla.topcodi)) as pmax
      --(select to_number(prop.valor) from cp_proprecurso prop where prop.recurcodi = tabla.recurcodi and prop.propcodi = 84 and prop.topcodi = tabla.topcodi and rownum = 1) as pmin,
      --(select to_number(prop.valor) from cp_proprecurso prop where prop.recurcodi = tabla.recurcodi and prop.propcodi = 85 and prop.topcodi = tabla.topcodi and rownum = 1) as pmax
      from (
      select
      top.topfecha,
      top.topcodi,
      rec.recurcodi,
      rec.recurcodisicoes,
      rec.recurconsideragams,
      eq.equinomb,
      case rec.recurfamsic when 1 then eq.equicodi when 2 then eq.equipadre else 0 end as equicodi
      from cp_recurso rec
      inner join eq_equipo eq on rec.recurcodisicoes = eq.equicodi
      inner join cp_topologia top on rec.topcodi = top.topcodi
      where
      top.topfinal = 1 and top.toptipo = 1 and topsinrsf &lt;=0 and
      (top.topfecha >= to_date('{0}','YYYY-MM-DD') and top.topfecha &lt;= to_date('{1}','YYYY-MM-DD'))
      and rec.tablasicoes = 'EQ_EQUIPO' and rec.recurestado = 1) tabla
      where tabla.equicodi in (
      select
      eq.equicodi
      from  pr_grupo urs
      inner join pr_grupo mo on mo.grupourspadre = urs.grupocodi
      inner join pr_grupo gr on mo.grupopadre = gr.grupocodi
      inner join pr_grupo cent on gr.grupopadre = cent.grupocodi
      inner join eq_equipo eq on eq.grupocodi = cent.grupocodi
      where
      cent.grupoactivo = 'S' and urs.catecodi=12 and mo.grupoactivo='S' and mo.catecodi in (2,9) and urs.grupocodi != 1916
      and cent.grupotipo = 'H'
      )
      and tabla.recurconsideragams = 1)
      group by topfecha, topcodi, equicodi, equinomb
      union
      select
      top.topfecha,
      top.topcodi,
      cent.grupocodi as equicodi,
      mo.grupocodi,
      cent.gruponomb,
      to_number(FN_SDATOACTUALRECURSO(rec.recurcodi, 61, top.topcodi)) as pmin,
      to_number(FN_SDATOACTUALRECURSO(rec.recurcodi, 64, top.topcodi)) as pmax--,
      --(select to_number(prop.valor) from cp_proprecurso prop where prop.recurcodi = rec.recurcodi and prop.propcodi = 61 and prop.topcodi = top.topcodi and rownum = 1) as pmin,
      --(select to_number(prop.valor) from cp_proprecurso prop where prop.recurcodi = rec.recurcodi and prop.propcodi = 64 and prop.topcodi = top.topcodi and rownum = 1) as pmax
      from  pr_grupo urs
      inner join pr_grupo mo on mo.grupourspadre = urs.grupocodi
      inner join pr_grupo gr on mo.grupopadre = gr.grupocodi
      inner join pr_grupo cent on gr.grupopadre = cent.grupocodi
      inner join cp_recurso rec on mo.grupocodi = rec.recurcodisicoes
      inner join cp_topologia top on rec.topcodi = top.topcodi
      where
      cent.grupoactivo = 'S' and urs.catecodi=12 and mo.grupoactivo='S' and mo.catecodi in (2,9) and urs.grupocodi != 1916
      and cent.grupotipo = 'T' and
      (rec.tablasicoes = 'PR_GRUPO' or rec.tablasicoes = 'Prgrupo') and rec.recurestado = 1 and
      top.topfinal = 1 and top.toptipo = 1 and topsinrsf &lt;=0 and
      (top.topfecha >= to_date('{0}','YYYY-MM-DD') and top.topfecha &lt;= to_date('{1}','YYYY-MM-DD'))
      order by 1, 5
    </query>
  </Sql>

  <Sql>
    <key>ObtenerPropiedadTermica</key>
    <query>
      select
      top.topcodi,
      cent.grupocodi as equicodi,
      mo.grupocodi,
      to_number(FN_SDATOACTUALRECURSO(rec.recurcodi, 61, top.topcodi)) as pmin,
      to_number(FN_SDATOACTUALRECURSO(rec.recurcodi, 64, top.topcodi)) as pmax--,
      --(select to_number(prop.valor) from cp_proprecurso prop where prop.recurcodi = rec.recurcodi and prop.propcodi = 61 and prop.topcodi = top.topcodi and rownum = 1) as pmin,
      --(select to_number(prop.valor) from cp_proprecurso prop where prop.recurcodi = rec.recurcodi and prop.propcodi = 64 and prop.topcodi = top.topcodi and rownum = 1) as pmax
      from  pr_grupo urs
      inner join pr_grupo mo on mo.grupourspadre = urs.grupocodi
      inner join pr_grupo gr on mo.grupopadre = gr.grupocodi
      inner join pr_grupo cent on gr.grupopadre = cent.grupocodi
      inner join cp_recurso rec on mo.grupocodi = rec.recurcodisicoes
      inner join cp_topologia top on rec.topcodi = top.topcodi
      where
      cent.grupoactivo = 'S' and urs.catecodi=12 and mo.grupoactivo='S' and mo.catecodi in (2,9) and urs.grupocodi != 1916
      and cent.grupotipo = 'T' and --rec.recurconsideragams = 1 and
      (rec.tablasicoes = 'PR_GRUPO' or rec.tablasicoes = 'Prgrupo') and rec.recurestado = 1 and
      top.topfinal = 1 and top.toptipo = 1 and topsinrsf &lt;=0 and
      (top.topfecha >= to_date('{0}','YYYY-MM-DD') and top.topfecha &lt;= to_date('{1}','YYYY-MM-DD'))
      order by 1 asc
    </query>
  </Sql>


  <Sql>
    <key>ObtenerPropiedadPotenciaEfectiva</key>
    <query>
      select equipadre as equicodi, max(pefec) as Pefec from (
      select distinct
      pe.equicodi,
      to_number(fn_sdatoactualpropiedad(eq.equicodi, prop.propcodi)) as Pefec,
      eq.equipadre
      from eq_propequi pe
      inner join eq_equipo eq on pe.equicodi = eq.equicodi
      inner join eq_propiedad prop on pe.propcodi = prop.propcodi
      where eq.famcodi = 2 and prop.propcodi in (164)
      and pe.equicodi in (select gen.equicodi from eq_equipo gen where gen.equipadre = {0}))
      group by equipadre
    </query>
  </Sql>

	<Sql>
		<key>ObtenerPropiedadPotenciaMinima</key>
		<query>
			select equipadre as equicodi, min(pefec) as Pefec from (
			select distinct
			pe.equicodi,
			to_number(fn_sdatoactualpropiedad(eq.equicodi, prop.propcodi)) as Pefec,
			eq.equipadre
			from eq_propequi pe
			inner join eq_equipo eq on pe.equicodi = eq.equicodi
			inner join eq_propiedad prop on pe.propcodi = prop.propcodi
			where eq.famcodi = 2 and prop.propcodi in (299)
			and pe.equicodi in (select gen.equicodi from eq_equipo gen where gen.equipadre = {0}))
			group by equipadre
		</query>
	</Sql>

  <Sql>
    <key>ObtenerHorasOperacion</key>
    <query>
      select
      to_date(to_char(hor.hophorini, 'YYYY-MM-DD'), 'YYYY-MM-DD') as fechahop,
      hor.hophorini, hor.hophorfin,
      cent.grupocodi as equicodi,
      mo.grupocodi
      from  pr_grupo urs
      inner join pr_grupo mo on mo.grupourspadre = urs.grupocodi
      inner join pr_grupo gr on mo.grupopadre = gr.grupocodi
      inner join pr_grupo cent on gr.grupopadre = cent.grupocodi
      inner join eve_horaoperacion hor on mo.grupocodi = hor.grupocodi
      where
      cent.grupoactivo = 'S' and urs.catecodi=12 and mo.grupoactivo='S' and mo.catecodi in (2,9) and urs.grupocodi != 1916
      and hor.hophorini >= to_date('{0} 00:00:00', 'YYYY-MM-DD HH24:MI:SS')
      and hor.hophorini &lt;= to_date('{1} 23:59:59', 'YYYY-MM-DD HH24:MI:SS')
      and hor.hopestado = 'A'
      and cent.grupotipo = 'T'
      order by 1 asc
    </query>
  </Sql>

  <Sql>
    <key>ObtenerReporteProgramadoFinal</key>
    <query>
      select distinct tabla.* from (
      select med.*,
      case med.comedtipo
      when 1 then (select eq.equinomb from eq_equipo eq where eq.equicodi = med.equicodi)
      when 2 then (select gr.gruponomb from pr_grupo gr where gr.grupocodi = med.grupocodi)
      else '' end gruponomb
      from co_medicion48 med
      where med.covercodi = {0} and med.cotinfcodi = {1}) tabla
      inner join (
      select
      urs.grupocodi,
      case cent.grupotipo when 'T' then cent.grupocodi when 'H' then  (select eq.equicodi from eq_equipo eq where eq.grupocodi = cent.grupocodi) else 0 end as equicodi1,
      case cent.grupotipo when 'T' then 2 when 'H' then  1 else 0 end as famcodi
      from  pr_grupo urs
      inner join pr_grupo mo on mo.grupourspadre = urs.grupocodi
      inner join pr_grupo gr on mo.grupopadre = gr.grupocodi
      inner join pr_grupo cent on gr.grupopadre = cent.grupocodi
      where
      cent.grupoactivo = 'S' and urs.catecodi=12 and mo.grupoactivo='S' and mo.catecodi in (2,9) and urs.grupocodi != 1916
      ) urs on ((tabla.comedtipo = 1 and tabla.equicodi = urs.equicodi1 ) or (tabla.comedtipo = 2 and tabla.grupocodi = urs.equicodi1))
      where (tabla.comedfecha >= to_date('{2}','YYYY-MM-DD') and tabla.comedfecha&lt;=to_date('{3}', 'YYYY-MM-DD'))
      and (urs.grupocodi = {4} or {4} = 0)
    </query>
  </Sql>

  <Sql>
    <key>ObtenerReporteReservaFinal</key>
    <query>
      select distinct tabla.*,
      case tabla.famcodi
      when 1 then (select eq.equinomb from eq_equipo eq where eq.equicodi = tabla.equicodi1)
      when 2 then (select gr.gruponomb from pr_grupo gr where gr.grupocodi = tabla.equicodi1)
      else '' end gruponomb
      from (
      select med.*,
      case cent.grupotipo when 'T' then cent.grupocodi when 'H' then  (select eq.equicodi from eq_equipo eq where eq.grupocodi = cent.grupocodi) else 0 end as equicodi1,
      case cent.grupotipo when 'T' then 2 when 'H' then  1 else 0 end as famcodi,
      urs.gruponomb as ursnomb
      from co_medicion48 med
      inner join pr_grupo urs on med.grupocodi = urs.grupocodi
      inner join pr_grupo mo on mo.grupourspadre = urs.grupocodi
      inner join pr_grupo gr on mo.grupopadre = gr.grupocodi
      inner join pr_grupo cent on gr.grupopadre = cent.grupocodi
      where med.covercodi = {0} and med.cotinfcodi = {1} and
      cent.grupoactivo = 'S' and urs.catecodi=12 and mo.grupoactivo='S' and mo.catecodi in (2,9) and urs.grupocodi != 1916
      ) tabla
      where (tabla.comedfecha >= to_date('{2}','YYYY-MM-DD') and tabla.comedfecha&lt;=to_date('{3}', 'YYYY-MM-DD'))
      and (tabla.grupocodi = {4} or {4} = 0)
    </query>
  </Sql>

  <Sql>
    <key>ObtenerReporteDespachoFinal</key>
    <query>
      select distinct tabla.*,
      case tabla.famcodi
      when 1 then (select eq.equinomb from eq_equipo eq where eq.equicodi = tabla.equicodi1)
      when 2 then (select gr.gruponomb from pr_grupo gr where gr.grupocodi = tabla.equicodi1)
      else '' end gruponomb
      from (
      select med.*,
      case cent.grupotipo when 'T' then cent.grupocodi when 'H' then  (select eq.equicodi from eq_equipo eq where eq.grupocodi = cent.grupocodi) else 0 end as equicodi1,
      case cent.grupotipo when 'T' then 2 when 'H' then  1 else 0 end as famcodi,
      urs.gruponomb as ursnomb
      from co_medicion48 med
      inner join pr_grupo urs on med.grupocodi = urs.grupocodi
      inner join pr_grupo mo on mo.grupourspadre = urs.grupocodi
      inner join pr_grupo gr on mo.grupopadre = gr.grupocodi
      inner join pr_grupo cent on gr.grupopadre = cent.grupocodi
      where med.covercodi = {0} and med.cotinfcodi = {1} and
      cent.grupoactivo = 'S' and urs.catecodi=12 and mo.grupoactivo='S' and mo.catecodi in (2,9) and urs.grupocodi != 1916
      ) tabla
      where (tabla.comedfecha >= to_date('{2}','YYYY-MM-DD') and tabla.comedfecha&lt;=to_date('{3}', 'YYYY-MM-DD'))
      and (tabla.grupocodi = {4} or {4} = 0)
    </query>
  </Sql>

  <Sql>
    <key>ObtenerLiquidacionResultadoFinal</key>
    <query>
      select distinct med.*,
      (select eq.equicodi from eq_equipo eq where eq.grupocodi = cent.grupocodi)  as equicodi1,
      (select eq.emprcodi from eq_equipo eq where eq.grupocodi = cent.grupocodi)  as emprcodi,
      urs.gruponomb
      from co_medicion48 med
      inner join pr_grupo urs on med.grupocodi = urs.grupocodi
      inner join pr_grupo mo on mo.grupourspadre = urs.grupocodi
      inner join pr_grupo gr on mo.grupopadre = gr.grupocodi
      inner join pr_grupo cent on gr.grupopadre = cent.grupocodi
      where med.covercodi = {0} and med.cotinfcodi = {1} and
      cent.grupoactivo = 'S' and urs.catecodi=12 and mo.grupoactivo='S' and mo.catecodi in (2,9) and urs.grupocodi != 1916
    </query>
  </Sql>

  <Sql>
    <key>EliminarLiquidacion</key>
    <query>
      delete from vcr_despachours where vcrecacodi = {0}
    </query>
  </Sql>

</Sqls>
