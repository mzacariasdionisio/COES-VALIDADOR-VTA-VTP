<?xml version="1.0" encoding="utf-8" ?>
<Sqls>

  <Sql>
    <key>GetMaxId</key>
    <query>
		select nvl(max(epcamacodi), 0) + 1 from epr_carga_masiva
	</query>
  </Sql>

  <Sql>
    <key>Save</key>
    <query>
		insert into epr_carga_masiva(
		epcamacodi,
		epcamatipuso,
		epcamafeccarga,
		epcamatotalregistro,
		epcamausucreacion,
		epcamafeccreacion

		)
		values(
		:epcamacodi,
		:epcamatipuso,
		:epcamafeccarga,
		:epcamatotalregistro,
		:epcamausucreacion,
		sysdate
		)
	</query>
  </Sql>


  <Sql>
    <key>GetById</key>
    <query>
       select
            epcamacodi, 
            epcamatipuso, 
            epcamafeccarga, 
            epcamausucreacion, 
            epcamafeccreacion, 
            epcamausumodificacion, 
            epcamafecmodificacion
       from
           epr_carga_masiva
       where
           epcamacodi = :epcamacodi
    </query>
  </Sql>

  <Sql>
    <key>ListFiltroCargaMasiva</key>
    <query>
		select
		epcamacodi,
		epcamatipuso,
		eqcatddescripcion,
		epcamafeccarga,
		epcamatotalregistro,
		epcamausucreacion,
		epcamafeccreacion,
		epcamausumodificacion,
		epcamafecmodificacion
		from
		epr_carga_masiva left join eq_prop_catalogo_data on epcamatipuso = eqcatdcodi and eqcatccodi = 4
		where
		(epcamatipuso = :epcamatipuso OR 0 = :epcamatipuso) {0}
		order by epcamafeccarga desc
	</query>
  </Sql>

	<Sql>
		<key>ValidarProteccionesUsoGeneral</key>
		<query>
			select pkg_protecciones.fn_val_rele_uso_general (
			{0},
			{1},
			{2},
			{3},
			{4},
			{5},
			{6},
			{7},
			{8},
			{9},
			{10},
			{11},
			{12},
			{13},
			{14},
			{15},
			{16},
			{17},
			{18},
			{19},
			{20},
			{21},
			{22},
			{23},
			{24},
			{25},
			{26},
			{27},
			{28},
			{29}
			) from dual
		</query>
	</Sql>

	<Sql>
		<key>SaveProteccionesUsoGeneral</key>
		<query>
			DECLARE
			resultado varchar2(1000);
			BEGIN
			resultado:= pkg_protecciones.fn_save_rele_uso_general (
			{0},
			{1},
			{2},
			{3},
			{4},
			{5},
			{6},
			{7},
			{8},
			{9},
			{10},
			{11},
			{12},
			{13},
			{14},
			{15},
			{16},
			{17},
			{18},
			{19},
			{20},
			{21},
			{22},
			{23},
			{24},
			{25},
			{26},
			{27},
			{28},
			{29},
			{30}
			);
			END;
		</query>
	</Sql>

	<Sql>
		<key>ValidarProteccionesMandoSincronizado</key>
		<query>
			select pkg_protecciones.fn_val_rele_mando_sincronizado (
			{0},
			{1},
			{2},
			{3},
			{4},
			{5},
			{6},
			{7},
			{8},
			{9},
			{10},
			{11},
			{12}		
			) from dual
		</query>
	</Sql>

	<Sql>
		<key>SaveProteccionesMandoSincronizado</key>
		<query>
			DECLARE
			resultado varchar2(1000);
			BEGIN
			resultado:= pkg_protecciones.fn_save_rele_mando_sincronizado (
			{0},
			{1},
			{2},
			{3},
			{4},
			{5},
			{6},
			{7},
			{8},
			{9},
			{10},
			{11},
			{12},
			{13}			
			);
			END;
		</query>
	</Sql>

	<Sql>
		<key>ValidarProteccionesTorsional</key>
		<query>
			select pkg_protecciones.fn_val_rele_torsional (
			{0},
			{1},
			{2},
			{3},
			{4},
			{5},
			{6},
			{7},
			{8},
			{9},
			{10},
			{11},
			{12}
			) from dual
		</query>
	</Sql>

	<Sql>
		<key>SaveProteccionesTorsional</key>
		<query>
			DECLARE
			resultado varchar2(1000);
			BEGIN
			resultado:= pkg_protecciones.fn_save_rele_torsional (
			{0},
			{1},
			{2},
			{3},
			{4},
			{5},
			{6},
			{7},
			{8},
			{9},
			{10},
			{11},
			{12},
			{13}
			);
			END;
		</query>
	</Sql>

	<Sql>
		<key>ValidarProteccionesPmu</key>
		<query>
			select pkg_protecciones.fn_val_rele_pmu (
			{0},
			{1},
			{2},
			{3},
			{4},
			{5},
			{6},
			{7},
			{8},
			{9},
			{10},
			{11},
			{12}
			) from dual
		</query>
	</Sql>

	<Sql>
		<key>SaveProteccionesPmu</key>
		<query>
			DECLARE
			resultado varchar2(1000);
			BEGIN
			resultado:= pkg_protecciones.fn_save_rele_pmu (
			{0},
			{1},
			{2},
			{3},
			{4},
			{5},
			{6},
			{7},
			{8},
			{9},
			{10},
			{11},
			{12},
			{13}
			);
			END;
		</query>
	</Sql>

	<Sql>
		<key>ValidarProteccionesLinea</key>
		<query>
			select pkg_protecciones.fn_val_linea (
			{0},
			{1},
			{2},
			{3},
			{4},
			{5},
			{6},
			{7},
			{8},
			{9},
			{10},
			{11},
			{12},
			{13},
			{14}			
			
			) from dual
		</query>
	</Sql>

	<Sql>
		<key>SaveProteccionesLinea</key>
		<query>
			DECLARE
			resultado varchar2(1000);
			BEGIN
			resultado:= pkg_protecciones.fn_cargar_linea  (
			{0},
			{1},
			{2},
			{3},
			{4},
			{5},
			{6},
			{7},
			{8},
			{9},
			{10},
			{11},
			{12},
			{13},
			{14},
			{15},
			{16},
			{17},
			{18},
			{19},
			{20},
			{21},
			{22},
			{23},
			{24},
			{25},
			{26},
			{27},
			{28},
			{29},
			{30}
			);
			END;
		</query>
	</Sql>


	<Sql>
		<key>ValidarProteccionesReactor</key>
		<query>
			select pkg_protecciones.fn_val_reactor (
			{0},
			{1},
			{2},
			{3},
			{4},
			{5},
			{6}		

			) from dual
		</query>
	</Sql>

	<Sql>
		<key>SaveProteccionesReactor</key>
		<query>
			DECLARE
			resultado varchar2(1000);
			BEGIN
			resultado:= pkg_protecciones.fn_cargar_reactor  (
			{0},
			{1},
			{2},
			{3},
			{4},
			{5},
			{6},
			{7},
			{8},
			{9},
			{10},
			{11},
			{12},
			{13},
			{14}
			);
			END;
		</query>
	</Sql>
	
	<Sql>
		<key>ValidarProteccionesCeldaAcoplamiento</key>
		<query>
			select pkg_protecciones.fn_val_celda_acoplamiento (
			{0},
			{1},
			{2},
			{3},
			{4}

			) from dual
		</query>
	</Sql>

	<Sql>
		<key>SaveProteccionesCeldaAcoplamiento</key>
		<query>
			DECLARE
			resultado varchar2(1000);
			BEGIN
			resultado:= pkg_protecciones.fn_cargar_celda_acoplamiento  (
			{0},
			{1},
			{2},
			{3},
			{4},
			{5},
			{6},
			{7},
			{8},
			{9},
			{10}
			);
			END;
		</query>
	</Sql>

	<Sql>
		<key>ValidarProteccionesTransformador</key>
		<query>
			select pkg_protecciones.fn_val_transformador (
			{0},
			{1},
			{2},
			{3},
			{4},
			{5},
			{6},
			{7},
			{8},
			{9},
			{10},
			{11},
			{12},
			{13},
			{14}

			) from dual
		</query>
	</Sql>

	<Sql>
		<key>SaveProteccionesTransformador</key>
		<query>
			DECLARE
			resultado varchar2(1000);
			BEGIN
			resultado:= pkg_protecciones.fn_cargar_transformador  (
			{0},
			{1},
			{2},
			{3},
			{4},
			{5},
			{6},
			{7},
			{8},
			{9},
			{10},
			{11},
			{12},
			{13},
			{14},
			{15},
			{16},
			{17},
			{18},
			{19},
			{20},
			{21},
			{22},
			{23},
			{24},
			{25},
			{26},
			{27},
			{28},
			{29},
			{30}
			);
			END;
		</query>
	</Sql>

	<Sql>
		<key>ListLineaEvaluacionReporte</key>
		<query>
			WITH equipo AS (
			SELECT eq.*
			FROM
			eq_equipo eq join epr_equipo ep on eq.equicodi = ep.equicodi and ep.epequiestregistro='1'
			WHERE eq.famcodi = 8
			AND ( nvl({0}, 0) = 0 OR eq.equicodi = {0})
			AND ( TRIM('{1}') IS NULL OR upper(eq.equiabrev) LIKE '%'|| upper('{1}')|| '%' )
			AND ( nvl({2}, 0) = 0 OR eq.emprcodi = {2} )
			AND ( TRIM('{3}') IS NULL OR eq.equiestado = '{3}' )
			)
			, ult_fecha_prop AS (
			SELECT
			p.equicodi,
			p.propcodi,
			MAX(p.fechapropequi) AS fechapropequi
			FROM
			eq_propequi p
			JOIN equipo e ON p.equicodi = e.equicodi
			AND p.propequideleted=0			
			GROUP BY
			p.equicodi,
			p.propcodi
			)
			, ult_fecha_modificacion_equipo AS (
			SELECT
			p.equicodi,
			MAX(p.fechapropequi) AS fechapropequi
			FROM ult_fecha_prop p
			GROUP BY
			p.equicodi
			)
			, ult_proy_act_equipo AS (
			SELECT
			p.equicodi,
			MAX(p.epproycodi) AS epproycodi
			FROM
			eq_propequi p join ult_fecha_modificacion_equipo ufa on p.equicodi = ufa.equicodi and p.fechapropequi = ufa.fechapropequi
			AND p.propequideleted=0
			GROUP BY
			p.equicodi
			)
			, ult_modificador_equipo AS (
			SELECT
			p.equicodi
			,MAX(nvl(p.propequiusumodificacion,p.propequiusucreacion)) AS propequiusumodificacion
			,MAX(nvl(p.propequifecmodificacion,p.propequifeccreacion)) AS propequifecmodificacion
			FROM
			eq_propequi p
			JOIN ult_fecha_modificacion_equipo e ON p.equicodi = e.equicodi
			AND p.fechapropequi = e.fechapropequi
			AND p.propequideleted=0
			GROUP BY
			p.equicodi
			)
			,data_prop AS (
			SELECT
			pe.equicodi,
			pe.propcodi,
			pe.valor,
			pe.PROPEQUICOMENTARIO
			FROM
			eq_propequi pe
			JOIN ult_fecha_prop up ON pe.equicodi = up.equicodi
			AND pe.propcodi = up.propcodi
			AND pe.fechapropequi = up.fechapropequi
			AND pe.propequideleted=0
			)
			,eq_propiedad AS (
			SELECT
			*
			FROM
			data_prop PIVOT (
			MAX(valor)
			,max(propequicomentario) as coment
			FOR propcodi
			IN (
			3351 as id_area
			,263 as longitud
			,1852 as tension
			,699 as capacidad_a
			,3352 as capacidad_mva
			,3355 as id_celda_1
			,3356 as id_celda_2
			,3357 as id_banco_condensador
			,3358 as capac_trans_cond_1_porcen
			,3359 as capac_trans_cond_1_min
			,3360 as capac_trans_corr_1_a
			,3361 as capac_trans_cond_2_porcen
			,3362 as capac_trans_cond_2_min
			,3363 as capac_trans_corr_2_a
			,3353 as capacidad_transmision_a
			,3354 as capacidad_transmision_mva
			,3364 as limite_seg_coes
			,3365 as factor_limitante_calc
			,3366 as factor_limitante_final
			,3367 as observaciones
			)
			)
			)

			,equipo_banco as (
			select e.equicodi,e.equinomb,e.equiabrev,e.equitension,e.areacodi,e.emprcodi
			from eq_equipo e
			where equicodi in (select to_number(valor default 0 on conversion error) from data_prop where propcodi = 3357)
			and equicodi!=0
			)
			, ult_fecha_prop_banco AS (
			SELECT
			p.equicodi,
			p.propcodi,
			MAX(p.fechapropequi) AS fechapropequi
			FROM
			eq_propequi p
			JOIN equipo_banco e ON p.equicodi = e.equicodi
			AND p.propequideleted=0
			GROUP BY
			p.equicodi,
			p.propcodi
			)
			,data_prop_banco AS (
			SELECT
			pe.equicodi,
			pe.propcodi,
			pe.valor,
			pe.propequicomentario
			FROM
			eq_propequi pe
			JOIN ult_fecha_prop_banco up ON pe.equicodi = up.equicodi
			AND pe.propcodi = up.propcodi
			AND pe.fechapropequi = up.fechapropequi
			AND pe.propequideleted=0
			)
			,eq_propiedad_banco AS (
			SELECT
			*
			FROM
			data_prop_banco PIVOT (
			max(valor),max(propequicomentario) as coment
			FOR propcodi
			IN (
			2172 as capacidad_a
			,2173 as capacidad_mvar
			)
			)
			)

			SELECT
			e.equicodi as codigo_id
			,e.equiabrev as codigo
			,ubi.areanomb as ubicacion
			,em.emprnomb as empresa
			,al.areanomb as area
			,p.longitud as longitud
			,p.longitud_coment as longitud_coment
			,p.tension
			,p.tension_coment as tension_coment
			,p.capacidad_a
			,p.capacidad_a_coment as capacidad_a_coment
			,p.capacidad_mva
			,p.capacidad_mva_coment as capacidad_mva_coment
			,p.id_celda_1 as id_celda_1
			,ec1.equinomb as nombre_celda_1
			,ac1.areanomb as ubicacion_celda_1
			,pkg_protecciones.fn_get_celda_posicion_nucleo_tc(p.id_celda_1) as posicion_nucleo_tc_celda_1
			,pkg_protecciones.fn_get_celda_pick_up(p.id_celda_1) as pick_up_celda_1

			,p.id_celda_2 as id_celda_2
			,ec2.equinomb as nombre_celda_2
			,ac2.areanomb as ubicacion_celda_2
			,pkg_protecciones.fn_get_celda_posicion_nucleo_tc(p.id_celda_2) as posicion_nucleo_tc_celda_2
			,pkg_protecciones.fn_get_celda_pick_up(p.id_celda_2) as pick_up_celda_2

			,p.id_banco_condensador as id_banco_condensador
			,ebc.equinomb as nombre_banco_condensador
			,abc.areanomb as ubicacion_banco_condensador
			,pb.capacidad_a as capacidad_a_banco
			,pb.capacidad_mvar as capacidad_mvar_banco
			,p.capac_trans_cond_1_porcen
			,p.capac_trans_cond_1_porcen_coment
			,p.capac_trans_cond_1_min
			,p.capac_trans_cond_1_min_coment
			,p.capac_trans_corr_1_a
			,p.capac_trans_corr_1_a_coment
			,p.capac_trans_cond_2_porcen
			,p.capac_trans_cond_2_porcen_coment
			,p.capac_trans_cond_2_min
			,p.capac_trans_cond_2_min_coment
			,p.capac_trans_corr_2_a
			,p.capac_trans_corr_2_a_coment
			,p.capacidad_transmision_a
			,p.capacidad_transmision_a_coment
			,p.capacidad_transmision_mva
			,p.capacidad_transmision_mva_coment
			,p.limite_seg_coes
			,p.limite_seg_coes_coment
			,p.factor_limitante_calc
			,p.factor_limitante_calc_coment
			,p.factor_limitante_final
			,p.factor_limitante_final_coment
			,p.observaciones
			,case when proy.epproycodi is not null then trim(proy.epproynemotecnico)||':'||trim(proy.epproynomb) end as motivo
			,uum.propequiusumodificacion as USUARIO_AUDITORIA
			,TO_CHAR(uum.propequifecmodificacion, 'DD/MM/YYYY') as FECHA_MODIFICACION

			,pb.capacidad_a_coment as capacidad_a_banco_coment
			,pb.capacidad_mvar_coment as capacidad_mvar_banco_coment

			FROM
			eq_propiedad p
			JOIN equipo e ON p.equicodi = e.equicodi
			JOIN ult_fecha_modificacion_equipo ufm ON p.equicodi = ufm.equicodi
			JOIN ult_modificador_equipo uum ON p.equicodi = uum.equicodi
			JOIN ult_proy_act_equipo upa on p.equicodi = upa.equicodi
			LEFT JOIN eq_area ubi on e.areacodi = ubi.areacodi
			LEFT JOIN eq_area al on to_number(p.id_area default 0 on conversion error) = al.areacodi
			LEFT JOIN si_empresa em on e.emprcodi = em.emprcodi
			LEFT JOIN eq_equipo ec1 on to_number(p.id_celda_1 default 0 on conversion error) = ec1.equicodi
			LEFT JOIN eq_area ac1 on ec1.areacodi= ac1.areacodi
			LEFT JOIN eq_equipo ec2 on to_number(p.id_celda_2 default 0 on conversion error) = ec2.equicodi
			LEFT JOIN eq_area ac2 on ec2.areacodi= ac2.areacodi
			LEFT JOIN eq_prop_catalogo_data es ON eqcatccodi = 6 and e.equiestado = es.eqcatdabrev
			LEFT JOIN eq_equipo ebc on to_number(p.id_banco_condensador default 0 on conversion error) = ebc.equicodi
			LEFT JOIN eq_area abc on ebc.areacodi= abc.areacodi
			LEFT JOIN epr_proyecto_acteqp proy on upa.epproycodi = proy.epproycodi

			LEFT JOIN equipo_banco eb ON to_number(p.id_banco_condensador default 0 on conversion error) = eb.equicodi
			LEFT JOIN eq_propiedad_banco pb on eb.equicodi = pb.equicodi
			WHERE 1 = 1
			AND ( nvl({4}, 0) = 0 OR ec1.areacodi = {4})
			AND ( nvl({5}, 0) = 0 OR ec2.areacodi = {5} )
			AND ( nvl({6}, 0) = 0 OR to_number(p.id_area default 0 on conversion error) = {6} )
			AND ( nvl({7}, 0) = 0 OR to_number(p.id_area default 0 on conversion error) = {7} )
			AND ( nvl({8}, 0) = 0 OR to_number(p.tension default 0 on conversion error) = {8} )
		</query>
	</Sql>

	<Sql>
		<key>ListReactorEvaluacionReporte</key>
		<query>

			WITH equipo AS (
			SELECT eq.*,ap.areacodizona
			FROM
			eq_equipo eq inner join epr_equipo ep on eq.equicodi = ep.equicodi and ep.epequiestregistro='1'
			left join epr_area ap on eq.areacodi = ap.areacodi
			WHERE eq.famcodi = 12
			AND ( nvl({0}, 0) = 0 OR eq.equicodi = {0} )
			AND ( TRIM('{1}') IS NULL OR upper(eq.equiabrev) LIKE '%'|| upper('{1}')|| '%' )
			AND ( nvl({2}, 0) = 0 OR eq.emprcodi = {2} )
			AND ( TRIM('{3}') IS NULL OR eq.equiestado = '{3}' )
			AND ( nvl({4}, 0) = 0 OR eq.areacodi = {4} )
			AND ( nvl({5}, 0) = 0 OR ap.areacodizona = {5})

			AND ( nvl({6}, 0) = 0 OR ap.areacodizona = {6} )
			)
			, ult_fecha_prop AS (
			SELECT
			p.equicodi,
			p.propcodi,
			MAX(p.fechapropequi) AS fechapropequi
			FROM
			eq_propequi p
			JOIN equipo e ON p.equicodi = e.equicodi
			AND p.propequideleted=0
			GROUP BY
			p.equicodi,
			p.propcodi
			)
			, ult_fecha_modificacion_equipo AS (
			SELECT
			p.equicodi,
			MAX(p.fechapropequi) AS fechapropequi
			FROM ult_fecha_prop p
			GROUP BY
			p.equicodi
			)
			, ult_proy_act_equipo AS (
			SELECT
			p.equicodi,
			MAX(p.epproycodi) AS epproycodi
			FROM
			eq_propequi p join ult_fecha_modificacion_equipo ufa on p.equicodi = ufa.equicodi and p.fechapropequi = ufa.fechapropequi
			AND p.propequideleted=0
			GROUP BY
			p.equicodi
			)
			, ult_modificador_equipo AS (
			SELECT
			p.equicodi
			,MAX(nvl(p.propequiusumodificacion,p.propequiusucreacion)) AS propequiusumodificacion
			,MAX(nvl(p.propequifecmodificacion,p.propequifeccreacion)) AS propequifecmodificacion
			FROM
			eq_propequi p
			JOIN ult_fecha_modificacion_equipo e ON p.equicodi = e.equicodi
			AND p.fechapropequi = e.fechapropequi
			AND p.propequideleted=0
			GROUP BY
			p.equicodi
			)
			,data_prop AS (
			SELECT
			pe.equicodi,
			pe.propcodi,
			pe.valor,
			pe.propequicomentario
			FROM
			eq_propequi pe
			JOIN ult_fecha_prop up ON pe.equicodi = up.equicodi
			AND pe.propcodi = up.propcodi
			AND pe.fechapropequi = up.fechapropequi
			AND pe.propequideleted=0
			)
			,eq_propiedad AS (
			SELECT
			*
			FROM
			data_prop PIVOT (
			MAX(valor)
			,max(propequicomentario) as coment
			FOR propcodi
			IN (
			241 as tension
			,3401 as id_celda_1
			,3402 as id_celda_2
			,240 as capacidad_mvar
			,1927 as capacidad_a
			,3403 as capacidad_transmision_a
			,3404 as capacidad_transmision_mvar
			,3405 as factor_limitante_calc
			,3406 as factor_limitante_final
			,3407 as observaciones
			)
			)
			)
			SELECT
			e.equicodi as codigo_id
			,e.equiabrev as codigo
			,a.areanomb as ubicacion
			,az.areanomb as area
			,em.emprnomb as empresa
			,p.id_celda_1 as id_celda_1
			,ec1.equinomb as nombre_celda_1
			,ac1.areanomb as ubicacion_celda_1
			,pkg_protecciones.fn_get_celda_posicion_nucleo_tc(p.id_celda_1) as posicion_nucleo_tc_celda_1
			,pkg_protecciones.fn_get_celda_pick_up(p.id_celda_1) as pick_up_celda_1

			,p.id_celda_2 as id_celda_2
			,ec2.equinomb as nombre_celda_2
			,ac2.areanomb as ubicacion_celda_2
			,pkg_protecciones.fn_get_celda_posicion_nucleo_tc(p.id_celda_2) as posicion_nucleo_tc_celda_2
			,pkg_protecciones.fn_get_celda_pick_up(p.id_celda_2) as pick_up_celda_2

			,p.tension
			,p.tension_coment
			,p.capacidad_mvar
			,p.capacidad_mvar_coment
			,p.capacidad_a
			,p.capacidad_a_coment
			,p.capacidad_transmision_a
			,p.capacidad_transmision_a_coment
			,p.capacidad_transmision_mvar
			,p.capacidad_transmision_mvar_coment
			,p.factor_limitante_calc
			,p.factor_limitante_calc_coment
			,p.factor_limitante_final
			,p.factor_limitante_final_coment
			,p.observaciones
			,case when proy.epproycodi is not null then trim(proy.epproynemotecnico)||':'||trim(proy.epproynomb) end as motivo
			,uum.propequiusumodificacion as usuario_auditoria
			,TO_CHAR(uum.propequifecmodificacion, 'DD/MM/YYYY HH24:MI') as fecha_modificacion
			FROM
			eq_propiedad p
			JOIN equipo e ON p.equicodi = e.equicodi
			JOIN ult_fecha_modificacion_equipo ufm ON p.equicodi = ufm.equicodi
			JOIN ult_modificador_equipo uum ON p.equicodi = uum.equicodi
			JOIN ult_proy_act_equipo upa on p.equicodi = upa.equicodi
			LEFT JOIN eq_area a on e.areacodi = a.areacodi
			LEFT JOIN eq_area az on e.areacodizona = az.areacodi
			LEFT JOIN si_empresa em on e.emprcodi = em.emprcodi
			LEFT JOIN eq_prop_catalogo_data es ON eqcatccodi = 6 and e.equiestado = es.eqcatdabrev

			LEFT JOIN eq_equipo ec1 on to_number(p.id_celda_1 default 0 on conversion error) = ec1.equicodi
			LEFT JOIN eq_area ac1 on ec1.areacodi= ac1.areacodi
			LEFT JOIN eq_equipo ec2 on to_number(p.id_celda_2 default 0 on conversion error) = ec2.equicodi
			LEFT JOIN eq_area ac2 on ec2.areacodi= ac2.areacodi
			LEFT JOIN epr_proyecto_acteqp proy on upa.epproycodi = proy.epproycodi
		</query>
	</Sql>

	<Sql>
		<key>ListCeldasAcoplamientoReporte</key>
		<query>
			WITH equipo AS (
			SELECT eq.*,ap.areacodizona
			FROM
			eq_equipo eq join epr_equipo ep on eq.equicodi = ep.equicodi and ep.epequiestregistro='1'
			left join epr_area ap on eq.areacodi = ap.areacodi
			WHERE eq.famcodi = 6
			AND ep.epequiflagsev='1'
			-- AND upper(eq.equiabrev) LIKE '%ACOP%'
			AND ( nvl({0}, 0) = 0 OR eq.equicodi = {0} )
			AND ( TRIM('{1}') IS NULL OR upper(eq.equiabrev) LIKE '%'|| upper('{1}')|| '%' )
			AND ( nvl({2}, 0) = 0 OR eq.emprcodi = {2} )
			AND ( TRIM('{3}') IS NULL OR eq.equiestado = '{3}' )
			AND ( nvl({4}, 0) = 0 OR eq.areacodi = {4} )
			AND ( nvl({5}, 0) = 0 OR ap.areacodizona = {5} )

			AND ( nvl({6}, 0) = 0 OR ap.areacodizona = {6} )
			)
			, ult_fecha_prop AS (
			SELECT
			p.equicodi,
			p.propcodi,
			MAX(p.fechapropequi) AS fechapropequi
			FROM
			eq_propequi p
			JOIN equipo e ON p.equicodi = e.equicodi
			AND p.propequideleted=0
			GROUP BY
			p.equicodi,
			p.propcodi
			)
			, ult_fecha_modificacion_equipo AS (
			SELECT
			p.equicodi,
			MAX(p.fechapropequi) AS fechapropequi
			FROM ult_fecha_prop p
			GROUP BY
			p.equicodi
			)
			, ult_proy_act_equipo AS (
			SELECT
			p.equicodi,
			MAX(p.epproycodi) AS epproycodi
			FROM
			eq_propequi p join ult_fecha_modificacion_equipo ufa on p.equicodi = ufa.equicodi and p.fechapropequi = ufa.fechapropequi
			AND p.propequideleted=0
			GROUP BY
			p.equicodi
			)
			, ult_modificador_equipo AS (
			SELECT
			p.equicodi
			,MAX(nvl(p.propequiusumodificacion,p.propequiusucreacion)) AS propequiusumodificacion
			,MAX(nvl(p.propequifecmodificacion,p.propequifeccreacion)) AS propequifecmodificacion
			FROM
			eq_propequi p
			JOIN ult_fecha_modificacion_equipo e ON p.equicodi = e.equicodi
			AND p.fechapropequi = e.fechapropequi
			AND p.propequideleted=0
			GROUP BY
			p.equicodi
			)
			,data_prop AS (
			SELECT
			pe.equicodi,
			pe.propcodi,
			pe.valor,
			pe.propequicomentario
			FROM
			eq_propequi pe
			JOIN ult_fecha_prop up ON pe.equicodi = up.equicodi
			AND pe.propcodi = up.propcodi
			AND pe.fechapropequi = up.fechapropequi
			AND pe.propequideleted=0
			)
			,eq_propiedad AS (
			SELECT
			*
			FROM
			data_prop PIVOT (
			max(valor),max(propequicomentario) as coment
			FOR propcodi
			IN (
			3411 as id_interruptor
			,3414 as capacidad_transmision_a
			,3415 as capacidad_transmision_mva
			,3416 as factor_limitante_calc
			,3417 as factor_limitante_final
			,3418 as observaciones
			)
			)
			)
			,equipo_interruptor as (
			select e.equicodi,e.equinomb,e.equiabrev,e.equitension,e.areacodi,e.emprcodi
			from eq_equipo e
			where equicodi in (select to_number(valor default 0 on conversion error) from data_prop where propcodi = 3411)
			and equicodi!=0
			)
			, ult_fecha_prop_interruptor AS (
			SELECT
			p.equicodi,
			p.propcodi,
			MAX(p.fechapropequi) AS fechapropequi
			FROM
			eq_propequi p
			JOIN equipo_interruptor e ON p.equicodi = e.equicodi
			AND p.propequideleted=0
			GROUP BY
			p.equicodi,
			p.propcodi
			)
			,data_prop_interruptor AS (
			SELECT
			pe.equicodi,
			pe.propcodi,
			pe.valor,
			pe.propequicomentario
			FROM
			eq_propequi pe
			JOIN ult_fecha_prop_interruptor up ON pe.equicodi = up.equicodi
			AND pe.propcodi = up.propcodi
			AND pe.fechapropequi = up.fechapropequi
			AND pe.propequideleted=0
			)
			,eq_propiedad_interruptor AS (
			SELECT
			*
			FROM
			data_prop_interruptor PIVOT (
			max(valor),max(propequicomentario) as coment
			FOR propcodi
			IN (
			401 as capacidad_a
			,3413 as capacidad_mva
			)
			)
			)

			SELECT
			e.equicodi as codigo_id
			,e.equiabrev as nombre
			,a.areanomb as ubicacion
			,az.areanomb as area
			,pkg_protecciones.fn_get_celda_posicion_nucleo_tc(e.equicodi) as posicion_nucleo_tc
			,pkg_protecciones.fn_get_celda_pick_up(e.equicodi) as pick_up
			,ei.equicodi as codigo_id_interruptor
			,ei.equinomb as nombre_interruptor
			,aint.areanomb as ubicacion_interruptor
			,eint.emprnomb as empresa_interruptor
			,ei.equitension as tension_interruptor
			,pi.capacidad_a as capacidad_a_interruptor
			,pi.capacidad_a_coment as capacidad_a_interruptor_coment
			,pi.capacidad_mva as capacidad_mva_interruptor
			,pi.capacidad_mva_coment as capacidad_mva_interruptor_coment

			,p.capacidad_transmision_a
			,p.capacidad_transmision_a_coment
			,p.capacidad_transmision_mva
			,p.capacidad_transmision_mva_coment
			,p.factor_limitante_calc
			,p.factor_limitante_calc_coment
			,p.factor_limitante_final
			,p.factor_limitante_final_coment
			,p.observaciones
			,case when proy.epproycodi is not null then trim(proy.epproynemotecnico)||':'||trim(proy.epproynomb) end as motivo
			,uum.propequiusumodificacion as usuario_auditoria
			,TO_CHAR(uum.propequifecmodificacion, 'DD/MM/YYYY HH24:MI') as fecha_modificacion
			FROM
			eq_propiedad p
			JOIN equipo e ON p.equicodi = e.equicodi
			JOIN ult_fecha_modificacion_equipo ufm ON p.equicodi = ufm.equicodi
			JOIN ult_modificador_equipo uum ON p.equicodi = uum.equicodi
			JOIN ult_proy_act_equipo upa on p.equicodi = upa.equicodi
			LEFT JOIN eq_area a on e.areacodi = a.areacodi
			LEFT JOIN eq_area az on e.areacodizona = az.areacodi
			LEFT JOIN si_empresa em on e.emprcodi = em.emprcodi
			LEFT JOIN eq_prop_catalogo_data es ON eqcatccodi = 6 and e.equiestado = es.eqcatdabrev
			LEFT JOIN equipo_interruptor ei ON to_number(p.id_interruptor default 0 on conversion error) = ei.equicodi
			LEFT JOIN eq_propiedad_interruptor pi on ei.equicodi = pi.equicodi
			LEFT JOIN eq_area aint on ei.areacodi = aint.areacodi
			LEFT JOIN si_empresa eint on ei.emprcodi = eint.emprcodi
			LEFT JOIN epr_proyecto_acteqp proy on upa.epproycodi = proy.epproycodi
			WHERE ( nvl({7}, 0) = 0 OR ei.equitension = {7} )
		</query>
	</Sql>

	<Sql>
		<key>ListTransformadoresReporte</key>
		<query>
			WITH equipo AS (
			SELECT eq.*,ap.areacodizona
			FROM
			eq_equipo eq inner join epr_equipo ep on eq.equicodi = ep.equicodi and ep.epequiestregistro='1'
			left join epr_area ap on eq.areacodi = ap.areacodi
			WHERE eq.famcodi in (9,10,47)
			AND ( nvl({0}, 0) = 0 OR eq.equicodi = {0} )
			AND ( TRIM('{1}') IS NULL OR upper(eq.equiabrev) LIKE '%'|| upper('{1}')|| '%' )
			AND ( nvl({2}, 0) = 0 OR eq.emprcodi = {2} )
			AND ( TRIM('{3}') IS NULL OR eq.equiestado = '{3}' )
			AND ( nvl({4}, 0) = 0 OR eq.famcodi = {4} )
			AND ( nvl({5}, 0) = 0 OR eq.areacodi = {5} )
			AND ( nvl({6}, 0) = 0 OR ap.areacodizona = {6} )

			AND ( nvl({7}, 0) = 0 OR ap.areacodizona = {7} )
			)
			, ult_fecha_prop AS (
			SELECT
			p.equicodi,
			p.propcodi,
			MAX(p.fechapropequi) AS fechapropequi
			FROM
			eq_propequi p
			JOIN equipo e ON p.equicodi = e.equicodi
			AND p.propequideleted=0
			GROUP BY
			p.equicodi,
			p.propcodi
			)
			, ult_fecha_modificacion_equipo AS (
			SELECT
			p.equicodi,
			MAX(p.fechapropequi) AS fechapropequi
			FROM ult_fecha_prop p
			GROUP BY
			p.equicodi
			)
			, ult_proy_act_equipo AS (
			SELECT
			p.equicodi,
			MAX(p.epproycodi) AS epproycodi
			FROM
			eq_propequi p join ult_fecha_modificacion_equipo ufa on p.equicodi = ufa.equicodi and p.fechapropequi = ufa.fechapropequi
			AND p.propequideleted=0
			GROUP BY
			p.equicodi
			)
			, ult_modificador_equipo AS (
			SELECT
			p.equicodi
			,MAX(nvl(p.propequiusumodificacion,p.propequiusucreacion)) AS propequiusumodificacion
			,MAX(nvl(p.propequifecmodificacion,p.propequifeccreacion)) AS propequifecmodificacion
			FROM
			eq_propequi p
			JOIN ult_fecha_modificacion_equipo e ON p.equicodi = e.equicodi
			AND p.fechapropequi = e.fechapropequi
			AND p.propequideleted=0
			GROUP BY
			p.equicodi
			)
			,data_prop AS (
			SELECT
			pe.equicodi,
			pe.propcodi,
			pe.valor,
			pe.propequicomentario
			FROM
			eq_propequi pe
			JOIN ult_fecha_prop up ON pe.equicodi = up.equicodi
			AND pe.propcodi = up.propcodi
			AND pe.fechapropequi = up.fechapropequi
			AND pe.propequideleted=0
			)
			,eq_propiedad AS (
			SELECT
			*
			FROM
			data_prop PIVOT (
			max(valor),max(propequicomentario) as coment
			FOR propcodi
			IN (
			3421 as d2d1_id_celda
			,3441 as d3d1_id_celda
			,3461 as d4d1_id_celda
			,3481 as d2d2_id_celda
			,3501 as d3d2_id_celda
			,3521 as d3d3_id_celda
			,3541 as d4d2_id_celda
			,3561 as d4d3_id_celda
			,3581 as d4d4_id_celda

			,77 as d2d1_tension
			,830 as d3d1_tension
			,1894 as d4d1_tension
			,75 as d2d2_tension
			,831 as d3d2_tension
			,832 as d3d3_tension
			,1895 as d4d2_tension
			,1896 as d4d3_tension
			,1897 as d4d4_tension

			,72 as d2d1_capacidad_onan_mva
			,1872 as d3d1_capacidad_onan_mva
			,821 as d4d1_capacidad_onan_mva
			,824 as d2d2_capacidad_onan_mva
			,827 as d3d2_capacidad_onan_mva
			,1898 as d3d3_capacidad_onan_mva
			,1899 as d4d2_capacidad_onan_mva
			,1900 as d4d3_capacidad_onan_mva
			,1901 as d4d4_capacidad_onan_mva

			,69 as d2d1_capacidad_onaf_mva
			,74 as d3d1_capacidad_onaf_mva
			,822 as d4d1_capacidad_onaf_mva
			,825 as d2d2_capacidad_onaf_mva
			,828 as d3d2_capacidad_onaf_mva
			,1902 as d3d3_capacidad_onaf_mva
			,1903 as d4d2_capacidad_onaf_mva
			,1904 as d4d3_capacidad_onaf_mva
			,1905 as d4d4_capacidad_onaf_mva

			,3422 as d2d1_capacidad_mva
			,3462 as d3d1_capacidad_mva
			,3502 as d4d1_capacidad_mva
			,3442 as d2d2_capacidad_mva
			,3482 as d3d2_capacidad_mva
			,828 as d3d3_capacidad_mva
			,1903 as d4d2_capacidad_mva
			,1904 as d4d3_capacidad_mva
			,1905 as d4d4_capacidad_mva

			,2023 as d2d1_capacidad_a
			,3463 as d3d1_capacidad_a
			,3503 as d4d1_capacidad_a
			,3443 as d2d2_capacidad_a
			,3483 as d3d2_capacidad_a
			,3503 as d3d3_capacidad_a
			,3543 as d4d2_capacidad_a
			,3563 as d4d3_capacidad_a
			,3583 as d4d4_capacidad_a

			,3425 as d2d1_capacidad_transmision_mva
			,3445 as d3d1_capacidad_transmision_mva
			,3465 as d4d1_capacidad_transmision_mva
			,3485 as d2d2_capacidad_transmision_mva
			,3505 as d3d2_capacidad_transmision_mva
			,3525 as d3d3_capacidad_transmision_mva
			,3545 as d4d2_capacidad_transmision_mva
			,3565 as d4d3_capacidad_transmision_mva
			,3585 as d4d4_capacidad_transmision_mva

			,3424 as d2d1_capacidad_transmision_a
			,3444 as d3d1_capacidad_transmision_a
			,3464 as d4d1_capacidad_transmision_a
			,3484 as d2d2_capacidad_transmision_a
			,3504 as d3d2_capacidad_transmision_a
			,3524 as d3d3_capacidad_transmision_a
			,3544 as d4d2_capacidad_transmision_a
			,3564 as d4d3_capacidad_transmision_a
			,3584 as d4d4_capacidad_transmision_a

			,3426 as d2d1_factor_limitante_calc
			,3446 as d3d1_factor_limitante_calc
			,3466 as d4d1_factor_limitante_calc
			,3486 as d2d2_factor_limitante_calc
			,3506 as d3d2_factor_limitante_calc
			,3526 as d3d3_factor_limitante_calc
			,3546 as d4d2_factor_limitante_calc
			,3566 as d4d3_factor_limitante_calc
			,3586 as d4d4_factor_limitante_calc

			,3427 as d2d1_factor_limitante_final
			,3467 as d3d1_factor_limitante_final
			,3507 as d4d1_factor_limitante_final
			,3447 as d2d2_factor_limitante_final
			,3487 as d3d2_factor_limitante_final
			,3507 as d3d3_factor_limitante_final
			,3547 as d4d2_factor_limitante_final
			,3567 as d4d3_factor_limitante_final
			,3587 as d4d4_factor_limitante_final

			,1022 as d2_observaciones
			,1024 as d3_observaciones
			,3588 as d4_observaciones

			)
			)
			)
			,data_final as (
			SELECT
			e.equicodi as codigo_id
			,e.equiabrev as codigo
			,a.areanomb as ubicacion
			,az.areanomb as area
			,em.emprnomb as empresa
			,e.famcodi

			,case when e.famcodi = 9 then d2d1_id_celda
			when e.famcodi = 10 then d3d1_id_celda
			when e.famcodi = 47 then d4d1_id_celda
			end as d1_id_celda

			,case when e.famcodi = 9 then d2d1_tension
			when e.famcodi = 10 then d3d1_tension
			when e.famcodi = 47 then d4d1_tension
			end as d1_tension

			,case when e.famcodi = 9 then d2d1_tension_coment
			when e.famcodi = 10 then d3d1_tension_coment
			when e.famcodi = 47 then d4d1_tension_coment
			end as d1_tension_coment

			,case when e.famcodi = 9 then d2d1_capacidad_onan_mva
			when e.famcodi = 10 then d3d1_capacidad_onan_mva
			when e.famcodi = 47 then d4d1_capacidad_onan_mva
			end as d1_capacidad_onan_mva

			,case when e.famcodi = 9 then d2d1_capacidad_onan_mva_coment
			when e.famcodi = 10 then d3d1_capacidad_onan_mva_coment
			when e.famcodi = 47 then d4d1_capacidad_onan_mva_coment
			end as d1_capacidad_onan_mva_coment

			,case when e.famcodi = 9 then d2d1_capacidad_onaf_mva
			when e.famcodi = 10 then d3d1_capacidad_onaf_mva
			when e.famcodi = 47 then d4d1_capacidad_onaf_mva
			end as d1_capacidad_onaf_mva

			,case when e.famcodi = 9 then d2d1_capacidad_onaf_mva_coment
			when e.famcodi = 10 then d3d1_capacidad_onaf_mva_coment
			when e.famcodi = 47 then d4d1_capacidad_onaf_mva_coment
			end as d1_capacidad_onaf_mva_coment

			,case when e.famcodi = 9 then d2d1_capacidad_mva
			when e.famcodi = 10 then d3d1_capacidad_mva
			when e.famcodi = 47 then d4d1_capacidad_mva
			end as d1_capacidad_mva

			,case when e.famcodi = 9 then d2d1_capacidad_mva_coment
			when e.famcodi = 10 then d3d1_capacidad_mva_coment
			when e.famcodi = 47 then d4d1_capacidad_mva_coment
			end as d1_capacidad_mva_coment

			,case when e.famcodi = 9 then d2d1_capacidad_a
			when e.famcodi = 10 then d3d1_capacidad_a
			when e.famcodi = 47 then d4d1_capacidad_a
			end as d1_capacidad_a

			,case when e.famcodi = 9 then d2d1_capacidad_a_coment
			when e.famcodi = 10 then d3d1_capacidad_a_coment
			when e.famcodi = 47 then d4d1_capacidad_a_coment
			end as d1_capacidad_a_coment

			,case when e.famcodi = 9 then d2d1_factor_limitante_calc
			when e.famcodi = 10 then d3d1_factor_limitante_calc
			when e.famcodi = 47 then d4d1_factor_limitante_calc
			end as d1_factor_limitante_calc

			,case when e.famcodi = 9 then d2d1_factor_limitante_calc_coment
			when e.famcodi = 10 then d3d1_factor_limitante_calc_coment
			when e.famcodi = 47 then d4d1_factor_limitante_calc_coment
			end as d1_factor_limitante_calc_coment

			,case when e.famcodi = 9 then d2d1_factor_limitante_final
			when e.famcodi = 10 then d3d1_factor_limitante_final
			when e.famcodi = 47 then d4d1_factor_limitante_final
			end as d1_factor_limitante_final

			,case when e.famcodi = 9 then d2d1_factor_limitante_final_coment
			when e.famcodi = 10 then d3d1_factor_limitante_final_coment
			when e.famcodi = 47 then d4d1_factor_limitante_final_coment
			end as d1_factor_limitante_final_coment

			,case when e.famcodi = 9 then d2d2_id_celda
			when e.famcodi = 10 then d3d2_id_celda
			when e.famcodi = 47 then d4d2_id_celda
			end as d2_id_celda

			,case when e.famcodi = 9 then d2d2_tension
			when e.famcodi = 10 then d3d2_tension
			when e.famcodi = 47 then d4d2_tension
			end as d2_tension

			,case when e.famcodi = 9 then d2d2_tension_coment
			when e.famcodi = 10 then d3d2_tension_coment
			when e.famcodi = 47 then d4d2_tension_coment
			end as d2_tension_coment

			,case when e.famcodi = 9 then d2d2_capacidad_onan_mva
			when e.famcodi = 10 then d3d2_capacidad_onan_mva
			when e.famcodi = 47 then d4d2_capacidad_onan_mva
			end as d2_capacidad_onan_mva

			,case when e.famcodi = 9 then d2d2_capacidad_onan_mva_coment
			when e.famcodi = 10 then d3d2_capacidad_onan_mva_coment
			when e.famcodi = 47 then d4d2_capacidad_onan_mva_coment
			end as d2_capacidad_onan_mva_coment

			,case when e.famcodi = 9 then d2d2_capacidad_onaf_mva
			when e.famcodi = 10 then d3d2_capacidad_onaf_mva
			when e.famcodi = 47 then d4d2_capacidad_onaf_mva
			end as d2_capacidad_onaf_mva

			,case when e.famcodi = 9 then d2d2_capacidad_onaf_mva_coment
			when e.famcodi = 10 then d3d2_capacidad_onaf_mva_coment
			when e.famcodi = 47 then d4d2_capacidad_onaf_mva_coment
			end as d2_capacidad_onaf_mva_coment

			,case when e.famcodi = 9 then d2d2_capacidad_mva
			when e.famcodi = 10 then d3d2_capacidad_mva
			when e.famcodi = 47 then d4d2_capacidad_mva
			end as d2_capacidad_mva

			,case when e.famcodi = 9 then d2d2_capacidad_mva_coment
			when e.famcodi = 10 then d3d2_capacidad_mva_coment
			when e.famcodi = 47 then d4d2_capacidad_mva_coment
			end as d2_capacidad_mva_coment

			,case when e.famcodi = 9 then d2d2_capacidad_a
			when e.famcodi = 10 then d3d2_capacidad_a
			when e.famcodi = 47 then d4d2_capacidad_a
			end as d2_capacidad_a

			,case when e.famcodi = 9 then d2d2_capacidad_a_coment
			when e.famcodi = 10 then d3d2_capacidad_a_coment
			when e.famcodi = 47 then d4d2_capacidad_a_coment
			end as d2_capacidad_a_coment

			,case when e.famcodi = 9 then d2d2_factor_limitante_calc
			when e.famcodi = 10 then d3d2_factor_limitante_calc
			when e.famcodi = 47 then d4d2_factor_limitante_calc
			end as d2_factor_limitante_calc

			,case when e.famcodi = 9 then d2d2_factor_limitante_calc_coment
			when e.famcodi = 10 then d3d2_factor_limitante_calc_coment
			when e.famcodi = 47 then d4d2_factor_limitante_calc_coment
			end as d2_factor_limitante_calc_coment

			,case when e.famcodi = 9 then d2d2_factor_limitante_final
			when e.famcodi = 10 then d3d2_factor_limitante_final
			when e.famcodi = 47 then d4d2_factor_limitante_final
			end as d2_factor_limitante_final

			,case when e.famcodi = 9 then d2d2_factor_limitante_final_coment
			when e.famcodi = 10 then d3d2_factor_limitante_final_coment
			when e.famcodi = 47 then d4d2_factor_limitante_final_coment
			end as d2_factor_limitante_final_coment


			,case when e.famcodi = 9 then null
			when e.famcodi = 10 then d3d3_id_celda
			when e.famcodi = 47 then d4d3_id_celda
			end as d3_id_celda

			,case when e.famcodi = 9 then null
			when e.famcodi = 10 then d3d3_tension
			when e.famcodi = 47 then d4d3_tension
			end as d3_tension

			,case when e.famcodi = 9 then null
			when e.famcodi = 10 then d3d3_tension_coment
			when e.famcodi = 47 then d4d3_tension_coment
			end as d3_tension_coment

			,case when e.famcodi = 9 then null
			when e.famcodi = 10 then d3d3_capacidad_onan_mva
			when e.famcodi = 47 then d4d3_capacidad_onan_mva
			end as d3_capacidad_onan_mva

			,case when e.famcodi = 9 then null
			when e.famcodi = 10 then d3d3_capacidad_onan_mva_coment
			when e.famcodi = 47 then d4d3_capacidad_onan_mva_coment
			end as d3_capacidad_onan_mva_coment

			,case when e.famcodi = 9 then null
			when e.famcodi = 10 then d3d3_capacidad_onaf_mva
			when e.famcodi = 47 then d4d3_capacidad_onaf_mva
			end as d3_capacidad_onaf_mva

			,case when e.famcodi = 9 then null
			when e.famcodi = 10 then d3d3_capacidad_onaf_mva_coment
			when e.famcodi = 47 then d4d3_capacidad_onaf_mva_coment
			end as d3_capacidad_onaf_mva_coment

			,case when e.famcodi = 9 then null
			when e.famcodi = 10 then d3d3_capacidad_mva
			when e.famcodi = 47 then d4d3_capacidad_mva
			end as d3_capacidad_mva

			,case when e.famcodi = 9 then null
			when e.famcodi = 10 then d3d3_capacidad_mva_coment
			when e.famcodi = 47 then d4d3_capacidad_mva_coment
			end as d3_capacidad_mva_coment

			,case when e.famcodi = 9 then null
			when e.famcodi = 10 then d3d3_capacidad_a
			when e.famcodi = 47 then d4d3_capacidad_a
			end as d3_capacidad_a

			,case when e.famcodi = 9 then null
			when e.famcodi = 10 then d3d3_capacidad_a_coment
			when e.famcodi = 47 then d4d3_capacidad_a_coment
			end as d3_capacidad_a_coment

			,case when e.famcodi = 9 then null
			when e.famcodi = 10 then d3d3_factor_limitante_calc
			when e.famcodi = 47 then d4d3_factor_limitante_calc
			end as d3_factor_limitante_calc

			,case when e.famcodi = 9 then null
			when e.famcodi = 10 then d3d3_factor_limitante_calc_coment
			when e.famcodi = 47 then d4d3_factor_limitante_calc_coment
			end as d3_factor_limitante_calc_coment

			,case when e.famcodi = 9 then null
			when e.famcodi = 10 then d3d3_factor_limitante_final
			when e.famcodi = 47 then d4d3_factor_limitante_final
			end as d3_factor_limitante_final

			,case when e.famcodi = 9 then null
			when e.famcodi = 10 then d3d3_factor_limitante_final_coment
			when e.famcodi = 47 then d4d3_factor_limitante_final_coment
			end as d3_factor_limitante_final_coment

			,case when e.famcodi = 9 then null
			when e.famcodi = 10 then null
			when e.famcodi = 47 then d4d4_id_celda
			end as d4_id_celda

			,case when e.famcodi = 9 then null
			when e.famcodi = 10 then null
			when e.famcodi = 47 then d4d4_tension
			end as d4_tension

			,case when e.famcodi = 9 then null
			when e.famcodi = 10 then null
			when e.famcodi = 47 then d4d4_tension_coment
			end as d4_tension_coment

			,case when e.famcodi = 9 then null
			when e.famcodi = 10 then null
			when e.famcodi = 47 then d4d4_capacidad_onan_mva
			end as d4_capacidad_onan_mva

			,case when e.famcodi = 9 then null
			when e.famcodi = 10 then null
			when e.famcodi = 47 then d4d4_capacidad_onan_mva_coment
			end as d4_capacidad_onan_mva_coment

			,case when e.famcodi = 9 then null
			when e.famcodi = 10 then null
			when e.famcodi = 47 then d4d4_capacidad_onaf_mva
			end as d4_capacidad_onaf_mva

			,case when e.famcodi = 9 then null
			when e.famcodi = 10 then null
			when e.famcodi = 47 then d4d4_capacidad_onaf_mva_coment
			end as d4_capacidad_onaf_mva_coment

			,case when e.famcodi = 9 then null
			when e.famcodi = 10 then null
			when e.famcodi = 47 then d4d4_capacidad_mva
			end as d4_capacidad_mva

			,case when e.famcodi = 9 then null
			when e.famcodi = 10 then null
			when e.famcodi = 47 then d4d4_capacidad_mva_coment
			end as d4_capacidad_mva_coment

			,case when e.famcodi = 9 then null
			when e.famcodi = 10 then null
			when e.famcodi = 47 then d4d4_capacidad_a
			end as d4_capacidad_a

			,case when e.famcodi = 9 then null
			when e.famcodi = 10 then null
			when e.famcodi = 47 then d4d4_capacidad_a_coment
			end as d4_capacidad_a_coment

			,case when e.famcodi = 9 then null
			when e.famcodi = 10 then null
			when e.famcodi = 47 then d4d4_factor_limitante_calc
			end as d4_factor_limitante_calc

			,case when e.famcodi = 9 then null
			when e.famcodi = 10 then null
			when e.famcodi = 47 then d4d4_factor_limitante_calc_coment
			end as d4_factor_limitante_calc_coment

			,case when e.famcodi = 9 then null
			when e.famcodi = 10 then null
			when e.famcodi = 47 then d4d4_factor_limitante_final
			end as d4_factor_limitante_final

			,case when e.famcodi = 9 then null
			when e.famcodi = 10 then null
			when e.famcodi = 47 then d4d4_factor_limitante_final_coment
			end as d4_factor_limitante_final_coment

			,case when e.famcodi = 9 then d2_observaciones
			when e.famcodi = 10 then d3_observaciones
			when e.famcodi = 47 then d4_observaciones
			end as observaciones

			,case when proy.epproycodi is not null then trim(proy.epproynemotecnico)||':'||trim(proy.epproynomb) end as motivo
			,uum.propequiusumodificacion as actualizado_por
			,TO_CHAR(uum.propequifecmodificacion, 'DD/MM/YYYY HH24:MI') as actualizado_el
			FROM
			eq_propiedad p
			JOIN equipo e ON p.equicodi = e.equicodi
			JOIN ult_fecha_modificacion_equipo ufm ON p.equicodi = ufm.equicodi
			JOIN ult_modificador_equipo uum ON p.equicodi = uum.equicodi
			JOIN ult_proy_act_equipo upa on p.equicodi = upa.equicodi
			LEFT JOIN eq_area a on e.areacodi = a.areacodi
			LEFT JOIN eq_area az on e.areacodizona = az.areacodi
			LEFT JOIN si_empresa em on e.emprcodi = em.emprcodi
			LEFT JOIN eq_prop_catalogo_data es ON eqcatccodi = 6 and e.equiestado = es.eqcatdabrev
			LEFT JOIN epr_proyecto_acteqp proy on upa.epproycodi = proy.epproycodi

			)
			select codigo_id
			,codigo
			,ubicacion
			,area
			,empresa
			,df.famcodi
			,d1_id_celda
			,ecd1.equinomb as d1_codigo_celda
			,acd1.areanomb as d1_ubicacion_celda
			,d1_tension
			,d1_tension_coment
			,d1_capacidad_onan_mva
			,d1_capacidad_onan_mva_coment
			,d1_capacidad_onaf_mva
			,d1_capacidad_onaf_mva_coment
			,d1_capacidad_mva
			,d1_capacidad_mva_coment
			,d1_capacidad_a
			,d1_capacidad_a_coment
			,pkg_protecciones.fn_get_celda_posicion_nucleo_tc(d1_id_celda) as d1_posicion_nucleo_tc
			,pkg_protecciones.fn_get_celda_pick_up(d1_id_celda) as d1_pick_up
			,d1_factor_limitante_calc
			,d1_factor_limitante_calc_coment
			,d1_factor_limitante_final
			,d1_factor_limitante_final_coment

			,d2_id_celda
			,ecd2.equinomb as d2_codigo_celda
			,acd2.areanomb as d2_ubicacion_celda
			,d2_tension
			,d2_tension_coment
			,d2_capacidad_onan_mva
			,d2_capacidad_onan_mva_coment
			,d2_capacidad_onaf_mva
			,d2_capacidad_onaf_mva_coment
			,d2_capacidad_mva
			,d2_capacidad_mva_coment
			,d2_capacidad_a
			,d2_capacidad_a_coment
			,pkg_protecciones.fn_get_celda_posicion_nucleo_tc(d2_id_celda) as d2_posicion_nucleo_tc
			,pkg_protecciones.fn_get_celda_pick_up(d2_id_celda) as d2_pick_up
			,d2_factor_limitante_calc
			,d2_factor_limitante_calc_coment
			,d2_factor_limitante_final
			,d2_factor_limitante_final_coment


			,d3_id_celda
			,ecd3.equinomb as d3_codigo_celda
			,acd3.areanomb as d3_ubicacion_celda
			,d3_tension
			,d3_tension_coment
			,d3_capacidad_onan_mva
			,d3_capacidad_onan_mva_coment
			,d3_capacidad_onaf_mva
			,d3_capacidad_onaf_mva_coment
			,d3_capacidad_mva
			,d3_capacidad_mva_coment
			,d3_capacidad_a
			,d3_capacidad_a_coment
			,pkg_protecciones.fn_get_celda_posicion_nucleo_tc(d3_id_celda) as d3_posicion_nucleo_tc
			,pkg_protecciones.fn_get_celda_pick_up(d3_id_celda) as d3_pick_up
			,d3_factor_limitante_calc
			,d3_factor_limitante_calc_coment
			,d3_factor_limitante_final
			,d3_factor_limitante_final_coment

			,d4_id_celda
			,ecd4.equinomb as d4_codigo_celda
			,acd4.areanomb as d4_ubicacion_celda
			,d4_tension
			,d4_tension_coment
			,d4_capacidad_onan_mva
			,d4_capacidad_onan_mva_coment
			,d4_capacidad_onaf_mva
			,d4_capacidad_onaf_mva_coment
			,d4_capacidad_mva
			,d4_capacidad_mva_coment
			,d4_capacidad_a
			,d4_capacidad_a_coment
			,pkg_protecciones.fn_get_celda_posicion_nucleo_tc(d4_id_celda) as d4_posicion_nucleo_tc
			,pkg_protecciones.fn_get_celda_pick_up(d4_id_celda) as d4_pick_up
			,d4_factor_limitante_calc
			,d4_factor_limitante_calc_coment
			,d4_factor_limitante_final
			,d4_factor_limitante_final_coment
			,df.observaciones
			,df.motivo
			,df.actualizado_por as usuario_auditoria
			,df.actualizado_el as fecha_modificacion

			from data_final df
			LEFT JOIN eq_equipo ecd1 ON to_number(df.d1_id_celda default 0 on conversion error) = ecd1.equicodi
			LEFT JOIN eq_area acd1 on ecd1.areacodi = acd1.areacodi
			LEFT JOIN eq_equipo ecd2 ON to_number(df.d2_id_celda default 0 on conversion error) = ecd2.equicodi
			LEFT JOIN eq_area acd2 on ecd1.areacodi = acd2.areacodi
			LEFT JOIN eq_equipo ecd3 ON to_number(df.d3_id_celda default 0 on conversion error) = ecd3.equicodi
			LEFT JOIN eq_area acd3 on ecd3.areacodi = acd3.areacodi
			LEFT JOIN eq_equipo ecd4 ON to_number(df.d4_id_celda default 0 on conversion error) = ecd4.equicodi
			LEFT JOIN eq_area acd4 on ecd4.areacodi = acd4.areacodi

			where ( nvl({8}, 0) = 0 OR upper(d1_tension||'-'||d2_tension||'-'||d3_tension||'-'||d4_tension) LIKE '%'|| {8}|| '%' )
		</query>
	</Sql>
	
</Sqls>
