<?xml version="1.0" encoding="utf-8" ?>
<Sqls>
  <Sql>
    <key>Delete</key>
    <query>
      TRUNCATE TABLE IIO_TMP_CONSUMO
    </query>
  </Sql>

  <Sql>
    <key>DeleteMeMedicion96</key>
    <query>
      DELETE FROM ME_MEDICION96
      WHERE LECTCODI = {0} AND TIPOINFOCODI = {1}
      AND PTOMEDICODI IN (SELECT PTOMEDICODI FROM IIO_TMP_CONSUMO WHERE PTOMEDICODI IS NOT NULL)
      AND MEDIFECHA BETWEEN TO_DATE('{2}','YYYYMM') AND LAST_DAY(TO_DATE('{2}','YYYYMM'))
    </query>
  </Sql>

<!-- alpha.HDT - Inicio 19/10/2017: Se ha añadido la condición del estado y del origen de lectura. -->
  <Sql>
    <key>UpdateTmpConsumo</key>
    <query>
      UPDATE IIO_TMP_CONSUMO tmp
      SET tmp.PTOMEDICODI = (
      SELECT pto.PTOMEDICODI
      FROM ME_PTOMEDICION pto
      , EQ_EQUIPO eqp
      WHERE pto.EQUICODI = eqp.EQUICODI
      AND eqp.FAMCODI = 45
      AND eqp.EQUIESTADO IN ('A', 'B')
      AND eqp.OSINERGCODI = tmp.SUMUCODI
	  AND pto.ORIGLECTCODI = 19
	  AND pto.PTOMEDIESTADO = 'A'
      )
    </query>
  </Sql>

  <Sql>
    <key>GetSumucodi</key>
    <query>
      SELECT DISTINCT SUMUCODI FROM IIO_TMP_CONSUMO WHERE PTOMEDICODI IS NULL
    </query>
  </Sql>

  <Sql>
    <key>SaveMedicion96</key>
    <query>
      INSERT INTO ME_MEDICION96(LECTCODI,MEDIFECHA,TIPOINFOCODI,PTOMEDICODI, MEDITOTAL,H1, H2, H3, H4, H5, H6, H7, H8, H9, H10, H11, H12, H13, H14, H15, H16, H17, H18, H19, H20, H21, H22, H23, H24, H25, H26, H27, H28, H29, H30, H31, H32, H33, H34, H35, H36, H37, H38, H39, H40, H41, H42, H43, H44, H45, H46, H47, H48, H49, H50, H51, H52, H53, H54, H55, H56, H57, H58, H59, H60, H61, H62, H63, H64, H65, H66, H67, H68, H69, H70, H71, H72, H73, H74, H75, H76, H77, H78, H79, H80, H81, H82, H83, H84, H85, H86, H87, H88, H89, H90, H91, H92, H93, H94, H95)
      SELECT {0},TRUNC(UCONFECHA),{1},PTOMEDICODI, 0
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='00:15' THEN UCONENERGACTV*4/1000 END) H1
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='00:30' THEN UCONENERGACTV*4/1000 END) H2
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='00:45' THEN UCONENERGACTV*4/1000 END) H3
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='01:00' THEN UCONENERGACTV*4/1000 END) H4
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='01:15' THEN UCONENERGACTV*4/1000 END) H5
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='01:30' THEN UCONENERGACTV*4/1000 END) H6
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='01:45' THEN UCONENERGACTV*4/1000 END) H7
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='02:00' THEN UCONENERGACTV*4/1000 END) H8
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='02:15' THEN UCONENERGACTV*4/1000 END) H9
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='02:30' THEN UCONENERGACTV*4/1000 END) H10
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='02:45' THEN UCONENERGACTV*4/1000 END) H11
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='03:00' THEN UCONENERGACTV*4/1000 END) H12
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='03:15' THEN UCONENERGACTV*4/1000 END) H13
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='03:30' THEN UCONENERGACTV*4/1000 END) H14
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='03:45' THEN UCONENERGACTV*4/1000 END) H15
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='04:00' THEN UCONENERGACTV*4/1000 END) H16
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='04:15' THEN UCONENERGACTV*4/1000 END) H17
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='04:30' THEN UCONENERGACTV*4/1000 END) H18
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='04:45' THEN UCONENERGACTV*4/1000 END) H19
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='05:00' THEN UCONENERGACTV*4/1000 END) H20
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='05:15' THEN UCONENERGACTV*4/1000 END) H21
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='05:30' THEN UCONENERGACTV*4/1000 END) H22
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='05:45' THEN UCONENERGACTV*4/1000 END) H23
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='06:00' THEN UCONENERGACTV*4/1000 END) H24
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='06:15' THEN UCONENERGACTV*4/1000 END) H25
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='06:30' THEN UCONENERGACTV*4/1000 END) H26
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='06:45' THEN UCONENERGACTV*4/1000 END) H27
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='07:00' THEN UCONENERGACTV*4/1000 END) H28
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='07:15' THEN UCONENERGACTV*4/1000 END) H29
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='07:30' THEN UCONENERGACTV*4/1000 END) H30
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='07:45' THEN UCONENERGACTV*4/1000 END) H31
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='08:00' THEN UCONENERGACTV*4/1000 END) H32
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='08:15' THEN UCONENERGACTV*4/1000 END) H33
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='08:30' THEN UCONENERGACTV*4/1000 END) H34
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='08:45' THEN UCONENERGACTV*4/1000 END) H35
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='09:00' THEN UCONENERGACTV*4/1000 END) H36
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='09:15' THEN UCONENERGACTV*4/1000 END) H37
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='09:30' THEN UCONENERGACTV*4/1000 END) H38
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='09:45' THEN UCONENERGACTV*4/1000 END) H39
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='10:00' THEN UCONENERGACTV*4/1000 END) H40
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='10:15' THEN UCONENERGACTV*4/1000 END) H41
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='10:30' THEN UCONENERGACTV*4/1000 END) H42
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='10:45' THEN UCONENERGACTV*4/1000 END) H43
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='11:00' THEN UCONENERGACTV*4/1000 END) H44
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='11:15' THEN UCONENERGACTV*4/1000 END) H45
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='11:30' THEN UCONENERGACTV*4/1000 END) H46
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='11:45' THEN UCONENERGACTV*4/1000 END) H47
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='12:00' THEN UCONENERGACTV*4/1000 END) H48
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='12:15' THEN UCONENERGACTV*4/1000 END) H49
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='12:30' THEN UCONENERGACTV*4/1000 END) H50
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='12:45' THEN UCONENERGACTV*4/1000 END) H51
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='13:00' THEN UCONENERGACTV*4/1000 END) H52
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='13:15' THEN UCONENERGACTV*4/1000 END) H53
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='13:30' THEN UCONENERGACTV*4/1000 END) H54
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='13:45' THEN UCONENERGACTV*4/1000 END) H55
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='14:00' THEN UCONENERGACTV*4/1000 END) H56
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='14:15' THEN UCONENERGACTV*4/1000 END) H57
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='14:30' THEN UCONENERGACTV*4/1000 END) H58
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='14:45' THEN UCONENERGACTV*4/1000 END) H59
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='15:00' THEN UCONENERGACTV*4/1000 END) H60
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='15:15' THEN UCONENERGACTV*4/1000 END) H61
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='15:30' THEN UCONENERGACTV*4/1000 END) H62
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='15:45' THEN UCONENERGACTV*4/1000 END) H63
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='16:00' THEN UCONENERGACTV*4/1000 END) H64
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='16:15' THEN UCONENERGACTV*4/1000 END) H65
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='16:30' THEN UCONENERGACTV*4/1000 END) H66
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='16:45' THEN UCONENERGACTV*4/1000 END) H67
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='17:00' THEN UCONENERGACTV*4/1000 END) H68
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='17:15' THEN UCONENERGACTV*4/1000 END) H69
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='17:30' THEN UCONENERGACTV*4/1000 END) H70
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='17:45' THEN UCONENERGACTV*4/1000 END) H71
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='18:00' THEN UCONENERGACTV*4/1000 END) H72
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='18:15' THEN UCONENERGACTV*4/1000 END) H73
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='18:30' THEN UCONENERGACTV*4/1000 END) H74
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='18:45' THEN UCONENERGACTV*4/1000 END) H75
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='19:00' THEN UCONENERGACTV*4/1000 END) H76
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='19:15' THEN UCONENERGACTV*4/1000 END) H77
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='19:30' THEN UCONENERGACTV*4/1000 END) H78
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='19:45' THEN UCONENERGACTV*4/1000 END) H79
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='20:00' THEN UCONENERGACTV*4/1000 END) H80
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='20:15' THEN UCONENERGACTV*4/1000 END) H81
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='20:30' THEN UCONENERGACTV*4/1000 END) H82
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='20:45' THEN UCONENERGACTV*4/1000 END) H83
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='21:00' THEN UCONENERGACTV*4/1000 END) H84
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='21:15' THEN UCONENERGACTV*4/1000 END) H85
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='21:30' THEN UCONENERGACTV*4/1000 END) H86
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='21:45' THEN UCONENERGACTV*4/1000 END) H87
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='22:00' THEN UCONENERGACTV*4/1000 END) H88
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='22:15' THEN UCONENERGACTV*4/1000 END) H89
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='22:30' THEN UCONENERGACTV*4/1000 END) H90
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='22:45' THEN UCONENERGACTV*4/1000 END) H91
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='23:00' THEN UCONENERGACTV*4/1000 END) H92
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='23:15' THEN UCONENERGACTV*4/1000 END) H93
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='23:30' THEN UCONENERGACTV*4/1000 END) H94
      ,MAX(CASE WHEN TO_CHAR(UCONFECHA,'HH24:MI')='23:45' THEN UCONENERGACTV*4/1000 END) H95
      FROM IIO_TMP_CONSUMO
      WHERE 1 = 1 AND  TO_CHAR(UCONFECHA, 'YYYYMM') = '{2}'
      AND PTOMEDICODI IS NOT NULL
      GROUP BY TRUNC(UCONFECHA),PTOMEDICODI
      ORDER BY 2
    </query>
  </Sql>

  <Sql>
    <key>UpdateH96</key>
    <query>
      UPDATE ME_MEDICION96 SET H96 = (SELECT UCONENERGACTV*4/1000 FROM IIO_TMP_CONSUMO T WHERE ME_MEDICION96.PTOMEDICODI = T.PTOMEDICODI AND ME_MEDICION96.MEDIFECHA = (TRUNC(T.UCONFECHA)-1) AND TO_CHAR(T.UCONFECHA,'HH24:MI')='00:00')
      WHERE LECTCODI ={0} AND TIPOINFOCODI = {1}
      AND PTOMEDICODI IN (SELECT PTOMEDICODI FROM IIO_TMP_CONSUMO WHERE PTOMEDICODI IS NOT NULL)
      AND MEDIFECHA BETWEEN TO_DATE('{2}','YYYYMM') AND LAST_DAY(TO_DATE('{2}','YYYYMM'))
    </query>
  </Sql>
  
</Sqls>
