<?xml version="1.0" encoding="utf-8" ?>
<Sqls>

  <Sql>
    <key>GetMaxId</key>
    <query>
      select nvl(max(dmelibcodi),0) from me_demanda_mlibre
    </query>
  </Sql>
  
  <Sql>
    <key>Save</key>
    <query>
      INSERT INTO ME_DEMANDA_MLIBRE(DMELIBCODI,DMELIBPERIODO,DMELIBFECMAXDEM,EMPRCODI,EQUICODI,DMELIBFUENTE,
      DMELIBH1,DMELIBH2,DMELIBH3,DMELIBH4,DMELIBH5,DMELIBH6,DMELIBH7,DMELIBH8,DMELIBH9,DMELIBH10,DMELIBH11,DMELIBH12,
      DMELIBH13,DMELIBH14,DMELIBH15,DMELIBH16,DMELIBH17,DMELIBH18,DMELIBH19,DMELIBH20,DMELIBH21,DMELIBH22,DMELIBH23,DMELIBH24,
      DMELIBH25,DMELIBH26,DMELIBH27,DMELIBH28,DMELIBH29,DMELIBH30,DMELIBH31,DMELIBH32,DMELIBH33,DMELIBH34,DMELIBH35,DMELIBH36,
      DMELIBH37,DMELIBH38,DMELIBH39,DMELIBH40,DMELIBH41,DMELIBH42,DMELIBH43,DMELIBH44,DMELIBH45,DMELIBH46,DMELIBH47,DMELIBH48,
      DMELIBH49,DMELIBH50,DMELIBH51,DMELIBH52,DMELIBH53,DMELIBH54,DMELIBH55,DMELIBH56,DMELIBH57,DMELIBH58,DMELIBH59,DMELIBH60,
      DMELIBH61,DMELIBH62,DMELIBH63,DMELIBH64,DMELIBH65,DMELIBH66,DMELIBH67,DMELIBH68,DMELIBH69,DMELIBH70,DMELIBH71,DMELIBH72,
      DMELIBH73,DMELIBH74,DMELIBH75,DMELIBH76,DMELIBH77,DMELIBH78,DMELIBH79,DMELIBH80,DMELIBH81,DMELIBH82,DMELIBH83,DMELIBH84,
      DMELIBH85,DMELIBH86,DMELIBH87,DMELIBH88,DMELIBH89,DMELIBH90,DMELIBH91,DMELIBH92,DMELIBH93,DMELIBH94,DMELIBH95,DMELIBH96,
      DMELIBUSUCREACION,DMELIBFECCREACION,PTOMEDICODI)

      SELECT ROWNUM + {0}, '{1}', TO_DATE('{2}','DD/MM/YYYY'), FAC.EMPRCODI,EQ.EQUICODI,'SICLI.OSINERGMIN - '||TO_CHAR('{3}'),
      H1,H2,H3,H4,H5,H6,H7,H8,H9,H10,H11,H12,
      H13,H14,H15,H16,H17,H18,H19,H20,H21,H22,H23,H24,
      H25,H26,H27,H28,H29,H30,H31,H32,H33,H34,H35,H36,
      H37,H38,H39,H40,H41,H42,H43,H44,H45,H46,H47,H48,
      H49,H50,H51,H52,H53,H54,H55,H56,H57,H58,H59,H60,
      H61,H62,H63,H64,H65,H66,H67,H68,H69,H70,H71,H72,
      H73,H74,H75,H76,H77,H78,H79,H80,H81,H82,H83,H84,
      H85,H86,H87,H88,H89,H90,H91,H92,H93,H94,H95,H96,
      '{4}',SYSDATE,ME.PTOMEDICODI
      FROM ME_MEDICION96 ME JOIN ME_PTOMEDICION PTO ON ME.PTOMEDICODI = PTO.PTOMEDICODI
      JOIN EQ_EQUIPO EQ ON PTO.EQUICODI = EQ.EQUICODI
      JOIN IIO_FACTURA FAC ON PTO.PTOMEDICODI = FAC.PTOMEDICODI AND FAC.UFACMESFACTURADO = {5}
      WHERE ME.LECTCODI = 53
      AND ME.MEDIFECHA = TO_DATE('{3}','DD/MM/YYYY')
    </query>
  </Sql>
  
  <Sql>
    <key>Delete</key>
    <query>
      delete from me_demanda_mlibre
      where
      dmelibperiodo = :dmelibperiodo
    </query>
  </Sql>
 

  <Sql>
    <key>ObtenerReporteDemandaMercadoLibre</key>
    <query>
      SELECT ext.* FROM (
      SELECT ROWNUM as item, QD.*
      FROM (

      SELECT ME.DMELIBPERIODO, ME.DMELIBFECMAXDEM,ME.DMELIBFUENTE, EQ.OSINERGCODI,EMP.EMPRNOMB AS SUMINISTRADOR,ECL.EMPRRUC,EQ.EQUINOMB AS NOMBRE_SICLI,
      NVL(ECL.EMPRRAZSOCIAL,ECL.EMPRNOMB) AS RAZONSOCIAL,AR.AREANOMB,EQ.EQUITENSION
      ,DMELIBH1,DMELIBH2,DMELIBH3,DMELIBH4,DMELIBH5,DMELIBH6,DMELIBH7,DMELIBH8,DMELIBH9,DMELIBH10,DMELIBH11,DMELIBH12,
      DMELIBH13,DMELIBH14,DMELIBH15,DMELIBH16,DMELIBH17,DMELIBH18,DMELIBH19,DMELIBH20,DMELIBH21,DMELIBH22,DMELIBH23,DMELIBH24,
      DMELIBH25,DMELIBH26,DMELIBH27,DMELIBH28,DMELIBH29,DMELIBH30,DMELIBH31,DMELIBH32,DMELIBH33,DMELIBH34,DMELIBH35,DMELIBH36,
      DMELIBH37,DMELIBH38,DMELIBH39,DMELIBH40,DMELIBH41,DMELIBH42,DMELIBH43,DMELIBH44,DMELIBH45,DMELIBH46,DMELIBH47,DMELIBH48,
      DMELIBH49,DMELIBH50,DMELIBH51,DMELIBH52,DMELIBH53,DMELIBH54,DMELIBH55,DMELIBH56,DMELIBH57,DMELIBH58,DMELIBH59,DMELIBH60,
      DMELIBH61,DMELIBH62,DMELIBH63,DMELIBH64,DMELIBH65,DMELIBH66,DMELIBH67,DMELIBH68,DMELIBH69,DMELIBH70,DMELIBH71,DMELIBH72,
      DMELIBH73,DMELIBH74,DMELIBH75,DMELIBH76,DMELIBH77,DMELIBH78,DMELIBH79,DMELIBH80,DMELIBH81,DMELIBH82,DMELIBH83,DMELIBH84,
      DMELIBH85,DMELIBH86,DMELIBH87,DMELIBH88,DMELIBH89,DMELIBH90,DMELIBH91,DMELIBH92,DMELIBH93,DMELIBH94,DMELIBH95,DMELIBH96
      FROM ME_DEMANDA_MLIBRE ME LEFT JOIN EQ_EQUIPO EQ ON ME.EQUICODI = EQ.EQUICODI
      LEFT JOIN SI_EMPRESA EMP ON ME.EMPRCODI = EMP.EMPRCODI
      LEFT JOIN SI_EMPRESA ECL ON EQ.EMPRCODI = ECL.EMPRCODI
      LEFT JOIN EQ_AREA AR ON EQ.AREACODI = AR.AREACODI
      {0}
      ORDER BY 4,5,3
      )QD
      WHERE ROWNUM &#60;= {1}
      ) ext
      WHERE ext.item >= {2}
    </query>
  </Sql>
  <Sql>
    <key>ObtenerReporteDemandaMercadoLibreCount</key>
    <query>

      SELECT NVL(COUNT(ME.DMELIBCODI),0) AS Q_REGISTROS
      FROM ME_DEMANDA_MLIBRE ME LEFT JOIN EQ_EQUIPO EQ ON ME.EQUICODI = EQ.EQUICODI
      LEFT JOIN SI_EMPRESA EMP ON ME.EMPRCODI = EMP.EMPRCODI
      LEFT JOIN SI_EMPRESA ECL ON EQ.EMPRCODI = ECL.EMPRCODI
      LEFT JOIN EQ_AREA AR ON EQ.AREACODI = AR.AREACODI
      {0}       

    </query>
  </Sql>
  <Sql>
    <key>Update</key>
    <query>
      UPDATE ME_DEMANDA_MLIBRE SET (DMELIBH1,DMELIBH2,DMELIBH3,DMELIBH4,DMELIBH5,DMELIBH6,DMELIBH7,DMELIBH8,DMELIBH9,DMELIBH10,DMELIBH11,DMELIBH12,
      DMELIBH13,DMELIBH14,DMELIBH15,DMELIBH16,DMELIBH17,DMELIBH18,DMELIBH19,DMELIBH20,DMELIBH21,DMELIBH22,DMELIBH23,DMELIBH24,
      DMELIBH25,DMELIBH26,DMELIBH27,DMELIBH28,DMELIBH29,DMELIBH30,DMELIBH31,DMELIBH32,DMELIBH33,DMELIBH34,DMELIBH35,DMELIBH36,
      DMELIBH37,DMELIBH38,DMELIBH39,DMELIBH40,DMELIBH41,DMELIBH42,DMELIBH43,DMELIBH44,DMELIBH45,DMELIBH46,DMELIBH47,DMELIBH48,
      DMELIBH49,DMELIBH50,DMELIBH51,DMELIBH52,DMELIBH53,DMELIBH54,DMELIBH55,DMELIBH56,DMELIBH57,DMELIBH58,DMELIBH59,DMELIBH60,
      DMELIBH61,DMELIBH62,DMELIBH63,DMELIBH64,DMELIBH65,DMELIBH66,DMELIBH67,DMELIBH68,DMELIBH69,DMELIBH70,DMELIBH71,DMELIBH72,
      DMELIBH73,DMELIBH74,DMELIBH75,DMELIBH76,DMELIBH77,DMELIBH78,DMELIBH79,DMELIBH80,DMELIBH81,DMELIBH82,DMELIBH83,DMELIBH84,
      DMELIBH85,DMELIBH86,DMELIBH87,DMELIBH88,DMELIBH89,DMELIBH90,DMELIBH91,DMELIBH92,DMELIBH93,DMELIBH94,DMELIBH95,DMELIBH96,
      DMELIBFUENTE,DMELIBUSUMODIFICACION,DMELIBFECMODIFICACION) = (SELECT H1,H2,H3,H4,H5,H6,H7,H8,H9,H10,H11,H12,
      H13,H14,H15,H16,H17,H18,H19,H20,H21,H22,H23,H24,
      H25,H26,H27,H28,H29,H30,H31,H32,H33,H34,H35,H36,
      H37,H38,H39,H40,H41,H42,H43,H44,H45,H46,H47,H48,
      H49,H50,H51,H52,H53,H54,H55,H56,H57,H58,H59,H60,
      H61,H62,H63,H64,H65,H66,H67,H68,H69,H70,H71,H72,
      H73,H74,H75,H76,H77,H78,H79,H80,H81,H82,H83,H84,
      H85,H86,H87,H88,H89,H90,H91,H92,H93,H94,H95,H96,
      'CUMPLIO.PR16 - '||TO_CHAR(ME.MEDIFECHA,'DD/MM/YYYY'),'{0}', SYSDATE
      FROM ME_MEDICION96 ME JOIN ME_PTOMEDICION PTO ON ME.PTOMEDICODI = PTO.PTOMEDICODI
      WHERE ME.LECTCODI = 52 AND ME_DEMANDA_MLIBRE.DMELIBFECMAXDEM = ME.MEDIFECHA AND ME_DEMANDA_MLIBRE.PTOMEDICODI = ME.PTOMEDICODI)
      WHERE DMELIBPERIODO = {1}
      AND EXISTS (SELECT 1 FROM ME_MEDICION96 ME JOIN ME_PTOMEDICION PTO ON ME.PTOMEDICODI = PTO.PTOMEDICODI
      WHERE ME.LECTCODI = 52 AND ME_DEMANDA_MLIBRE.DMELIBFECMAXDEM = ME.MEDIFECHA AND ME_DEMANDA_MLIBRE.PTOMEDICODI = ME.PTOMEDICODI )
    </query>
  </Sql>

  <Sql>
    <key>ObtenerReporteDemandaMercadoLibreExcel</key>
    <query>
      SELECT ME.DMELIBPERIODO, ME.DMELIBFECMAXDEM,ME.DMELIBFUENTE, EQ.OSINERGCODI,EMP.EMPRNOMB AS SUMINISTRADOR,ECL.EMPRRUC,EQ.EQUINOMB AS NOMBRE_SICLI,
      NVL(ECL.EMPRRAZSOCIAL,ECL.EMPRNOMB) AS RAZONSOCIAL,AR.AREANOMB,EQ.EQUITENSION
      ,DMELIBH1,DMELIBH2,DMELIBH3,DMELIBH4,DMELIBH5,DMELIBH6,DMELIBH7,DMELIBH8,DMELIBH9,DMELIBH10,DMELIBH11,DMELIBH12,
      DMELIBH13,DMELIBH14,DMELIBH15,DMELIBH16,DMELIBH17,DMELIBH18,DMELIBH19,DMELIBH20,DMELIBH21,DMELIBH22,DMELIBH23,DMELIBH24,
      DMELIBH25,DMELIBH26,DMELIBH27,DMELIBH28,DMELIBH29,DMELIBH30,DMELIBH31,DMELIBH32,DMELIBH33,DMELIBH34,DMELIBH35,DMELIBH36,
      DMELIBH37,DMELIBH38,DMELIBH39,DMELIBH40,DMELIBH41,DMELIBH42,DMELIBH43,DMELIBH44,DMELIBH45,DMELIBH46,DMELIBH47,DMELIBH48,
      DMELIBH49,DMELIBH50,DMELIBH51,DMELIBH52,DMELIBH53,DMELIBH54,DMELIBH55,DMELIBH56,DMELIBH57,DMELIBH58,DMELIBH59,DMELIBH60,
      DMELIBH61,DMELIBH62,DMELIBH63,DMELIBH64,DMELIBH65,DMELIBH66,DMELIBH67,DMELIBH68,DMELIBH69,DMELIBH70,DMELIBH71,DMELIBH72,
      DMELIBH73,DMELIBH74,DMELIBH75,DMELIBH76,DMELIBH77,DMELIBH78,DMELIBH79,DMELIBH80,DMELIBH81,DMELIBH82,DMELIBH83,DMELIBH84,
      DMELIBH85,DMELIBH86,DMELIBH87,DMELIBH88,DMELIBH89,DMELIBH90,DMELIBH91,DMELIBH92,DMELIBH93,DMELIBH94,DMELIBH95,DMELIBH96,
      IIO_FAC.CLOFACNOMBRG DESCBARRAREFERENCIA, IIO_FAC.CLOFACTENSIONBRG TENSIONREFERENCIA, IIO_FAC.CLOFACCODBRG CODBARRAREFERENCIA
      FROM ME_DEMANDA_MLIBRE ME LEFT JOIN EQ_EQUIPO EQ ON ME.EQUICODI = EQ.EQUICODI
      LEFT JOIN SI_EMPRESA EMP ON ME.EMPRCODI = EMP.EMPRCODI
      LEFT JOIN SI_EMPRESA ECL ON EQ.EMPRCODI = ECL.EMPRCODI
      LEFT JOIN EQ_AREA AR ON EQ.AREACODI = AR.AREACODI
      LEFT JOIN IIO_SICLI_OSIG_FACTURA IIO_FAC ON IIO_FAC.CLOFACANHIOMES = '{1}' AND IIO_FAC.CLOFACCODCLIENTE = EQ.OSINERGCODI AND IIO_FAC.CLOFACCODEMPRESA = EMP.EMPRCODOSINERGMIN
      {0}
      ORDER BY 4,5,3
    </query>
  </Sql>
  <Sql>
    <key>ObtenerPeriodoSicli</key>
    <query>
      SELECT PSICLIANIOMESPERREM
      FROM IIO_PERIODO_SICLI
      WHERE 1=1
      AND ({0} = 1 OR PSICLICERRADODEMANDA = '1')
      ORDER BY 1 DESC
    </query>
  </Sql>

  <Sql>
    <key>UpdatePeriodoDemandaSicli</key>
    <query>

      UPDATE IIO_PERIODO_SICLI
      SET PSICLICERRADODEMANDA = '{0}',
      PSICLIUSUMODIFICACION = '{1}',
      PSICLIFECMODIFICACION = sysdate
      WHERE PSICLIANIOMESPERREM = '{2}'
    </query>
  </Sql>

</Sqls>
