<?xml version="1.0" encoding="utf-8" ?>
<Sqls>

  <Sql>
    <key>GetMaxId</key>
    <query>
      select nvl(max(ptomedicodi), 0) + 1 from me_ptomedicion
    </query>
  </Sql>

  <Sql>
    <key>Save</key>
    <query>
      insert into me_ptomedicion(
      ptomedicodi,
      lastdate,
      lastuser,
      emprcodi,
      grupocodi,
      tipoinfocodi,
      osicodi,
      equicodi,
      codref,
      ptomedidesc,
      orden,
      ptomedielenomb,
      ptomedibarranomb,
      origlectcodi,
      TPTOMEDICODI,
      ptomediestado,
      Ptomedicalculado,
      Areacodi,
      --Fit Aplicativo VTD
      clientecodi,
      PTOCONEXION,
      barrcodi,
      TipoSerieCodi
      -- Fin Fit
      )
      values(
      :ptomedicodi,
      :lastdate,
      :lastuser,
      :emprcodi,
      :grupocodi,
      :tipoinfocodi,
      :osicodi,
      :equicodi,
      :codref,
      :ptomedidesc,
      :orden,
      :ptomedielenomb,
      :ptomedibarranomb,
      :origlectcodi,
      :TPTOMEDICODI,
      :ptomediestado,
      :Ptomedicalculado,
      :Areacodi,
      --Fit Aplicativo VTD
      :clientecodi,
      :PTOCONEXION,
      :barrcodi,
      :TipoSerie
      -- Fin Fit
      )
    </query>
  </Sql>

  <Sql>
    <key>Update</key>
    <query>
      update me_ptomedicion
      set
      lastdate = :lastdate,
      lastuser = :lastuser,
      emprcodi = :emprcodi,
      grupocodi = :grupocodi,
      tipoinfocodi = :tipoinfocodi,
      osicodi = :osicodi,
      equicodi = :equicodi,
      codref = :codref,
      ptomedidesc = :ptomedidesc,
      orden = :orden,
      ptomedielenomb = :ptomedielenomb,
      ptomedibarranomb = :ptomedibarranomb,
      origlectcodi = :origlectcodi,
      TPTOMEDICODI = :TPTOMEDICODI,
      ptomediestado = :ptomediestado,
      areacodi = :areacodi,
      --Fit Aplicativo VTD
      clientecodi = :clientecodi,
      PTOCONEXION = :PTOCONEXION,
      barrcodi = :barrcodi,
      TipoSerieCodi = :TipoSerie
      -- Fin Fit
      where
      ptomedicodi = :ptomedicodi
    </query>
  </Sql>

  <Sql>
    <key>Delete</key>
    <query>
      delete from me_ptomedicion
      where
      ptomedicodi = :ptomedicodi
    </query>
  </Sql>

	<Sql>
		<key>UpdateAuditoria</key>
		<query>
			update aud_me_ptomedicion
			set USERAUDITORIA = :lastuser
			where
			ptomedicodi = :ptomedicodi
			and ACTIONAUDITORIA = 'DELETE'
		</query>
	</Sql>

  <Sql>
    <key>GetById</key>
    <query>
      select
      pto.*,
      eq.famcodi,
      pr.catecodi,
      emp.Tipoemprcodi
      from
      me_ptomedicion pto
      left join EQ_EQUIPO eq on pto.EQUICODI = eq.EQUICODI
      left join pr_grupo pr on pr.grupocodi = pto.grupocodi
      LEFT JOIN SI_EMPRESA emp on emp.emprcodi = pto.emprcodi
      where
      pto.ptomedicodi = :ptomedicodi

    </query>
  </Sql>

  <Sql>
    <key>GetByIdEquipo</key>
    <query>
      select
      pto.ptomedicodi,pto.lastdate,pto.lastuser,pto.emprcodi,pto.grupocodi,pto.osicodi,pto.equicodi,pto.codref,
      pto.ptomedidesc,pto.orden,pto.ptomedielenomb,pto.ptomedibarranomb,pto.origlectcodi,pto.TPTOMEDICODI,pto.ptomediestado,
      o.ORIGLECTCODI,o.ORIGLECTNOMBRE,
      tpto.tipoinfocodi,pto.lastcodi
      from
      me_ptomedicion pto
      inner join ME_ORIGENLECTURA o on o.ORIGLECTCODI = pto.ORIGLECTCODI
      inner join
      me_tipoptomedicion tpto on tpto.TPTOMEDICODI = pto.TPTOMEDICODI
      where
      pto.equicodi = :equicodi
    </query>
  </Sql>
  <Sql>
    <key>GetByIdEquipoUsuarioLibre</key>
    <query>
      select
      pto.ptomedicodi,pto.lastdate,pto.lastuser,pto.emprcodi,pto.grupocodi,pto.osicodi,pto.equicodi,pto.codref,
      pto.ptomedidesc,pto.orden,pto.ptomedielenomb,pto.ptomedibarranomb,pto.origlectcodi,pto.TPTOMEDICODI,pto.ptomediestado,
      o.ORIGLECTCODI,o.ORIGLECTNOMBRE,
      tpto.tipoinfocodi,pto.lastcodi
      from
      me_ptomedicion pto
      inner join ME_ORIGENLECTURA o on o.ORIGLECTCODI = pto.ORIGLECTCODI
      inner join
      me_tipoptomedicion tpto on tpto.TPTOMEDICODI = pto.TPTOMEDICODI
      where
      pto.equicodi = :equicodi AND pto.emprcodi = :emprcodisuministrador AND pto.origlectcodi = 19 AND pto.ptomediestado = 'A'
    </query>
  </Sql>

  <Sql>
    <key>GetByIdGrupo</key>
    <query>
      select
      pto.ptomedicodi,pto.lastdate,pto.lastuser,pto.emprcodi,pto.grupocodi,pto.osicodi,pto.equicodi,pto.codref,
      pto.ptomedidesc,pto.orden,pto.ptomedielenomb,pto.ptomedibarranomb,pto.origlectcodi,pto.TPTOMEDICODI,pto.ptomediestado,
      o.ORIGLECTCODI,o.ORIGLECTNOMBRE,
      tpto.tipoinfocodi,pto.lastcodi
      from
      me_ptomedicion pto
      inner join ME_ORIGENLECTURA o on o.ORIGLECTCODI = pto.ORIGLECTCODI
      inner join
      me_tipoptomedicion tpto on tpto.TPTOMEDICODI = pto.TPTOMEDICODI
      where
      pto.grupocodi = :grupocodi
    </query>
  </Sql>

  <Sql>
    <key>GetPtoDuplicado</key>
    <query>
      select
      *
      from
      me_ptomedicion
      where
      equicodi = {0} and
      origlectcodi = {1} and
      TPTOMEDICODI = {2}

    </query>
  </Sql>
  <Sql>
    <key>GetPtoDuplicadoNombreEmpresa</key>
    <query>
      select
      *
      from
      sic.me_ptomedicion
      where
      ptomedielenomb = '{0}' and
      emprcodi = {1}

    </query>
  </Sql>

  <Sql>
    <key>GetPtoDuplicadoGrupo</key>
    <query>
      select
      *
      from
      me_ptomedicion
      where
      grupocodi = {0} and
      origlectcodi = {1} and
      TPTOMEDICODI = {2}

    </query>
  </Sql>

  <Sql>
    <key>List</key>
    <query>
      select pto.*, eq.equinomb,eq.equiabrev, EQ.FAMCODI,gr.gruponomb, gr.grupoabrev,emp.emprnomb, eqp.equicodi equipadre, eqp.equinomb central,
      COALESCE(gr.tipogenerrer, 'N') as tipogenerrer,
      COALESCE(gr.grupotipocogen, 'N') as grupotipocogen,
      COALESCE(gr.grupointegrante, 'N') as grupointegrante,
      gr.fenergcodi,
      si.fenergnomb,
      si.tgenercodi,
      tg.tgenernomb
      from me_ptomedicion pto
      left join      si_empresa emp on emp.emprcodi = pto.emprcodi
      left join      eq_equipo eq on eq.equicodi = pto.equicodi
      left join      pr_grupo gr on gr.grupocodi  = pto.grupocodi
      LEFT JOIN EQ_EQUIPO eqp ON eqp.EQUICODI = (CASE WHEN EQ.FAMCODI in (4,5,37,39) THEN EQ.equicodi ELSE EQ.EQUIPADRE END)
      left join si_fuenteenergia si ON si.fenergcodi = GR.fenergcodi
      left join SI_TIPOGENERACION tg on tg.tgenercodi = si.tgenercodi
      where (ptomedicodi in ({0}) or '-1' = '{0}')
      and (origlectcodi in ({1}) or '-1' = '{1}')
      AND PTOMEDIESTADO &lt;> 'X'
      </query>
  </Sql>

  <Sql>
    <key>LeerMedidores</key>
    <query>

      select
      t.ptomedicodi,t.h1,t.h2,t.h3,t.h4,t.h5,t.h6,t.h7,t.h8,t.h9,t.h10,t.h11,t.h12,t.h13,t.h14,t.h15,t.h16,t.h17,t.h18,t.h19,t.h20,t.h21,t.h22,t.h23,t.h24,t.h25,t.h26,t.h27,t.h28,t.h29,t.h30,t.h31,t.h32,t.h33,t.h34,t.h35,t.h36,t.h37,t.h38,t.h39,t.h40,t.h41,t.h42,t.h43,t.h44,t.h45,t.h46,t.h47,t.h48,t.h49,t.h50,t.h51,t.h52,t.h53,t.h54,t.h55,t.h56,t.h57,t.h58,t.h59,t.h60,t.h61,t.h62,t.h63,t.h64,t.h65,t.h66,t.h67,t.h68,t.h69,t.h70,t.h71,t.h72,t.h73,t.h74,t.h75,t.h76,t.h77,t.h78,t.h79,t.h80,t.h81,t.h82,t.h83,t.h84,t.h85,t.h86,t.h87,t.h88,t.h89,t.h90,t.h91,t.h92,t.h93,t.h94,t.h95,t.h96
      ,td.tipoinfodesc, tpmed.tptomedicodi, tpmed.tptomedinomb
      from ME_MEDICION96 t
      inner join si_tipoinformacion td on t.tipoinfocodi= td.tipoinfocodi
      ,me_ptomedicion m, eq_equipo e ,si_empresa x,
      me_tipoptomedicion tpmed
      where t.lectcodi = 1 and t.tipoinfocodi in (1,2) and t.medifecha = TO_DATE('{0}','YYYY-MM-DD')
      and t.ptomedicodi = m.ptomedicodi and m.equicodi = e.equicodi  and e.emprcodi = x.emprcodi and x.emprcoes = 'S'
      AND tpmed.tptomedicodi = t.tptomedicodi

    </query>
  </Sql>

  <Sql>
    <key>GetByCriteria</key>
    <query>
      select
      pto.*,
      orig.Origlectnombre,
      emp.Emprnomb, emp.emprestado,
      coalesce(eq.equiabrev, eq.equinomb) equinomb,eq.equiestado,
      fam.famnomb, fam.famcodi,fam.famabrev,
      tpto.TPTOMEDINOMB,tinfo.tipoinfoabrev,
      gr.gruponomb, gr.grupoactivo, gr.grupoestado,
      gr.catecodi, cat.catenomb
      from me_ptomedicion pto
      inner join me_origenlectura orig on orig.origlectcodi = pto.origlectcodi
      inner join si_empresa emp on emp.emprcodi = pto.emprcodi
      left join me_tipoptomedicion tpto on tpto.TPTOMEDICODI = pto.TPTOMEDICODI
      left join SI_TIPOINFORMACION tinfo on tinfo.tipoinfocodi = pto.tipoinfocodi
      left join eq_equipo eq on eq.equicodi = pto.equicodi
      left join eq_familia fam on fam.famcodi = eq.famcodi
      left join pr_grupo gr on gr.grupocodi = pto.grupocodi
      left join pr_categoria cat on gr.catecodi = cat.catecodi
      where
      (pto.emprcodi in ({0}) or '{0}' = '-1') and
      (pto.origlectcodi in ({1}) or '{1}' = '-1') and
      (pto.TPTOMEDICODI  in ({2}) or '{2}' = '-1')
    </query>
  </Sql>

  <Sql>
    <key>ListarPtoMedicion</key>
    <query>
      SELECT
      pto.lastdate,pto.lastuser,pto.grupocodi,pto.tipoinfocodi,pto.osicodi,codref, ptomedidesc,
      orden,ptomedielenomb,ptomedibarranomb,pto.origlectcodi,
      pto.ptomedicodi,em.emprcodi,eq.equicodi,eq.famcodi ,eq.equinomb GRUPONOMB,
      case eq.equipadre when 0 then eq.equinomb else eqp.equinomb end CENTRALNOMB, pto.TPTOMEDICODI,pto.PTOMEDIESTADO,pto.lastcodi
      FROM ME_PTOMEDICION pto
      join EQ_EQUIPO eq on pto.EQUICODI = eq.EQUICODI
      left join EQ_EQUIPO eqp on eqp.EQUICODI = eq.EQUIPADRE
      join EQ_FAMILIA fm on fm.FAMCODI = eq.FAMCODI
      join SI_EMPRESA em on em.EMPRCODI = eq.EMPRCODI
      where eq.famcodi &lt;> 40 and pto.ptomedicodi in ({0})
      union
      SELECT
      pto.lastdate,pto.lastuser,pto.grupocodi,pto.tipoinfocodi,pto.osicodi,codref, ptomedidesc,
      orden,ptomedielenomb,ptomedibarranomb,pto.origlectcodi,
      pto.ptomedicodi,em.emprcodi,eq.equicodi,eq.famcodi ,eq.equinomb GRUPONOMB,
      eqp.equinomb CENTRALNOMB, pto.TPTOMEDICODI,pto.PTOMEDIESTADO,pto.lastcodi
      FROM ME_PTOMEDICION pto
      join EQ_EQUIPO eq on pto.EQUICODI = eq.EQUICODI
      join EQ_EQUIREL rel on eq.EQUICODI = rel.EQUICODI1
      join EQ_EQUIPO eqp on eqp.EQUICODI = rel.EQUICODI2
      join EQ_FAMILIA fm on fm.FAMCODI = eq.FAMCODI
      join SI_EMPRESA em on em.EMPRCODI = eq.EMPRCODI
      where
      eq.famcodi = 40 and
      pto.ptomedicodi in ({0})
    </query>
  </Sql>

  <Sql>
    <key>TotalListaPtoMedicion</key>
    <query>
      select
      count(*) total
      from
      ((((((me_ptomedicion pto
      left join eq_area are on are.areacodi = pto.areacodi
      inner join me_origenlectura orig on orig.origlectcodi = pto.origlectcodi)
      inner join me_tipoptomedicion tpto on tpto.TPTOMEDICODI = pto.TPTOMEDICODI)
      left join eq_equipo eq on eq.equicodi = pto.equicodi)
      inner join si_empresa emp on emp.emprcodi = eq.emprcodi)
      inner join eq_familia fam on fam.famcodi = eq.famcodi)
      inner join eq_area ar on eq.areacodi = ar.areacodi)
      where (eq.emprcodi in ({0}) or '{0}' = '-1') and (pto.origlectcodi in ({1}) or '{1}' = '-1')
      and (pto.TPTOMEDICODI  in ({2}) or '{2}' = '-1') and
      (fam.famcodi  in ({3}) or '{3}' = '-1') and
      (ar.areacodi  in ({4}) or '{4}' = '-1') and
      (pto.ptomedicodi = {5} or {5} = -1)
    </query>
  </Sql>

  <Sql>
    <key>TotalListaPtoMedicionGrupo</key>
    <query>
      select
      count(*) total
      from
      me_ptomedicion pto
      inner join me_origenlectura orig on orig.origlectcodi = pto.origlectcodi
      inner join si_empresa emp on emp.emprcodi = pto.emprcodi
      inner join me_tipoptomedicion tpto on tpto.TPTOMEDICODI = pto.TPTOMEDICODI
      inner join pr_grupo gr on gr.grupocodi = pto.grupocodi
      inner join pr_categoria cat on cat.catecodi = gr.catecodi
      where
      (pto.emprcodi in ({0}) or '{0}' = '-1') and
      (pto.origlectcodi in ({1}) or '{1}' = '-1') and
      (pto.TPTOMEDICODI  in ({2}) or '{2}' = '-1') and
      (cat.catecodi  in ({3}) or '{3}' = '-1') and
      (pto.ptomedicodi = {4} or {4} = -1)
    </query>
  </Sql>

  <Sql>
    <key>DatosHidrologia</key>
    <query>
      SELECT
      ME_MEDICION1.MEDIFECHA,
      ME_PTOMEDICION.PTOMEDIDESC,
      SI_TIPOINFORMACION.TIPOINFODESC,
      ME_MEDICION1.H1
      FROM
      ME_MEDICION1,
      ME_PTOMEDICION,
      SI_TIPOINFORMACION
      WHERE
      ( SI_TIPOINFORMACION.TIPOINFOCODI = ME_MEDICION1.TIPOINFOCODI ) AND
      ( ME_PTOMEDICION.PTOMEDICODI = ME_MEDICION1.PTOMEDICODI ) AND
      ( ME_PTOMEDICION.ORIGLECTCODI=5) AND
      ( ME_MEDICION1.LECTCODI = 20 )  AND
      ( ME_MEDICION1.MEDIFECHA >= to_date('{0}','YYYY-MM-DD') and  ME_MEDICION1.MEDIFECHA &lt; to_date('{1}','YYYY-MM-DD') )
    </query>
  </Sql>

  <Sql>
    <key>ListarDetallePtoMedicionFiltro</key>
    <query>
      select * from
      (
      select total.*, (row_number() over (order by total.{7} {8})) as r from (
      select
      pto.*,
      (select emprnomb from si_empresa semp where semp.emprcodi = pto.clientecodi) as cliennomb,
      orig.Origlectnombre,
      emp.Emprnomb,
      eq.equinomb,
      fam.famnomb,
      tpto.TPTOMEDINOMB,
      decode(pto.origlectcodi, 6,
      (select valor from eq_propequi pe where pe.propcodi = 1064 and pe.equicodi = eq.equicodi  and ROWNUM = 1
      and fechapropequi = (select max(fechapropequi)from eq_propequi where propcodi = 1064 and equicodi = eq.equicodi)
      )
      , '') as areaoperativa,
      decode(pto.origlectcodi, 6,
      (select equipo.equitension from eq_equipo equipo where equipo.equicodi = pto.codref)
      , (select equipo.equitension from eq_equipo equipo where equipo.equicodi = pto.equicodi)) as niveltension,
      tpar.tareaabrev || ' ' || ar.areanomb as desubicacion, 
      pto.areacodi as areacodi2, 
      are.areanomb 
      from me_ptomedicion pto
      inner join
      me_origenlectura orig on orig.origlectcodi = pto.origlectcodi

      inner join
      me_tipoptomedicion tpto on tpto.TPTOMEDICODI = pto.TPTOMEDICODI
      left join
      eq_equipo eq on eq.equicodi = pto.equicodi
      inner join
      si_empresa emp on emp.emprcodi = eq.emprcodi
      inner join
      eq_familia fam on fam.famcodi = eq.famcodi
      inner join
      eq_area ar on eq.areacodi = ar.areacodi
      inner join
      eq_tipoarea tpar on ar.tareacodi = tpar.tareacodi
      left join eq_area are on are.areacodi = pto.areacodi 
      where
      (eq.emprcodi in ({0}) or '{0}' = '-1') and
      (pto.origlectcodi in ({1}) or '{1}' = '-1') and
      (pto.TPTOMEDICODI  in ({2}) or '{2}' = '-1') and
      (fam.famcodi  in ({5}) or '{5}' = '-1') and
      (ar.areacodi  in ({6}) or '{6}' = '-1') and
      (pto.ptomedicodi = {9} or {9} = -1)
      ) total
      )
      where r >= ((({3}-1) * {4}) + 1) and r &lt; (({3} * {4}) + 1 )
    </query>
  </Sql>

  <Sql>
    <key>ListarDetallePtoMedicionFiltroGrupo</key>
    <query>
      select * from
      (
      select total.*, (row_number() over (order by total.{6} {7})) as r from (
      select
      pto.*,
      (select emprnomb from si_empresa semp where semp.emprcodi = pto.clientecodi) as cliennomb,
      orig.Origlectnombre,
      emp.Emprnomb,
      gr.gruponomb as equinomb,
      cat.catenomb as famnomb,
      tpto.TPTOMEDINOMB,
      '' as areaoperativa,
      '' as desubicacion,
      0 as niveltension
      from me_ptomedicion pto
      inner join
      me_origenlectura orig on orig.origlectcodi = pto.origlectcodi
      inner join
      si_empresa emp on emp.emprcodi = pto.emprcodi
      inner join
      me_tipoptomedicion tpto on tpto.TPTOMEDICODI = pto.TPTOMEDICODI
      inner join
      pr_grupo gr on gr.grupocodi = pto.grupocodi
      inner join
      pr_categoria cat on gr.catecodi = cat.catecodi
      where
      (pto.emprcodi in ({0}) or '{0}' = '-1') and
      (pto.origlectcodi in ({1}) or '{1}' = '-1') and
      (pto.TPTOMEDICODI  in ({2}) or '{2}' = '-1') and
      (cat.catecodi  in ({5}) or '{5}' = '-1') and
      (pto.ptomedicodi = {8} or {8} = -1)
      ) total
      )
      where r >= ((({3}-1) * {4}) + 1) and r &lt; (({3} * {4}) + 1 )
    </query>
  </Sql>

  <Sql>
    <key>TotalListaPtoMedicionNoDefinido</key>
    <query>
      select
      count(*) total
      from
      me_ptomedicion pto
      where
      (pto.equicodi is null or pto.equicodi = -1 ) and
      (pto.grupocodi is null or pto.grupocodi = -1 ) and
      (pto.origlectcodi in ({0}) or '{0}' = '-1') and
      (pto.ptomedicodi = {1} or {1} = -1)
    </query>
  </Sql>

  <Sql>
    <key>ListarDetallePtoMedicionNoDefinido</key>
    <query>
      select * from
      (
      select total.*, (row_number() over (order by total.{3} {4})) as r from (
      select
      pto.*
      from me_ptomedicion pto
      where
      (pto.equicodi is null or pto.equicodi = -1 ) and
      (pto.grupocodi is null or pto.grupocodi = -1 ) and
      (pto.origlectcodi in ({0}) or '{0}' = '-1') and
      (pto.ptomedicodi = {5} or {5} = -1)
      ) total
      )
      where r >= ((({1}-1) * {2}) + 1) and r &lt; (({1} * {2}) + 1 )
    </query>
  </Sql>
  
  <Sql>
    <key>VerificarRelaciones</key>
    <query>
      select sum(contador) as suma from (
      select count(*) as contador from me_medicion96 where ptomedicodi = {0}
      union all
      select count(*) as contador from me_medicion48 where ptomedicodi = {0}
      union all
      select count(*) as contador from me_medicion24 where ptomedicodi = {0}
      union all
      select count(*) as contador from me_medicion1 where ptomedicodi = {0}
      union all
      select count(*) as contador from me_medicionxintervalo where ptomedicodi = {0}
      union all
      select count(*) as contador from wb_serviciorpf where ptomedicodi = {0}
      union all
      select count(*) as contador from me_hojaptomed where ptomedicodi = {0}
      union all
      select count(*) from me_ptosuministrador where ptomedicodi = {0}
      )
    </query>
  </Sql>

  <Sql>
    <key>ObtenerAreasFiltro</key>
    <query>
      select distinct ta.tareaabrev || ' ' || ar.areanomb as areanomb,
      ar.areacodi
      from me_ptomedicion pto
      inner join eq_equipo eq on pto.equicodi = eq.equicodi
      inner join eq_area ar on eq.areacodi = ar.areacodi
      inner join eq_tipoarea ta on ar.tareacodi = ta.tareacodi
      order by 1 asc
    </query>
  </Sql>
  
  <Sql>
    <key>LeerPtoMedicionHidrologia</key>
    <query>      
      select m.ptomedicodi,m.ptomedidesc,m.tipoinfocodi,e.emprnomb
      from me_ptomedicion m, si_empresa e
      where m.tipoinfocodi in (11,13,19) and m.origlectcodi = 2 and e.emprcodi=m.emprcodi
    </query>
  </Sql>

  <Sql>
    <key>VerificarExistencia</key>
    <query>
      select count(*) as contador from me_ptomedicion where equicodi = :equicodi and origlectcodi = :origlectcodi
    </query>
  </Sql>

  <Sql>
    <key>ListarPotencia</key>
    <query>
      select
      a.ptomedicodi,
      a.ptomedielenomb ,
      a.ptomedibarranomb,
      a.ptomedidesc,
      a.lastuser,
      a.lastdate
      from
      me_ptomedicion a, eq_equipo b,eq_familia c
      where
      a.equicodi=b.equicodi and b.famcodi=c.famcodi and c.famcodi in ({0})
      and origlectcodi={1}
      order by orden
    </query>
  </Sql>

  <Sql>
    <key>ListarPotenciaEquipo</key>
    <query>
      select
      a.ptomedicodi,
      a.ptomedielenomb ,
      a.ptomedibarranomb,
      a.ptomedidesc,
      a.lastuser,
      a.lastdate
      from
      me_ptomedicion a
      where
      a.ptomedicodi={0}
    </query>
  </Sql>

  <Sql>
    <key>ListarCostoVariableAGC</key>
    <query>
      select
      z.ptomedicodi,
      z.grupocodi,
      a.gruponomb,
      z.ptomedibarranomb,
      z.ptomedidesc,
      z.lastuser,
      z.lastdate
      from
      me_ptomedicion z,
      pr_grupo a
      where
      a.grupocodi=z.grupocodi and
      ptomedicodi between 17000 and 18000
      and z.grupocodi>0 and a.grupoactivo='S'
      order by orden
    </query>
  </Sql>

  <Sql>
    <key>ListarTipoGrupo</key>
    <query>
      select
      max(b.grupotipo) grupotipo
      from
      me_ptomedicion a,
      pr_grupo b,
      si_empresa c,
      eq_area d ,
      eq_equipo e
      where
      a.grupocodi = b.grupocodi and
      c.emprcodi = b.emprcodi and
      b.emprcodi > 0 and
      a.origlectcodi = 2 and
      e.equicodi=a.equicodi and
      e.areacodi=d.areacodi and
      b.grupoactivo='S' and
      a.ptomedicodi in ({0})
    </query>
  </Sql>

  <Sql>
    <key>GetByIdAgc</key>
    <query>
      select
      ptomedicodi,
      grupocodi,
      ptomedibarranomb,
      ptomedidesc
      from
      me_ptomedicion
      where
      ptomedicodi = :ptomedicodi
    </query>
  </Sql>

  <Sql>
    <key>ListarControlCentralizado</key>
    <query>
      select
      a.ptomedicodi,
      trim(c.emprabrev)||' / '||trim(d.areanomb)||' / '||trim(e.equiabrev)||' / '||trim(b.gruponomb) ptomedidesc
      from
      me_ptomedicion a,
      pr_grupo b,
      si_empresa c,
      eq_area d ,
      eq_equipo e
      where
      a.grupocodi = b.grupocodi and
      c.emprcodi = b.emprcodi and
      b.emprcodi > 0 and
      a.origlectcodi = 2 and
      e.equicodi=a.equicodi and
      e.areacodi=d.areacodi and
      b.grupoactivo='S'
      order by
      c.emprnomb,
      d.areanomb,
      e.equiabrev,
      b.gruponomb
    </query>
  </Sql>

  <Sql>
    <key>GetByCriteria3</key>
    <query>
      select
      *
      from me_ptomedicion
      where origlectcodi = {0}
      and ('{1}' = '-1' or grupocodi in ({1}) )
      and ('{2}' = '-1' or tipoinfocodi in ({2}) )
    </query>
  </Sql>

  <Sql>
    <key>ListOrigenLectura</key>
    <query>
      select (case when vwpt.emprcodi is not null then vwpt.emprcodi else p.emprcodi end) emprcodi, p.* 
      from me_ptomedicion p
      left join(
          --Puntos de medicion activos hasta de la Fecha de Inicio
          SELECT * FROM
          (     
	            SELECT pto .Ptomedicodi, pto.codref, pto.Origlectcodi, pto.Equicodi, pto.Ptomedielenomb, pto.Ptomediestado,emp.emprcodi,emp.emprnomb,
	            vwpt.HPTDATFECHA, vwpt.HPTDATPTOESTADO, ROW_NUMBER() OVER(PARTITION BY pto.PTOMEDICODI,emp.emprcodi ORDER BY pto.PTOMEDICODI,emp.emprcodi,vwpt.HPTDATFECHA desc, vwpt.HPTDATPTOESTADO desc) AS NUM_VIEW
	            FROM ME_PTOMEDICION pto
	            inner join SI_HISEMPPTO_DATA vwpt on vwpt.HPTDATFECHA &lt;= to_date('{1}','YYYY-MM-DD') and (vwpt.PTOMEDICODI = pto.PTOMEDICODI OR vwpt.PTOMEDICODIOLD = pto.PTOMEDICODI)
	            INNER JOIN SI_EMPRESA emp ON emp.emprcodi = vwpt.emprcodi
          )rview 
          WHERE NUM_VIEW = 1 and HPTDATPTOESTADO = 'I'

          UNION ALL

          --Puntos de medicion activos despues de la Fecha de Inicio
          SELECT * FROM
          (     
	            SELECT pto .Ptomedicodi, pto.codref, pto.Origlectcodi, pto.Equicodi, pto.Ptomedielenomb, pto.Ptomediestado,emp.emprcodi,emp.emprnomb,
	            vwpt.HPTDATFECHA, vwpt.HPTDATPTOESTADO, ROW_NUMBER() OVER(PARTITION BY pto.PTOMEDICODI,emp.emprcodi ORDER BY pto.PTOMEDICODI,emp.emprcodi,vwpt.HPTDATFECHA desc, vwpt.HPTDATPTOESTADO desc) AS NUM_VIEW
	            FROM ME_PTOMEDICION pto
	            inner join SI_HISEMPPTO_DATA vwpt on vwpt.HPTDATFECHA > to_date('{1}','YYYY-MM-DD') and vwpt.HPTDATFECHA &lt;= to_date('{2}','YYYY-MM-DD') and (vwpt.PTOMEDICODI = pto.PTOMEDICODI OR vwpt.PTOMEDICODIOLD = pto.PTOMEDICODI)
	            INNER JOIN SI_EMPRESA emp ON emp.emprcodi = vwpt.emprcodi
          )rview 
          WHERE NUM_VIEW = 1 and HPTDATPTOESTADO = 'I'
      )vwpt on vwpt.ptomedicodi = p.ptomedicodi
      where p.origlectcodi in ({0})
      order by p.ptomedicodi
    </query>
  </Sql>

  <Sql>
    <key>UpdateMePtomedicion</key>
    <query>
      update me_ptomedicion
      set
      ptomedielenomb = :ptomedielenomb,
      ptomedibarranomb = :ptomedibarranomb,
      ptomedidesc = :ptomedidesc,
      lastuser = :lastuser,
      lastdate = :lastdate
      where
      ptomedicodi = :ptomedicodi
    </query>
  </Sql>

  <Sql>
    <key>UpdateMePtomedicionCVariable</key>
    <query>
      update me_ptomedicion
      set
      grupocodi = :grupocodi,
      ptomedibarranomb = :ptomedibarranomb,
      ptomedidesc = :ptomedidesc,
      lastuser = :lastuser,
      lastdate = :lastdate
      where
      ptomedicodi = :ptomedicodi
    </query>
  </Sql>

  <!-- Inicio de Agregados - Sistema de Compensaciones -->
  <Sql>
    <key>ObtenerMaximoOrden</key>
    <query>
      SELECT MAX(PMEMOPORDEN) AS MAXIMO FROM VCE_PTOMED_MODOPE
    </query>
  </Sql>

  <Sql>
    <key>ListPtoMedicionCompensaciones</key>
    <query>
      SELECT PTOMEDICODI, PTOMEDIELENOMB FROM ME_PTOMEDICION
      WHERE ORIGLECTCODI = 1 AND PTOMEDIESTADO='A'
      AND ( {0} PTOMEDICODI NOT IN (SELECT PTOMEDICODI FROM VCE_PTOMED_MODOPE WHERE PECACODI = {1} AND PMEMOPESTREGISTRO = '1'))
      ORDER BY 2
    </query>
  </Sql>
  <!--Fin de Agregados - Sistema de Compensaciones -->

  <Sql>
    <key>ListarCentralByOriglectcodi</key>
    <query>
      select
      emp.emprcodi,emp.emprnomb,pto.ptomedicodi,eq.equipadre,eqp.equinomb as central, eq.equicodi,eq.equinomb as equinomb, eq.famcodi, pto.PTOMEDIELENOMB
      from me_ptomedicion pto
      --inner join me_hojaptomed hpto on pto.ptomedicodi = hpto.ptomedicodi
      inner join eq_equipo eq on eq.equicodi = pto.equicodi --and eq.equipadre not in (-1, 0)
      inner join eq_equipo eqp on eqp.EQUICODI =coalesce( eq.EQUIPADRE, -1)
      inner join si_empresa emp on emp.emprcodi = pto.emprcodi and emp.emprcodi not in (-1, 0)
      where (pto.origlectcodi in ({0}) or '-1'='{0}') and pto.ptomediestado != 'B'
      and (eq.famcodi in ({1}) or '-1'='{1}')
      --and hpto.formatcodi = {2} and hpto.HPTOACTIVO = 1
      --eq.famcodi in (2,3,37,39)
      --and eq.equiestado != 'B' and  eqp.equiestado != 'B'
    </query>
  </Sql>

  <!-- Inicio - SIOSEIN -->

  <Sql>
    <key>ListPtoMedicionMeLectura</key>
    <query>
      select * from ME_PTOMEDICION
      where ORIGLECTCODI = {0}
      AND orden !=0
      and tipoinfocodi = {2}
      order by ptomedicodi, orden asc
    </query>
  </Sql>

  <Sql>
    <key>GetByCriteria2</key>
    <query>
      select *  from ME_PTOMEDICION
      where (equicodi in ({0}) or '-1' = '{0}')
      and (origlectcodi in ({1}) or '-1' = '{1}')
      and trim(ptomediestado)='A'
    </query>
  </Sql>

  <!-- Fin - SIOSEIN -->

  <!--Pruebas aleatorias-->
  <Sql>
    <key>ObtenerMedicionSorteo</key>
    <query>
      SELECT * FROM ME_PTOMEDICION WHERE EQUICODI IN
      (SELECT EQUICODI FROM PR_EQUIPOSORTEO WHERE LOGFECHA=TO_DATE('{0}','YYYY-MM-DD') AND EQUIPOPRUEBA='S')
      AND ORIGLECTCODI={1} AND PTOMEDIESTADO = 'A'
    </query>
  </Sql>
  <!--Fin Pruebas aleatorias-->

  <!--Region Transferencia de Equipos-->
  <Sql>
    <key>ListarPtosMedicionXEmpresa</key>
    <query>
      select *  from ME_PTOMEDICION
      where EMPRCODI={0}
      and trim(ptomediestado)='A'
    </query>    
  </Sql>


  <!-- Inicio PR5 -->
  <Sql>
    <key>ListarByEquiOriglectcodi</key>
    <query>
      SELECT * FROM
      (
          select distinct
          emp.TIPOEMPRCODI
          ,emp.emprcodi,emp.emprnomb
          ,pto.ptomedicodi,eq.equipadre,eqp.equinomb as central,eq.equicodi,eq.equinomb as equinomb,eq.famcodi,pto.PTOMEDIdesc as PTOMEDIELENOMB,tpto.tipoinfocodi,tip.tipoinfoabrev,pto.TPTOMEDICODI,tpto.TPTOMEDINOMB
          ,COALESCE(pto.ptomedicalculado, 'N') as ptomedicalculado
          ,le.lectcodi,pto.origlectcodi
          ,(row_number() over (PARTITION BY pto.ptomedicodi order by le.lectcodi)) as NUM_VIEW
          from me_ptomedicion pto
          left join me_hojaptomed hpto on pto.ptomedicodi = hpto.ptomedicodi
          left join me_hoja hoja on hoja.HOJACODI = hpto.HOJACODI
          inner join ME_TIPOPTOMEDICION tpto on tpto.TPTOMEDICODI = pto.TPTOMEDICODI
          inner join si_tipoinformacion tip on tip.tipoinfocodi = tpto.tipoinfocodi
          inner join eq_equipo eq on eq.equicodi = pto.equicodi
          left join eq_equipo eqp on eqp.EQUICODI = eq.EQUIPADRE
          inner join si_empresa emp on emp.emprcodi = pto.emprcodi
          inner join me_lectura le on le.lectcodi = coalesce(hoja.lectcodi,0) or (coalesce(hoja.lectcodi,0)=0 and le.origlectcodi = pto.origlectcodi)
          where pto.origlectcodi = {1} and pto.ptomediestado in ('A','P') and (pto.equicodi = {0} or '-1' = '{0}') and (le.lectcodi = -1 or '-1' = '-1')
      )WHERE NUM_VIEW = 1
    </query>
  </Sql>

  <Sql>
    <key>ListarPuntosCalculados</key>
    <query>
      select PTO.*,emp.EMPRCODI,emp.EMPRABREV,emp.EMPRNOMB,
      fam.famcodi,fam.famnomb, fam.famabrev,eq.equicodi, eq.equinomb, eq.equiabrev,
      tpto.TPTOMEDINOMB,ti.tipoinfocodi,ti.tipoinfoabrev, ol.ORIGLECTNOMBRE
      from ME_PTOMEDICION PTO
      inner join eq_equipo eq on eq.equicodi = pto.equicodi
      inner join eq_familia fam on fam.famcodi = eq.famcodi
      inner join ME_TIPOPTOMEDICION tpto on tpto.tptomedicodi = PTO.tptomedicodi
      inner join si_tipoinformacion ti on ti.tipoinfocodi = tpto.tipoinfocodi
      inner join si_empresa emp on emp.emprcodi = pto.emprcodi
      inner join ME_ORIGENLECTURA ol on ol.ORIGLECTCODI = PTO.ORIGLECTCODI
      where PTO.PTOMEDICALCULADO = 'S' and PTO.Ptomediestado &lt;> 'X'
      order by emp.emprcodi, eq.equinomb asc
    </query>
  </Sql>

  <Sql>
    <key>ListarPtoMedicionByOriglectcodiAndFormato</key>
    <query>
      SELECT rview.* FROM
      (
          --Puntos de medicion activos hasta de la Fecha de Inicio
          select pto.ptomedicodi, pto.ptomedibarranomb, pto.ptomedidesc, pto.PTOMEDIELENOMB
          ,eq.equicodi,eq.equinomb,eq.famcodi, eq.EQUIABREV
          ,emp.emprcodi, emp.emprnomb
          ,ti.TIPOINFOCODI,ti.tipoinfoabrev
          ,tpmed.TPTOMEDICODI,tpmed.TPTOMEDINOMB
          ,gp.grupocodi, gp.gruponomb
          ,gpp.grupocodi grupopadre, gpp.gruponomb grupocentral
          ,CASE WHEN vwpt.HPTDATPTOESTADO = 'F' THEN 0 ELSE HP.HPTOACTIVO END AS HPTOACTIVO
          , vwpt.HPTDATFECHA, vwpt.HPTDATPTOESTADO, ROW_NUMBER() OVER(PARTITION BY HP.HPTOCODI,emp.emprcodi ORDER BY HP.HPTOCODI,emp.emprcodi,vwpt.HPTDATFECHA desc, vwpt.HPTDATPTOESTADO desc) AS NUM_VIEW
          from ME_PTOMEDICION pto
          inner join me_hojaptomed HP  ON HP.PTOMEDICODI = PTO.PTOMEDICODI
          inner join SI_HISEMPPTO_DATA vwpt on vwpt.HPTDATFECHA &lt;= to_date('{2}','YYYY-MM-DD') and (vwpt.PTOMEDICODI = pto.PTOMEDICODI OR vwpt.PTOMEDICODIOLD = pto.PTOMEDICODI)
          inner join si_tipoinformacion ti on ti.tipoinfocodi = hp.tipoinfocodi
          inner join me_tipoptomedicion tpmed on tpmed.tptomedicodi = pto.tptomedicodi
          inner join eq_equipo eq on eq.equicodi = pto.equicodi
          inner join si_empresa emp on emp.emprcodi = vwpt.emprcodi
          inner join pr_grupo gp on gp.grupocodi = eq.grupocodi
          inner join pr_grupo gpp on gpp.grupocodi = gp.grupopadre
          WHERE pto.origlectcodi = {0} and hp.formatcodi = {1}

          UNION ALL

          --Puntos de medicion activos despues de la Fecha de Inicio
          select pto.ptomedicodi, pto.ptomedibarranomb, pto.ptomedidesc, pto.PTOMEDIELENOMB
          ,eq.equicodi,eq.equinomb,eq.famcodi, eq.EQUIABREV
          ,emp.emprcodi, emp.emprnomb
          ,ti.TIPOINFOCODI,ti.tipoinfoabrev
          ,tpmed.TPTOMEDICODI,tpmed.TPTOMEDINOMB
          ,gp.grupocodi, gp.gruponomb
          ,gpp.grupocodi grupopadre, gpp.gruponomb grupocentral
          ,CASE WHEN vwpt.HPTDATPTOESTADO = 'F' THEN 0 ELSE HP.HPTOACTIVO END AS HPTOACTIVO
          , vwpt.HPTDATFECHA, vwpt.HPTDATPTOESTADO, ROW_NUMBER() OVER(PARTITION BY HP.HPTOCODI,emp.emprcodi ORDER BY HP.HPTOCODI,emp.emprcodi,vwpt.HPTDATFECHA desc, vwpt.HPTDATPTOESTADO desc) AS NUM_VIEW
          from ME_PTOMEDICION pto
          inner join me_hojaptomed HP  ON HP.PTOMEDICODI = PTO.PTOMEDICODI
          inner join SI_HISEMPPTO_DATA vwpt on vwpt.HPTDATFECHA > to_date('{2}','YYYY-MM-DD') and vwpt.HPTDATFECHA &lt;= to_date('{3}','YYYY-MM-DD') and (vwpt.PTOMEDICODI = pto.PTOMEDICODI OR vwpt.PTOMEDICODIOLD = pto.PTOMEDICODI)
          inner join si_tipoinformacion ti on ti.tipoinfocodi = hp.tipoinfocodi
          inner join me_tipoptomedicion tpmed on tpmed.tptomedicodi = pto.tptomedicodi
          inner join eq_equipo eq on eq.equicodi = pto.equicodi
          inner join si_empresa emp on emp.emprcodi = vwpt.emprcodi
          inner join pr_grupo gp on gp.grupocodi = eq.grupocodi
          inner join pr_grupo gpp on gpp.grupocodi = gp.grupopadre
          WHERE pto.origlectcodi = {0} and hp.formatcodi = {1}

      )rview
      WHERE NUM_VIEW = 1 -- and HPTOACTIVO = 1
    </query>
  </Sql>

  <Sql>
    <key>ListarPtoMedicionFromCalculado</key>
    <query>
      select
      tiprelpto.TRPTOCODI,tiprelpto.TRPTONOMBRE,
      pto.ptomedicodi "PTOMEDICODI_CALCULADO",pto.ptomedidesc "PTOMEDICODIDESC_CALCULADO", relpto.RELPTOFACTOR "FACTOR_ORIGEN",
      empr2.EMPRCODI "EMPRCODI_ORIGEN",empr2.EMPRABREV "EMPRABREV_ORIGEN", empr2.EMPRNOMB "EMPRNOMB_ORIGEN",
      relpto.RELPTOCODI,pto2.PTOMEDICODI "PTOMEDICODI_ORIGEN", pto2.ptomedibarranomb "Ptomedielenomb_ORIGEN", pto2.PTOMEDIELENOMB "Ptomedibarranomb_ORIGEN", pto2.ptomedidesc "PTOMEDICODIDESC_ORIGEN",
      case when eq2.famcodi in (4,5,37,39) then eq2.equicodi else eq2p.equicodi end as "EQUIPADRE_ORIGEN",
      case when eq2.famcodi in (4,5,37,39) then eq2.equinomb else eq2p.equinomb end as "CENTRAL_ORIGEN",
      eq2.EQUICODI "EQUICODI_ORIGEN", eq2.equinomb "EQUINOMB_ORIGEN", eq2.equiabrev "EQUIABREV_ORIGEN",
      ar2.areacodi, (tar2.TAREAABREV || ' ' || ar2.areanomb) as areanomb,
      fam2.famCODI "FAMCODI_ORIGEN", fam2.famnomb "FAMNOMB_ORIGEN", fam2.famabrev "FAMABREV_ORIGEN",
      orig2.ORIGLECTCODI, orig2.ORIGLECTNOMBRE, lc.lectcodi, lc.lectnomb,
      tip.tipoinfocodi, tip.TIPOINFOABREV, f.tgenercodi, pto2.PTOMEDICALCULADO,
      tpmed.tptomedicodi, tpmed.TPTOMEDINOMB, relpto.RELPTOTABMED, relpto.RELPTOPOTENCIA
      from me_ptomedicion pto
      inner join ME_RELACIONPTO relpto on relpto.PTOMEDICODI1 = pto.ptomedicodi
      left join me_lectura lc on lc.lectcodi = relpto.lectcodi
      left join SI_TIPOINFORMACION tip on tip.TIPOINFOCODI = relpto.TIPOINFOCODI
      inner join ME_TIPORELACIONPTO tiprelpto on tiprelpto.TRPTOCODI = relpto.TRPTOCODI
      inner join me_ptomedicion pto2 on pto2.ptomedicodi = relpto.PTOMEDICODI2
      inner join ME_ORIGENLECTURA orig2 on orig2.ORIGLECTCODI = pto2.ORIGLECTCODI
      left join me_tipoptomedicion tpmed on tpmed.tptomedicodi = relpto.tptomedicodi
      left join eq_equipo eq2 on eq2.equicodi = pto2.equicodi
      LEFT join eq_area ar2 on eq2.areacodi = ar2.areacodi
      left join EQ_TIPOAREA tar2 on tar2.TAREACODI = ar2.tareacodi
      left join eq_familia fam2 on fam2.famcodi = eq2.famcodi
      left join si_empresa empr2 on empr2.emprcodi = (case when eq2.equicodi is null then pto2.emprcodi else eq2.emprcodi end)
      left join eq_equipo eq2p on eq2p.equicodi = (case when eq2.famcodi in (2,3,36,38) then eq2.equipadre else eq2.equicodi end)
      left join pr_grupo pr on pr.grupocodi = (case when eq2.grupocodi>0 then eq2.grupocodi when eq2p.grupocodi >0 then eq2p.grupocodi when pto2.grupocodi >0 then pto2.grupocodi else -1 end)
      left join si_fuenteenergia f on f.fenergcodi = pr.fenergcodi
      where pto.PTOMEDICALCULADO = 'S'
      AND ('-1' = '{0}' or pto.PTOMEDICODI in({0}))
      ORDER BY pto.orden
    </query>
  </Sql>
  <!-- Fin PR5 -->

  <!--INICIO MigracionSGOCOES-GrupoB-->

  <Sql>
    <key>ObtenerPuntoMedicionExtranet</key>
    <query>
      select pto.ptomedicodi, eq.equinomb, eq.equiabrev from me_ptomedicion pto inner join eq_equipo eq
      on pto.equicodi = eq.equicodi
      where pto.origlectcodi = 1 and (eq.equicodi = {0} or eq.equipadre = {0}) and eq.famcodi in (2,3,4,5, 36, 37, 38, 39)
    </query>
  </Sql>

  <Sql>
    <key>ListaPuntoMedicionXEmpresa</key>
    <query>
      SELECT pto .*,
      eq.equinomb,
      BARRA.equitension,
      eq.AREACODI,
      ar.areanomb,
      data_areaop.Areaoperativa
      FROM
      (
      --Puntos de medicion activos hasta de la Fecha de Inicio
      SELECT * FROM
      (
      SELECT pto .Ptomedicodi, pto.codref, pto.Origlectcodi, pto.Equicodi, pto.Ptomedielenomb, pto.Ptomediestado,emp.emprcodi,emp.emprnomb,
      vwpt.HPTDATFECHA, vwpt.HPTDATPTOESTADO, ROW_NUMBER() OVER(PARTITION BY pto.PTOMEDICODI,emp.emprcodi ORDER BY pto.PTOMEDICODI,emp.emprcodi,vwpt.HPTDATFECHA desc, vwpt.HPTDATPTOESTADO desc) AS NUM_VIEW
      FROM ME_PTOMEDICION pto
      inner join SI_HISEMPPTO_DATA vwpt on vwpt.HPTDATFECHA &lt;= to_date('{1}','YYYY-MM-DD') and (vwpt.PTOMEDICODI = pto.PTOMEDICODI OR vwpt.PTOMEDICODIOLD = pto.PTOMEDICODI)
      INNER JOIN SI_EMPRESA emp ON emp.emprcodi = vwpt.emprcodi
      WHERE pto.origlectcodi = 6 AND ('{0}'= '-1' or emp.emprcodi IN ({0}))
      )rview
      WHERE NUM_VIEW = 1 and HPTDATPTOESTADO = 'I'

      UNION ALL

      --Puntos de medicion activos despues de la Fecha de Inicio
      SELECT * FROM
      (
      SELECT pto .Ptomedicodi, pto.codref, pto.Origlectcodi, pto.Equicodi, pto.Ptomedielenomb, pto.Ptomediestado,emp.emprcodi,emp.emprnomb,
      vwpt.HPTDATFECHA, vwpt.HPTDATPTOESTADO, ROW_NUMBER() OVER(PARTITION BY pto.PTOMEDICODI,emp.emprcodi ORDER BY pto.PTOMEDICODI,emp.emprcodi,vwpt.HPTDATFECHA desc, vwpt.HPTDATPTOESTADO desc) AS NUM_VIEW
      FROM ME_PTOMEDICION pto
      inner join SI_HISEMPPTO_DATA vwpt on vwpt.HPTDATFECHA > to_date('{1}','YYYY-MM-DD') and vwpt.HPTDATFECHA &lt;= to_date('{2}','YYYY-MM-DD') and (vwpt.PTOMEDICODI = pto.PTOMEDICODI OR vwpt.PTOMEDICODIOLD = pto.PTOMEDICODI)
      INNER JOIN SI_EMPRESA emp ON emp.emprcodi = vwpt.emprcodi
      WHERE pto.origlectcodi = 6 AND ('{0}'= '-1' or emp.emprcodi IN ({0}))
      )rview
      WHERE NUM_VIEW = 1 and HPTDATPTOESTADO = 'I'
      )pto
      INNER JOIN EQ_EQUIPO eq ON eq.equicodi = pto.equicodi
      INNER JOIN EQ_EQUIPO BARRA ON BARRA.equicodi = pto.Codref
      INNER JOIN eq_area ar ON ar.areacodi = eq.areacodi
      left join(
      select ptomedicodi, Areaoperativa from
      (
      SELECT pto.ptomedicodi, x.VALOR AS Areaoperativa, ROW_NUMBER() OVER(PARTITION BY pto.ptomedicodi ORDER BY pto.ptomedicodi,x.FECHAPROPEQUI DESC) AS NUM
      FROM ME_PTOMEDICION pto
      INNER JOIN EQ_EQUIPO eq ON eq.equicodi = pto.equicodi
      INNER JOIN EQ_PROPEQUI x ON x.EQUICODI = eq.EQUICODI
      WHERE pto.origlectcodi = 6 and x.propcodi in (1064) and x.PROPEQUIDELETED = 0
      ) where num = 1
      )data_areaop on data_areaop.ptomedicodi =pto.ptomedicodi
      WHERE
      pto.origlectcodi = 6
      AND ('{0}'= '-1' or pto.emprcodi IN ({0}))
      ORDER BY pto.emprcodi,pto.ptomedicodi
    </query>
  </Sql>

  <!--FIN MigracionSGOCOES-GrupoB-->

  <!--Region Transferencia de Equipos-->
  <Sql>
    <key>ListarPtosMedicionXEmpresa</key>
    <query>
      select *  from ME_PTOMEDICION
      where EMPRCODI={0}
      and trim(ptomediestado)='A'
    </query>
  </Sql>

  <!--Inicio Mejoras IEOD-->
  <Sql>
    <key>ListarPtomedicionByOriglectcodi</key>
    <query>
      select
      emp.emprcodi,emp.emprnomb,pto.ptomedicodi,eq.equipadre,eqp.equinomb as central, eq.equicodi,eq.equinomb as equinomb, eq.famcodi, coalesce(pto.PTOMEDIDESC,pto.PTOMEDIELENOMB) PTOMEDIELENOMB
      from me_ptomedicion pto
      left join eq_equipo eq on eq.equicodi = pto.equicodi
      left join eq_equipo eqp on eqp.EQUICODI =coalesce( eq.EQUIPADRE, -1)
      left join si_empresa emp on emp.emprcodi = eq.emprcodi and emp.emprcodi not in (-1, 0)
      where (pto.origlectcodi in ({0}) or '-1'='{0}') and pto.ptomediestado != 'B'
      and (eq.famcodi in ({1}) or '-1'='{1}') and eq.emprcodi = {2}

    </query>
  </Sql>

  <Sql>
    <key>ListarPtomedicionDespachoAntiguo</key>
    <query>
      select pto.* from me_ptomedicion pto
      inner join eq_equipo eq on eq.equicodi = pto.equicodi
      where origlectcodi = 2 and eq.emprcodi = {0} and pto.ptomediestado = 'A' and eq.equiestado = 'A'
    </query>
  </Sql> 
  <!--FIN Mejoras IEOD-->

  <!--INICIO Titularidad-Instalaciones-Empresas-->

  <Sql>
    <key>ListarPtomedicionByMigracodi</key>
    <query>
      select pto.PTOMEDICODI
      ,(case when pto.PTOMEDIELENOMB is null then pto.PTOMEDIDESC else pto.PTOMEDIELENOMB end) PTOMEDIELENOMB
      ,emp.EMPRCODI
      ,emp.EMPRNOMB
      ,emp2.EMPRNOMB AS EMPRNOMB_ORIGEN
      ,pto.ORIGLECTCODI
      ,olect.ORIGLECTNOMBRE
      ,pto.PTOMEDIESTADO
      from me_ptomedicion pto
      inner join si_empresa emp on emp.emprcodi=pto.emprcodi
      inner join ME_ORIGENLECTURA olect on olect.ORIGLECTCODI=pto.ORIGLECTCODI
      inner join SI_HISEMPPTO mpto on mpto.PTOMEDICODIOLD=pto.PTOMEDICODI
      INNER JOIN si_migraemprorigen eo on eo.migracodi= mpto.migracodi
      INNER JOIN SI_MIGRACION mig on mig.migracodi =eo.migracodi
      inner join si_empresa emp2 on emp2.emprcodi=eo.emprcodi
      where
      ( mig.MIGRACODI = {0})
      order by pto.ORIGLECTCODI, pto.PTOMEDIELENOMB
    </query>
  </Sql>

  <!--FIN Titularidad-Instalaciones-Empresas-->
  
  <!--INICIO FIT- Aplicativo VTD-->

  <Sql>
    <key>GetPtoDuplicadoTransferencia</key>
    <query>
      select
      *
      from
      me_ptomedicion
      where
      clientecodi = {0} and
      barrcodi = {1} and
      origlectcodi = {2} and
      TPTOMEDICODI = {3}
    </query>
  </Sql>

  <Sql>
    <key>GetByIdCliente</key>
    <query>
      select
      pto.ptomedicodi,pto.lastdate,pto.lastuser,pto.emprcodi,pto.grupocodi,pto.osicodi,pto.equicodi,pto.codref,
      pto.ptomedidesc,pto.orden,pto.ptomedielenomb,pto.ptomedibarranomb,pto.origlectcodi,pto.TPTOMEDICODI,pto.ptomediestado,
      pto.clientecodi, pto.barrcodi, tpto.tipoinfocodi
      from
      me_ptomedicion pto
      inner join
      me_tipoptomedicion tpto on tpto.TPTOMEDICODI = pto.TPTOMEDICODI
      where
      pto.clientecodi = :clientecodi
    </query>
  </Sql>

  <Sql>
    <key>TotalListaPtoMedicionTransferencia</key>
    <query>
      select
      count(*) total
      from
      me_ptomedicion pto
      where
      (pto.emprcodi in ({0}) or '{0}' = '-1') and
      (pto.origlectcodi in ({1}) or '{1}' = '-1') and
      (pto.clientecodi in ({2}) or '{2}' = '-2') and
      (pto.barrcodi  in ({3}) or '{3}' = '-2') and
      (pto.ptomedicodi = {4} or {4} = -1)
    </query>
  </Sql>

  <Sql>
    <key>ListarDetallePtoMedicionFiltroTransferencia</key>
    <query>
      select * from
      (
      select total.*, (row_number() over (order by total.{7} {8})) as r from (
      select
      pto.*,
      orig.Origlectnombre,
      emp.Emprnomb,
      '' as equinomb,
      '' as famnomb,
      tpto.TPTOMEDINOMB,
      '' as areaoperativa,
      '' as desubicacion,
      0 as niveltension,
      (select emprnomb from si_empresa semp where semp.emprcodi = pto.clientecodi) as cliennomb,
      barr.BARRNOMBRE as barranomb
      from
      me_ptomedicion pto
      inner join
      me_origenlectura orig on orig.origlectcodi = pto.origlectcodi
      inner join
      si_empresa emp on emp.emprcodi = pto.emprcodi
      inner join
      me_tipoptomedicion tpto on tpto.TPTOMEDICODI = pto.TPTOMEDICODI
      inner join
      trn_barra barr on barr.BARRCODI = pto.BARRCODI
      where
      (pto.emprcodi in ({0}) or '{0}' = '-1') and
      (pto.origlectcodi in ({1}) or '{1}' = '-1') and
      (pto.clientecodi in ({2}) or '{2}' = '-2') and
      (pto.barrcodi  in ({3}) or '{3}' = '-2') and
      (pto.ptomedicodi = {4} or {4} = -1)
      ) total
      )
      where r >= ((({5}-1) * {6}) + 1) and r &lt; (({5} * {6}) + 1 )
    </query>
  </Sql>

  <Sql>
    <key>GetByIdClienteBarraMePtomedicion</key>
    <query>
      select * from me_ptomedicion where emprcodi = {0} and (clientecodi = {1} or '{1}' = '-1') and (barrcodi = {2} or '{2}' = '-1')
      and origlectcodi = {3}
    </query>
  </Sql>

  <!--FIN FIT - Aplicativo VTD-->

  <!--INICIO Numerales Estados Base-->
  <Sql>
    <key>ListaDatosBase_5_8_1</key>
    <query>
      SELECT
      case
      when e.Equinomb &lt;> '_NO DEFINIDO' then e.Equinomb
      else N.PTOMEDIDESC
      end as  EQUINOMB,
      case
      when E.OSIGRUPOCODI &lt;> '00000' then E.OSIGRUPOCODI
      else (select OSICODI from pr_grupo where grupocodi =  N.Codref)
      end as OSICODI,
      M.Meditotal as VALOR,
      N.*
      FROM ME_MEDICION48 M, ME_PTOMEDICION N, EQ_EQUIPO E
      WHERE medifecha between to_date('{0}', 'DD-MM-YYYY') and
      to_date('{1} 23:59:59', 'DD-MM-YYYY HH24:MI:SS')
      and lectcodi = 4
      and M.tipoinfocodi = 1
      and N.Ptomedicodi = M.Ptomedicodi
      AND E.EQUICODI = n.Equicodi
    </query>
  </Sql>
  <Sql>
    <key>ListaDatosBase_5_8_2</key>
    <query>
      SELECT
      case
      when e.Equinomb &lt;> '_NO DEFINIDO' then e.Equinomb
      else N.PTOMEDIDESC
      end as  EQUINOMB,
      case
      when E.OSIGRUPOCODI &lt;> '00000' then E.OSIGRUPOCODI
      else (select OSICODI from pr_grupo where grupocodi = N.Codref)
      end as OSICODI,
      M.Meditotal as VALOR,
      N.*
      FROM ME_MEDICION48 M, ME_PTOMEDICION N, EQ_EQUIPO E
      WHERE medifecha between to_date('{0}', 'DD-MM-YYYY') and
      to_date('{1} 23:59:59', 'DD-MM-YYYY HH24:MI:SS')
      and lectcodi = 6
      and M.tipoinfocodi = 1
      and N.Ptomedicodi = M.Ptomedicodi
      AND E.EQUICODI = n.Equicodi
    </query>
  </Sql>

  <Sql>
    <key>ListaPtoUsuariosLibres</key>
    <query>
      select m.ptomedicodi, em.emprcodi, em.emprabrev, em.emprrazsocial, em.emprruc, a.areacodi, a.areanomb, eq.equicodi, eq.equitension, m.ptomedielenomb from ME_PTOMEDICION m
      inner join SI_EMPRESA em on m.emprcodi = em.emprcodi
      inner join EQ_EQUIPO eq on m.equicodi = eq.equicodi
      inner join EQ_AREA a on eq.areacodi = a.areacodi
      where m.origlectcodi = 6
      and em.tipoemprcodi = {0}
      and em.inddemanda = 'S'
      and eq.equiestado not in ('B', 'X')
      order by em.emprrazsocial, a.areanomb, m.ptomedielenomb
    </query>
  </Sql>

  <!--FIN Numerales Estados Base-->

  <Sql>
    <key>ListByRecurcodiTermo</key>
    <query>
      SELECT * FROM ME_PTOMEDICION PTO
      INNER JOIN CP_RECURSO REC ON REC.RECURCODISICOES =  PTO.GRUPOCODI
      WHERE PTO.ORIGLECTCODI = 2
      AND REC.RECURCODI = {0}
    </query>
  </Sql>


  <Sql>
    <key>ListByRecurcodiHidro</key>
    <query>
      SELECT  * FROM ME_PTOMEDICION PTO
      INNER JOIN PR_GRUPO GR2 ON GR2.GRUPOCODI = PTO.GRUPOCODI
      INNER JOIN EQ_EQUIPO EQ2 ON EQ2.GRUPOCODI = GR2.GRUPOPADRE
      INNER JOIN CP_RECURSO REC ON REC.RECURCODISICOES =  EQ2.EQUIPADRE
      WHERE PTO.ORIGLECTCODI = 2 AND GR2.CATECODI = 9
      AND REC.RECURCODI = {0}
    </query>
  </Sql>

  <Sql>
    <key>ListaPuntoByEquipo</key>
    <query>
      Select
        ptomedicodi,
        ptomedielenomb,
        ptomedidesc
      from me_ptomedicion
      where equicodi = {0} and ptomediestado = 'A'
      order by ptomedielenomb
    </query>
  </Sql>

  <Sql>
    <key>ListaPuntoByOrigenEmpresa</key>
    <query>
      Select
      ptomedicodi,
      ptomedielenomb,
      ptomedidesc
      from me_ptomedicion
      where origlectcodi = {0} and emprcodi = {1} and ptomediestado = 'A'
      order by ptomedielenomb
    </query>
  </Sql>


	<!--region NotificacionesCambiosPuntos-->
	<Sql>
		<key>PuntosModificados</key>
		<query>
			select
			pto.ptomedibarranomb,
			pto.ptomedielenomb,
			pto.ptomedidesc,
			eq.equinomb,
			g.gruponomb,
			e.emprnomb,
			tpto.tptomedinomb,
			ol.origlectnombre,
			pto.ptomediestado,
			pto.lastdate,
			pto.lastuser
			from me_ptomedicion pto
			left join eq_equipo eq on eq.equicodi = pto.equicodi
			left join pr_grupo g on g.grupocodi = pto.grupocodi
			left join si_empresa e on e.emprcodi = pto.emprcodi
			left join me_tipoptomedicion tpto on tpto.tptomedicodi = pto.tptomedicodi
			left join me_origenlectura ol on ol.origlectcodi = pto.origlectcodi
			where
			pto.lastdate >=  to_date('{0}', 'DD-MM-YYYY HH24:MI') and
			pto.lastdate &lt;=  to_date('{1}', 'DD-MM-YYYY HH24:MI')
		</query>
	</Sql>
	<!--region NotificacionesCambiosPuntos -->


	<Sql>
		<key>ObtenerPuntosMedicionReporte</key>
		<query>
      select
      hp.ptomedicodi,ti.tipoinfocodi,
      eq.equicodi,f.famabrev,coalesce(eq.equiabrev, eq.equinomb) as equinomb,ti.tipoinfoabrev,emp.emprcodi,emp.emprnomb,emp.emprabrev,
      tpmed.tptomedicodi,tpmed.tptomedinomb,eq.famcodi, pto.ptomedibarranomb, pto.ptomedielenomb,
      pto.ptomedidesc,pto.codref,
      ar.areanomb, ar.areacodi, eq.areacodi subestacioncodi,
      (select listagg(pr.canalcodi, ',') within group (order by pr.canalcodi) as canales from me_ptomedcanal pr where pr.ptomedicodi = hp.ptomedicodi and pr.tipoinfocodi = {1}) as canales,
      (select trim(ap.areaabrev) from eq_area ap where ap.areacodi = pto.areacodi) areaoperativa,
      eq.equitension as Niveltension,
      HP.REPPTOORDEN as orden,
      hp.Repptonomb,
      (select rpto.REPPTOCOLORCELDA from me_reporptomed rpto where rpto.ptomedicodi = pto.ptomedicodi and rpto.reporcodi = {0} and rownum = 1) as colorcelda
      from me_reporptomed hp
      inner join me_ptomedicion pto on pto.ptomedicodi = hp.ptomedicodi
      inner join eq_equipo eq on eq.equicodi = pto.equicodi
      inner join eq_familia f on f.famcodi = eq.famcodi
      inner join eq_area ar on ar.areacodi = eq.areacodi
      inner join si_tipoinformacion ti on ti.tipoinfocodi = {1}
      inner join me_tipoptomedicion tpmed on tpmed.tptomedicodi = pto.tptomedicodi
      inner join si_empresa emp on emp.emprcodi = pto.emprcodi
      where hp.reporcodi = {0}
      order by emp.emprnomb,pto.ptomedibarranomb,coalesce(eq.equinomb, eq.equiabrev),ti.tipoinfocodi  asc
    </query>
	</Sql>

	<Sql>
		<key>ListaPuntoByOrigenEmpresa</key>
		<query>
			Select
			ptomedicodi,
			ptomedielenomb,
			ptomedidesc
			from me_ptomedicion
			where origlectcodi = {0} and (emprcodi = {1} OR 0 = {1}) and ptomediestado = 'A'
			order by ptomedielenomb
		</query>
	</Sql>

	<Sql>
		<key>ListaPuntoMedicionByLista</key>
		<query>
			Select
			ptomedicodi,
			ptomedielenomb,
			ptomedidesc
			from me_ptomedicion
			where ptomedicodi in ({0})
			order by ptomedicodi
		</query>
	</Sql>

	<Sql>
		<key>ListaPuntoSicliByEmpresa</key>
		<query>
      SELECT
      PTO.PTOMEDICODI,
      PTO.PTOMEDIELENOMB ||' / ' ||sumi.emprabrev ||' (' || PTO.PTOMEDICODI||')' || ' - ' || SUMI.EMPRESTADO  PTOMEDIDESC
      FROM ME_PTOMEDICION PTO
      JOIN EQ_EQUIPO EQ ON PTO.EQUICODI = EQ.EQUICODI
      JOIN SI_EMPRESA EMCL ON EQ.EMPRCODI = EMCL.EMPRCODI
      JOIN SI_EMPRESA SUMI ON PTO.EMPRCODI = SUMI.EMPRCODI
      WHERE
      PTO.ORIGLECTCODI = {0}
      and (EMCL.EMPRCODI = {1} OR 0 = {1})
      ORDER BY PTO.PTOMEDIELENOMB
    </query>
	</Sql>
  
  <!--INICIO.CPPA.2024.ASSETEC-->
  <Sql>
    <key>ListaCentralesPMPO</key>
    <query>
      select * from (
      select mi.ptomedicodi,
      gr.gruponomb,
      '[' || mi.ptomedicodi || '] ' || trim(pto.PTOMEDIDESC) ||
      CASE
      WHEN pto.ptomediestado = 'B' THEN ' [' || pto.ptomediestado || ']'
      ELSE ''
      END AS ptomedidesc,
      gr.emprcodi,
      gr.fenergcodi,
      si.tgenercodi,
      COALESCE(gr.grupotipocogen, 'N') as grupotipocogen
      from ME_MEDICIONXINTERVALO mi
      inner JOIN ME_PTOMEDICION PTO ON MI.PTOMEDICODI = PTO.PTOMEDICODI
      left JOIN PR_GRUPO GR ON PTO.GRUPOCODI = GR.GRUPOCODI
      left join si_fuenteenergia si ON si.fenergcodi = GR.fenergcodi
      WHERE MI.LECTCODI= 109 AND MI.TPTOMEDICODI = 69 AND MI.enviocodi in (select enviocodi from me_envio where formatcodi = 100)
      ) t
      where emprcodi =  {0}
      group by ptomedicodi, gruponomb, ptomedidesc, emprcodi, fenergcodi, tgenercodi, grupotipocogen
      ORDER BY PTOMEDIDESC
    </query>
  </Sql>

  <Sql>
    <key>ListaBarrasPMPO</key>
    <query>
      SELECT *
      FROM (
      SELECT
      pto.ptomedicodi,
      '[' || pto.ptomedicodi || '] ' || TRIM(pto.PTOMEDIDESC) ||
      CASE
      WHEN pto.ptomediestado = 'B' THEN ' [' || pto.ptomediestado || ']'
      ELSE ''
      END AS PTOMEDIDESC
      FROM ME_MEDICIONXINTERVALO mi
      INNER JOIN ME_PTOMEDICION pto ON mi.ptomedicodi = pto.ptomedicodi
      WHERE mi.lectcodi = 109
      AND mi.tptomedicodi = 80
      AND mi.medintblqnumero = 1
      GROUP BY pto.ptomedicodi, pto.PTOMEDIDESC, pto.ptomediestado
      ) t
      ORDER BY t.PTOMEDIDESC
    </query>
  </Sql>
  <!--FIN.CPPA.2024.ASSETEC-->  
</Sqls>
