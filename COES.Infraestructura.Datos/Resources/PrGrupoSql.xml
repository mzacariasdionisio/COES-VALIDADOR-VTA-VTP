<?xml version="1.0" encoding="utf-8" ?>
<Sqls>

  <Sql>
    <key>GetMaxId</key>
    <query>
       select nvl(max(grupocodi), 0) + 1 from pr_grupo
    </query>
  </Sql>

  <Sql>
    <key>Save</key>
    <query>
      insert into pr_grupo(
      grupocodi,
      barracodi,
      gruponomb,
      grupoabrev,
      grupovmax,
      grupovmin,
      grupoorden,
      emprcodi,
      grupotipo,
      catecodi,
      grupotipoc,
      grupopadre,
      grupoactivo,
      grupocomb,
      osicodi,
      grupocodi2,
      lastuser,
      lastdate,
      gruposub,
      barracodi2,
      barramw1,
      barramw2,
      gruponombncp,
      tipogrupocodi,
      fenergcodi,
      tipogrupocodi2,
      tipogenerrer,
      osinergcodi,
      grupotipocogen,
      grupointegrante,
      grupotension,
      gruponodoenergetico,
      gruporeservafria,
      grupoestado,
      areacodi,
      curvcodi,
      grupousumodificacion,
      grupofecmodificacion,
      grupotipomodo,
      grupousucreacion,
      grupofeccreacion
      )
      values(
      :grupocodi,
      :barracodi,
      :gruponomb,
      :grupoabrev,
      :grupovmax,
      :grupovmin,
      :grupoorden,
      :emprcodi,
      :grupotipo,
      :catecodi,
      :grupotipoc,
      :grupopadre,
      :grupoactivo,
      :grupocomb,
      :osicodi,
      :grupocodi2,
      :lastuser,
      :lastdate,
      :gruposub,
      :barracodi2,
      :barramw1,
      :barramw2,
      :gruponombncp,
      :tipogrupocodi,
      :fenergcodi,
      :tipogrupocodi2,
      :tipogenerrer,
      :osinergcodi,
      :grupotipocogen,
      :grupointegrante,
      :grupotension,
      :gruponodoenergetico,
      :gruporeservafria,
      :grupoestado,
      :areacodi,
      :curvcodi,
      :grupousumodificacion,
      :grupofecmodificacion,
      :grupotipomodo,
      :grupousucreacion,
      :grupofeccreacion
      )
    </query>
  </Sql>

  <Sql>
    <key>Update</key>
    <query>
      update pr_grupo
      set
      barracodi = :barracodi,
      gruponomb = :gruponomb,
      grupoabrev = :grupoabrev,
      grupovmax = :grupovmax,
      grupovmin = :grupovmin,
      grupoorden = :grupoorden,
      emprcodi = :emprcodi,
      grupotipo = :grupotipo,
      catecodi = :catecodi,
      grupotipoc = :grupotipoc,
      grupopadre = :grupopadre,
      grupoactivo = :grupoactivo,
      grupocomb = :grupocomb,
      osicodi = :osicodi,
      grupocodi2 = :grupocodi2,
      lastuser = :lastuser,
      lastdate = :lastdate,
      gruposub = :gruposub,
      barracodi2 = :barracodi2,
      barramw1 = :barramw1,
      barramw2 = :barramw2,
      gruponombncp = :gruponombncp,
      tipogrupocodi = :tipogrupocodi,
      fenergcodi = :fenergcodi,
      tipogrupocodi2 = :tipogrupocodi2,
      tipogenerrer = :tipogenerrer,
      osinergcodi = :osinergcodi,
      grupotipocogen = :grupotipocogen,
      grupointegrante = :grupointegrante,
      grupotension = :grupotension,
      gruponodoenergetico = :gruponodoenergetico,
      gruporeservafria = :gruporeservafria,
      grupoestado = :grupoestado,
      areacodi = :areacodi,
      curvcodi = :curvcodi,
      grupousumodificacion = :grupousumodificacion,
      grupofecmodificacion = :grupofecmodificacion,
      grupotipomodo = :grupotipomodo
      where
      grupocodi = :grupocodi
    </query>
  </Sql>

  <Sql>
    <key>Delete</key>
    <query>
       delete from pr_grupo
       where
           grupocodi = :grupocodi
    </query>
  </Sql>

	<Sql>
		<key>UpdateAuditoria</key>
		<query>
			update aud_pr_grupo
			set USERAUDITORIA = :grupousumodificacion
			where
			grupocodi = :grupocodi
			and ACTIONAUDITORIA = 'DELETE'
		</query>
	</Sql>

  <Sql>
    <key>GetById</key>
    <query>
      select
      gr.*,
      emp.EMPRNOMB,
      grp.grupopadre as grupocentral,
      cat.CATENOMB,
      ar.areanomb
      from pr_grupo gr
      INNER JOIN pr_categoria cat on cat.catecodi=gr.catecodi
      left join si_empresa emp on emp.EMPRCODI = gr.EMPRCODI
      left join pr_grupo grp on gr.GRUPOPADRE = grp.grupocodi
      left JOIN eq_area ar on ar.areacodi = gr.areacodi
      where
      gr.grupocodi = :grupocodi
    </query>
  </Sql>

  <Sql>
    <key>ActualizacionesCostosVariables</key>
    <query>
      SELECT * FROM PR_REPCV WHERE REPFECHA >=  TO_DATE('{0}','YYYY-MM-DD')  AND REPFECHA &lt; TO_DATE('{1}','YYYY-MM-DD')  ORDER BY REPFECHA DESC, REPTIPO ASC
    </query>
  </Sql>

  <Sql>
    <key>CostosVariablesxActualizacion</key>
    <query>
      SELECT GR.GRUPONOMB AS GRUPO,
      ES.ESCENOMB AS ESCENARIO,
      CV.PE, CV.EFICBTUKWH,
      CV.EFICTERM ,
      CV.CCOMB,
      CV.CVC,
      CV.CVNC,
      CV.FPMAX,
      CV.FPMED,
      CV.FPMIN
      FROM PR_CVARIABLES CV,
      PR_GRUPO GR,
      PR_ESCENARIO ES
      WHERE CV.GRUPOCODI=GR.GRUPOCODI AND
      CV.ESCECODI=ES.ESCECODI AND
      REPCODI = {0}
      ORDER BY ES.ESCECODI, GR.GRUPONOMB
    </query>
  </Sql>

  <Sql>
    <key>List</key>
    <query>
      select
      g.*, trim(FENERGNOMB) FENERGNOMB,TRIM(emp.emprnomb) EMPRNOMB, t.tgenernomb
      from pr_grupo g
      left join si_empresa emp on g.emprcodi = emp.emprcodi
      left join si_fuenteenergia f on f.fenergcodi = g.fenergcodi
      left join si_tipogeneracion t on t.tgenercodi = f.tgenercodi
      where '-1'='{0}' or g.catecodi in ({0})
    </query>
  </Sql>

  <Sql>
    <key>GetByEmprcodiAndCatecodi</key>
    <query>
      select
      g.*, trim(FENERGNOMB) FENERGNOMB,TRIM(emp.emprnomb) EMPRNOMB
      from pr_grupo g
      left join si_empresa emp on g.emprcodi = emp.emprcodi
      left join si_fuenteenergia f on f.fenergcodi = g.fenergcodi
      where g.emprcodi = :emprcodi and g.catecodi = :catecodi and grupoestado in ('A','F','P')
    </query>
  </Sql>

  <Sql>
    <key>GetByCriteria</key>
    <query>
		select distinct
		pg.*,
		tg.tipogruponomb,
		emp.emprnomb
		from
		pr_grupo pg inner join pr_tipogrupo tg on pg.tipogrupocodi = tg.tipogrupocodi
		inner join si_empresa emp on pg.emprcodi = emp.emprcodi
		inner join me_ptomedicion pto on pg.grupocodi = pto.grupocodi
		where ((pg.tipogrupocodi = :tipogrupocodi and :tipogrupocodi != 3) or
		(( pg.tipogrupocodi = :tipogrupocodi or pg.tipogrupocodi2 = :tipogrupocodi)
		and :tipogrupocodi = 3) or :tipogrupocodi = 0) and  pto.origlectcodi = 15
		and emprestado = 'A'
		order by emp.emprnomb asc
	</query>
  </Sql>
  
  <Sql>
    <key>ListarGeneradoresDespachoOsinergmin</key>
    <query>
      select pr.grupocodi, 
      pr.gruponomb,
      pr.grupopadre,
      (select min(eq.equifechiniopcom) from eq_equipo eq where eq.grupocodi=pr.grupocodi and eq.equiestado='A') equifechiniopcom,
      (select max(eq.equifechfinopcom) from eq_equipo eq where eq.grupocodi=pr.grupocodi and eq.equiestado='A') equifechfinopcom
      from PR_GRUPO pr
      where
      pr.catecodi in (3,5)
      and pr.grupoactivo='S'
    </query>
  </Sql>

  <Sql>
    <key>ListaModosOperacionActivos</key>
    <query>
      select pr.*,em.EMPRNOMB,pr2.GRUPOPADRE GRUPOCENTRAL from pr_grupo pr
      left join si_empresa em on pr.EMPRCODI=em.EMPRCODI
      left join pr_grupo pr2 on pr2.GRUPOCODI=pr.GRUPOPADRE
      where pr.catecodi =2 and pr.grupoactivo='S'
    </query>
  </Sql>

  <Sql>
    <key>ListaModosOperacion</key>
    <query>
      select pr.*,em.EMPRNOMB,pr2.GRUPOPADRE GRUPOCENTRAL 
      from pr_grupo pr
      left join si_empresa em on pr.EMPRCODI=em.EMPRCODI
      left join pr_grupo pr2 on pr2.GRUPOCODI=pr.GRUPOPADRE
      where pr.catecodi =2
    </query>
  </Sql>

  <Sql>
    <key>ListaModosOperacionActivosXCategoria</key>
    <query>
      select * from pr_grupo where (catecodi in({0}) or '{0}'='-1') and grupoactivo='S'
    </query>
  </Sql>

  <Sql>
    <key>CambiarTipoGrupo</key>
    <query>
      update pr_grupo
      set
      tipogrupocodi = :tipogrupocodi,
      tipogrupocodi2 = :tipogrupocodi2,
      tipogenerrer = :tipogenerrer,
      lastuser = :lastuser,
      lastdate = :lastdate
      where grupocodi = :grupocodi
    </query>
  </Sql>
  
  <Sql>
    <key>ModosOperacionPorCentral1</key>
    <query>
      select GRUPOCODI,GRUPONOMB,GRUPOABREV,-1 EQUICODI,GRUPONOMB MODONOM 
      from pr_grupo 
      where 
      grupopadre in (select distinct grupocodi from EQ_EQUIPO t where t.equipadre=:idCentral and grupocodi>0) and 
      GRUPOACTIVO ='S' and catecodi=2
    </query>
  </Sql>
  
  <Sql>
    <key>ModosOperacionPorCentral2</key>
    <query>
      select equicodi,grupocodi
      from pr_equipodat
      where grupocodi in (select grupocodi from pr_grupo where grupopadre in (select distinct grupocodi from EQ_EQUIPO t where t.equipadre=:idCentral) and GRUPOACTIVO ='S')
      and deleted = 0
      group by equicodi,grupocodi
    </query>
  </Sql>
  
  <Sql>
    <key>ObtenerCodigoModoOperacionPadre</key>
    <query>
      select grupopadre from pr_grupo where grupocodi=:grupocodi
    </query>
  </Sql>
  
  <Sql>
    <key>ModosOperacionxFiltro</key>
    <query>
      SELECT
      *
      from (
      SELECT
      PR_GRUPO_A.*,
      SI_EMPRESA.EMPRNOMB,
      (row_number() over (order by PR_GRUPO_A.GRUPOCODI)) as r
      FROM PR_GRUPO PR_GRUPO_A,
      SI_EMPRESA
      WHERE PR_GRUPO_A.EMPRCODI = SI_EMPRESA.EMPRCODI AND
      pr_grupo_a.catecodi in (2) AND (PR_GRUPO_A.GRUPOACTIVO ='{0}' OR '{0}'=' ') AND
      (PR_GRUPO_A.EMPRCODI={1} OR {1}=0) AND PR_GRUPO_A.GRUPONOMB like '%{2}%' order by PR_GRUPO_A.GRUPOCODI)
      where (r >= ((({3}-1) * {4}) + 1) and r &lt; (({3} * {4}) + 1 )) or ({3} = -1 and {4} = -1)
    </query>
  </Sql>
  
  <Sql>
    <key>CantidadModosOperacionxFiltro</key>
    <query>
      SELECT COUNT(*)
      FROM PR_GRUPO PR_GRUPO_A,
      SI_EMPRESA
      WHERE PR_GRUPO_A.EMPRCODI = SI_EMPRESA.EMPRCODI AND
      pr_grupo_a.catecodi in (2) AND PR_GRUPO_A.GRUPOACTIVO ='{0}' AND
      (PR_GRUPO_A.EMPRCODI={1} OR {1}=0) AND PR_GRUPO_A.GRUPONOMB like '%{2}%'
    </query>
  </Sql>
  
  <Sql>
    <key>ObtenerModoOperacion</key>
    <query>
      SELECT
      PR_GRUPO_A.*,
      SI_EMPRESA.EMPRNOMB
      FROM PR_GRUPO PR_GRUPO_A,
      SI_EMPRESA
      WHERE PR_GRUPO_A.EMPRCODI = SI_EMPRESA.EMPRCODI AND PR_GRUPO_A.GRUPOCODI = :grupocodi
    </query>
  </Sql>
  
  <Sql>
    <key>DatosVigentesPorModoOperacion</key>
    <query>
      SELECT
      CNP.CONCEPDESC,
      CNP.CONCEPABREV,
      CNP.CONCEPORDEN,
      DAT.CONCEPCODI,
      CNP.CONCEPUNID,
      DAT.FORMULADAT,
      DAT.FECHADAT,
      GR.GRUPOCODI,
      GR.CATECODI GRUPOCATECODI,
      DAT.LASTUSER,
      DAT.FECHAACT,
      CNP.CATECODI CONCEPTOCATECODI
      FROM PR_GRUPODAT DAT, PR_CONCEPTO CNP, PR_GRUPO GR,
      (SELECT GRUPOCODI,CONCEPCODI, MAX(FECHADAT) AS FECHAMAX FROM PR_GRUPODAT WHERE DELETED = 0 AND GRUPOCODI IN ( {0} ) AND FECHADAT &lt;  TO_DATE('{1}','YYYY-MM-DD HH24:MI:SS') GROUP BY GRUPOCODI,CONCEPCODI) VI
      WHERE
      DAT.DELETED = 0 AND
      DAT.GRUPOCODI = VI.GRUPOCODI AND
      DAT.CONCEPCODI= VI.CONCEPCODI AND
      DAT.FECHADAT=VI.FECHAMAX AND
      CNP.CONCEPCODI=DAT.CONCEPCODI AND
      GR.GRUPOCODI = VI.GRUPOCODI AND
      (CNP.CONCEPFICHATEC='{2}' OR '{2}'='*')
      ORDER BY CONCEPDESC
    </query>
  </Sql>

  <Sql>
    <key>ListCentrales</key>
    <query>
			select * from pr_grupo where grupocodi in (
				select gru.grupopadre
				from pr_grupo gr
				inner join pr_grupo gru on gru.grupocodi = gr.grupopadre
				where gr.fenergcodi in ({0}) and gr.catecodi in (2,3,4) and ( gr.emprcodi in ({1}) or '{1}' = '-1' )
				
				union all
				
				select gr.grupocodi
				from pr_grupo gr
				where gr.fenergcodi in ({0}) and gr.catecodi in (4) and ( gr.emprcodi in ({1}) or '{1}' = '-1' )
			)
      and catecodi = 4 and grupocodi >0
			order by gruponomb
		</query>
  </Sql>
  
  <Sql>
    <key>ParametrosModoOperacionCompensacion</key>
    <query>
      SELECT PR_GRUPO_A.GRUPOCODI,
      PR_GRUPO_A.GRUPONOMB,
      PR_GRUPO_A.GRUPOABREV,
      PR_GRUPO_A.GRUPOPADRE,
      PR_GRUPO_B.GRUPONOMB AS GRUPONOMBPADRE,
      PR_GRUPO_B.GRUPOPADRE AS GRUPOCENTRAL,
      FN_SDATO_CONCEPTO_FECHA(PR_GRUPO_A.GRUPOCODI,146,sysdate) AS COMBUSTIBLE,
      FN_SDATO_CONCEPTO_FECHA(PR_GRUPO_A.GRUPOCODI,16,sysdate) AS POT_MIN,
      FN_SDATO_CONCEPTO_FECHA(PR_GRUPO_A.GRUPOCODI,14,sysdate) AS POT_EFEC,
      FN_SDATO_CONCEPTO_FECHA(PR_GRUPO_A.GRUPOCODI,187,sysdate) AS A,
      FN_SDATO_CONCEPTO_FECHA(PR_GRUPO_A.GRUPOCODI,188,sysdate) AS B,
      FN_SDATO_CONCEPTO_FECHA(PR_GRUPO_A.GRUPOCODI,189,sysdate) AS C,
      FN_SDATO_CONCEPTO_FECHA(PR_GRUPO_A.GRUPOPADRE,195,sysdate) AS LHV,
      FN_SDATO_CONCEPTO_FECHA(PR_GRUPO_A.GRUPOCODI,190,sysdate) AS EFIC_NOM,
      FN_SDATO_CONCEPTO_FECHA(PR_GRUPO_A.GRUPOCODI,193,sysdate) AS CE_CALOR
      FROM PR_GRUPO PR_GRUPO_A,
      PR_GRUPO PR_GRUPO_B,
      SI_EMPRESA
      WHERE PR_GRUPO_A.GRUPOPADRE = PR_GRUPO_B.GRUPOCODI AND
      PR_GRUPO_B.EMPRCODI = SI_EMPRESA.EMPRCODI AND
      PR_GRUPO_A.GRUPOCODI = {0} AND
      PR_GRUPO_A.CATECODI = 2 AND
      PR_GRUPO_A.GRUPOACTIVO='S'
    </query>
  </Sql>

  <Sql>
    <key>ObtenerTipoCombustiblePorCentral</key>
    <query>
		select distinct empresa.emprcodi, empresa.emprnomb, grupo.gruponomb, temporal.* from (
		select grupo.grupopadre as grupocodi, temporal.fenergcodi, temporal.fenergnomb from (
		select distinct grupo.grupopadre as grupocodi, fuente.fenergcodi, fuente.fenergnomb
		from pr_grupo grupo
		inner join si_fuenteenergia fuente
		on grupo.fenergcodi = fuente.fenergcodi
		where grupo.grupocodi > 0 and fuente.fenergcodi > 0 and grupo.grupoactivo = 'S'
		and grupo.catecodi in (2) and grupo.fenergcodi in (2,3,5,6,7,10,11))  temporal inner join pr_grupo grupo on temporal.grupocodi = grupo.grupocodi
		)
		temporal inner join pr_grupo grupo on temporal.grupocodi = grupo.grupocodi
		inner join si_empresa empresa on grupo.emprcodi = empresa.emprcodi
		order by 2 asc,  3 asc, 6 asc
	</query>
  </Sql>
  
  <Sql>
    <key>ListadoModosFuncionalesTermicosActivos</key>
    <query>
      SELECT PR_GRUPO_A.GRUPOCODI,
      PR_GRUPO_A.GRUPONOMB,
      PR_GRUPO_A.CATECODI,
      PR_GRUPO_A.EMPRCODI,
      PR_GRUPO_A.GRUPOABREV,
      PR_GRUPO_A.GRUPOACTIVO,
      PR_GRUPO_A.GRUPOVMAX,
      PR_GRUPO_A.GRUPOVMIN,
      PR_GRUPO_A.GRUPOORDEN,
      PR_GRUPO_A.GRUPOTIPO,
      PR_GRUPO_A.GRUPOPADRE,
      PR_GRUPO_B.GRUPONOMB AS GRUPONOMBPADRE,
      SI_EMPRESA.EMPRNOMB,
      PR_GRUPO_B.EMPRCODI,
      PR_GRUPO_B.BARRACODI,
      PR_GRUPO_B.GRUPOPADRE AS GRUPOCENTRAL
      FROM PR_GRUPO PR_GRUPO_A,
      PR_GRUPO PR_GRUPO_B,
      SI_EMPRESA
      WHERE PR_GRUPO_A.GRUPOPADRE = PR_GRUPO_B.GRUPOCODI AND
      PR_GRUPO_B.EMPRCODI = SI_EMPRESA.EMPRCODI AND
      PR_GRUPO_A.GRUPOCODI > 0 AND PR_GRUPO_A.CATECODI = 2 AND PR_GRUPO_A.GRUPOACTIVO='S'
      ORDER BY GRUPOTIPO DESC, EMPRNOMB, PR_GRUPO_A.GRUPOORDEN, PR_GRUPO_A.GRUPOABREV
    </query>
  </Sql>

  <Sql>
    <key>ObtenerArbolGrupoDespacho</key>
    <query>
      select
      *
      from pr_grupo
      where
      grupoactivo = 'S' and
      catecodi in (4, 6, 3, 5, 2, 9, 15, 16, 17, 18) and
      (emprcodi in ({0}) or '{0}' = '-1') and
      grupotipo = '{1}'
      order by gruponomb asc
    </query>
  </Sql>

  <Sql>
    <key>ObtenerCentralesPorGrupo</key>
    <query>
      select
      grupocodi,
      gruponomb
      from
      pr_grupo
      where
      catecodi in (4, 6, 16, 18) and grupotipo = '{0}' and (emprcodi in ({1}) or '{1}' = '-1')
      order by gruponomb asc
    </query>
  </Sql>
  
  <Sql>
    <key>ListadoModosFuncionalesCostosVariables</key>
    <query>
      SELECT PR_GRUPO_A.GRUPOCODI,
      PR_GRUPO_A.GRUPONOMB,
      PR_GRUPO_A.CATECODI,
      PR_GRUPO_A.EMPRCODI,
      PR_GRUPO_A.GRUPOABREV,
      PR_GRUPO_A.GRUPOACTIVO,
      PR_GRUPO_A.GRUPOVMAX,
      PR_GRUPO_A.GRUPOVMIN,
      PR_GRUPO_A.GRUPOORDEN,
      PR_GRUPO_A.GRUPOTIPO,
      PR_GRUPO_A.GRUPOPADRE,
      PR_GRUPO_B.GRUPONOMB AS GRUPONOMBPADRE,
      SI_EMPRESA.EMPRNOMB,
      PR_GRUPO_B.EMPRCODI,
      PR_GRUPO_B.BARRACODI,
      PR_GRUPO_B.GRUPOPADRE AS GRUPOCENTRAL
      FROM PR_GRUPO PR_GRUPO_A
      inner join PR_GRUPO PR_GRUPO_B on PR_GRUPO_A.GRUPOPADRE = PR_GRUPO_B.GRUPOCODI
      inner join SI_EMPRESA on PR_GRUPO_A.EMPRCODI = SI_EMPRESA.EMPRCODI
      WHERE PR_GRUPO_A.GRUPOCODI > 0 AND PR_GRUPO_A.CATECODI IN (2,9) AND PR_GRUPO_A.GRUPOACTIVO='{1}'
      and PR_GRUPO_B.GRUPOPADRE NOT IN (
      SELECT DAT.GRUPOCODI
      FROM PR_GRUPODAT DAT,
      ( SELECT GRUPOCODI,CONCEPCODI,MAX(FECHADAT) AS FECHAMAX FROM PR_GRUPODAT WHERE DELETED = 0 AND FECHADAT  &lt;=  TO_DATE('{0}','YYYY-MM-DD HH24:MI:SS')  GROUP BY GRUPOCODI,CONCEPCODI) V
      WHERE
      DAT.DELETED=0
      AND DAT.GRUPOCODI > 0
      AND DAT.GRUPOCODI = V.GRUPOCODI
      AND DAT.CONCEPCODI = V.CONCEPCODI
      AND DAT.FECHADAT = V.FECHAMAX
      AND DAT.CONCEPCODI=75
      AND DAT.FORMULADAT ='0'
      )
      ORDER BY GRUPOTIPO DESC, EMPRNOMB, PR_GRUPO_A.GRUPOORDEN, PR_GRUPO_A.GRUPOABREV
    </query>
  </Sql>
  
  <Sql>
    <key>ModosOperacionNoConfigurados</key>
    <query>
      select
      g.grupocodi,
      g.gruponomb,
      g.grupoabrev,
      e.emprnomb
      from pr_grupo g
      inner join si_empresa e on e.emprcodi=g.emprcodi
      where
      g.catecodi =2 and (e.emprcodi = {0} or {0}=-2) and g.grupocodi not in (select grupocodi from pr_configuracion_pot_efectiva)
      order by e.emprnomb desc
    </query>
  </Sql>
  
  <Sql>
    <key>ModosOperacionConfigurados</key>
    <query>
      select
      g.grupocodi,
      g.gruponomb,
      g.grupoabrev,
      e.emprnomb
      from pr_grupo g
      inner join si_empresa e on e.emprcodi=g.emprcodi
      inner join pr_configuracion_pot_efectiva c on c.grupocodi=g.grupocodi
      where
      g.catecodi =2 and e.emprcodi = {0} or {0}=-2
      order by e.emprnomb desc
    </query>
  </Sql>
  
  <Sql>
    <key>ReportePotenciaEfectivaTermicas</key>
    <query>
      select p.grupocodi,e.emprnomb,ppp.gruponomb central, p.gruponomb ,p.grupocomb {2}
      from pr_grupo p
      inner join si_empresa e on e.emprcodi= p.emprcodi
      inner join pr_grupo pp on pp.grupocodi=p.grupopadre
      inner join pr_grupo ppp on ppp.grupocodi=pp.grupopadre
      where p.grupocodi>0 and p.catecodi=2 and
      (eq.emprcodi = {0} or {0}=-2) 
      {1}
      order by 2,3
    </query>
  </Sql>

  <Sql>
    <key>ListarModoOperacionCategoriaTermico</key>
    <query>
      select
      grupocodi,
      gruponomb
      from
      pr_grupo
      where
      grupoactivo='S' and
      catecodi in(2,3)
      order by gruponomb
    </query>
  </Sql>
  <!--pr16.HDT - Inicio 30/10/2016: Nueva consulta para atender el requerimiento.-->
  <Sql>
    <key>UpdateOsinergmin</key>
    <query>
      update pr_grupo
      set
      fenergcodi = :fenergcodi,
      barracodi = :barracodi,
      gruponomb = :gruponomb,
      grupoabrev = :grupoabrev,
      grupovmax = :grupovmax,
      grupovmin = :grupovmin,
      grupoorden = :grupoorden,
      emprcodi = :emprcodi,
      grupotipo = :grupotipo,
      catecodi = :catecodi,
      grupotipoc = :grupotipoc,
      grupopadre = :grupopadre,
      grupoactivo = :grupoactivo,
      grupocomb = :grupocomb,
      osicodi = :osicodi,
      grupocodi2 = :grupocodi2,
      lastuser = :lastuser,
      lastdate = :lastdate,
      gruposub = :gruposub,
      barracodi2 = :barracodi2,
      barramw1 = :barramw1,
      barramw2 = :barramw2,
      gruponombncp = :gruponombncp,
      tipogrupocodi = :tipogrupocodi,
      osinergcodi = :osinergcodi
      where
      grupocodi = :grupocodi
    </query>
  </Sql>
  <!--alpha.HDT - Inicio 30/10/2016: Nueva consulta para atender el requerimiento.-->
  <Sql>
    <key>ListaGruposXCategoria</key>
    <query>
      SELECT
      gru.*,
      fue.osinergcodi AS fueosinergcodi
      FROM pr_grupo gru
      left join si_fuenteenergia fue ON (gru.fenergcodi = fue.fenergcodi)
      WHERE
      gru.catecodi IN ({0})
      ORDER BY gru.gruponomb
    </query>
  </Sql>

  <!--alpha.HDT - Inicio 31/10/2016: Nueva consulta para atender el requerimiento.-->
  <Sql>
    <key>GetByIdOsinergmin</key>
    <query>
      select
      *
      from
      pr_grupo
      where
      grupocodi = :grupocodi
    </query>
  </Sql>

 <Sql>
    <key>ListarUnidadesWithModoOperacionXCentralYEmpresa</key>
    <query>
      select eq.equipadre, pg.grupopadre idtv, eq.equicodi,eq.equiabrev,eq.equinomb, pg.*, pgp.FENERGCODI as FENERGPADRE, emp.emprnomb from pr_grupo pg
      inner join pr_grupo pgp on pgp.grupocodi = pg.grupopadre
      inner join pr_grupocc cc on cc.grupocodicc = pg.grupocodi
      inner join eq_equipo eq on eq.grupocodi = cc.grupocodidet
      inner join si_empresa emp on emp.emprcodi = pg.emprcodi
      where
      pg.grupopadre in (select distinct grupocodi from EQ_EQUIPO t where
      grupocodi > 0 and (('-2' &lt;>'{0}' and  t.equipadre = {0}) or 
	        ('-2' = '{0}' and t.equipadre in 
		          (
			            select codipadre from   (     
				              select eq.*, fm.famnomb,fm.famabrev, fm.famcodi famcodipadre, eq2.equinomb nombrecentral, eq2.equicodi codipadre
				              from eq_equipo eq          inner join eq_equipo eq2 on eq2.equicodi = eq.equipadre          inner join eq_familia fm on fm.famcodi = eq2.famcodi          where eq.famcodi in (2,3) --and eq.equiestado = 'A'
				              union
				              select eq.*, fm.famnomb, fm.famabrev,fm.famcodi famcodipadre, eq.equinomb nombrecentral, eq.equicodi codipadre
				              from eq_equipo eq          inner join eq_familia fm on fm.famcodi = eq.famcodi          where eq.famcodi in (37, 39) --and eq.equiestado = 'A'
			            )  where famcodipadre = 5    group by codipadre
		          )
	        ))
      ) 
      and ('-2'='{1}' or pg.emprcodi in ({1}))
      and pg.GRUPOESTADO not in ('X')
      
      union
      
      select eq.equipadre, 0 idtv, eq.equicodi,eq.equiabrev,eq.equinomb, pg.*, pgp.FENERGCODI as FENERGPADRE, emp.emprnomb from pr_grupo pg
      inner join pr_grupo pgp on pgp.grupocodi = pg.grupopadre
      inner join eq_equipo eq on eq.grupocodi = pg.grupopadre
      inner join si_empresa emp on emp.emprcodi = pg.emprcodi
      where
      pg.grupopadre in (select distinct grupocodi from EQ_EQUIPO t where 
          grupocodi > 0 and (('-2' &lt;>'{0}' and  t.equipadre = {0}) or 
	        ('-2' = '{0}' and t.equipadre in 
		          (
			            select codipadre from   (     
				              select eq.*, fm.famnomb,fm.famabrev, fm.famcodi famcodipadre, eq2.equinomb nombrecentral, eq2.equicodi codipadre
				              from eq_equipo eq          inner join eq_equipo eq2 on eq2.equicodi = eq.equipadre          inner join eq_familia fm on fm.famcodi = eq2.famcodi          where eq.famcodi in (2,3) --and eq.equiestado = 'A'
				              union
				              select eq.*, fm.famnomb, fm.famabrev,fm.famcodi famcodipadre, eq.equinomb nombrecentral, eq.equicodi codipadre
				              from eq_equipo eq          inner join eq_familia fm on fm.famcodi = eq.famcodi          where eq.famcodi in (37, 39) --and eq.equiestado = 'A'
			            )  where famcodipadre = 5    group by codipadre
		          )
	        ))
      )
      and ('-2'='{1}' or pg.emprcodi in ({1}))
      and pg.GRUPOESTADO not in ('X') and eq.equiestado not in ('X')
      and pg.Grupocodi  not in
      (select distinct cc.grupocodicc  from pr_grupocc cc)
    </query>
  </Sql>

  <Sql>
    <key>ListarModoOperacionSubModulo</key>
    <query>
      select
      grupocodi,
      grupoabrev,
      gruponomb
      from
      pr_grupo
      where
      grupoactivo='S' and
      (
      (gruporeservafria=1 and ({0}=1 or {0}=0)) or
      (gruponodoenergetico=1 and ({0}=2 or {0}=0))
      )
      order by
      gruponomb
    </query>
  </Sql>
  
  <!-- INICIO - COSTO OPORTUNIDAD -->
  <Sql>
    <key>GetByIdNCP</key>
    <query>
      select
      *
      from
      pr_grupo
      where
      grupocodincp = {0} and grupoactivo = 'S' and grupourspadre > 0
    </query>
  </Sql>

  <Sql>
    <key>GetByListaModosOperacionNCP</key>
    <query>
      select pto.ptomedicodi, g.*
      from pr_grupo g
      inner join me_ptomedicion pto on pto.grupocodi = g.grupocodi
      where g.GRUPOURSPADRE > 0 AND g.GRUPOACTIVO = 'S' and pto.ORIGLECTCODI = 2
    </query>
  </Sql>

  <Sql>
    <key>GetListaPotenciaEfectiva</key>
    <query>
      select datmax.gruponombncp, dat.FECHADAT, dat.formuladat from pr_grupodat dat
      inner join (
          SELECT a.grupocodi, b.gruponombncp, a.concepcodi, MAX(a.FECHADAT) AS FECHADAT 
          FROM PR_GRUPODAT a 
          inner join (
              select g.grupocodi, g.gruponombncp from pr_grupo g
              inner join me_ptomedicion pto on pto.grupocodi = g.grupocodi
              where g.GRUPOURSPADRE > 0 AND g.GRUPOACTIVO = 'S' and pto.ORIGLECTCODI = {2}
          ) b on b.grupocodi = a.grupocodi
          WHERE a.DELETED = 0 AND a.concepcodi = {1} and a.FECHADAT &lt;= TO_DATE('{0} 00:00:00','YYYY-MM-DD HH24:MI:SS') 
          GROUP BY a.grupocodi, b.gruponombncp, a.concepcodi
      ) datmax 
      ON datmax.grupocodi = dat.grupocodi and dat.FECHADAT = datmax.FECHADAT and dat.concepcodi = datmax.concepcodi 
    </query>
  </Sql>
  
  <Sql>
    <key>GetByIdGrupoPadre</key>
    <query>
      select * from pr_grupo 
      where grupourspadre = {0} and grupoactivo = 'S' 
    </query>
  </Sql>
  <!-- FIN - COSTO OPORTUNIDAD -->

  <!--INICIO PR5-->
  <Sql>
    <key>ListarAllGrupoGeneracion</key>
    <query>
      SELECT emprcodi,EMPRORDEN,emprabrev,emprnomb, grupocodi, GRUPOORDEN, TRIM(gruponomb) gruponomb, grupoabrev, grupopadre,CENTRALORDEN,central,(CASE WHEN (tipogrupocodi = 10 and flag = 'A' ) or (flag = 'N' ) THEN 10 ELSE TIPOGRUPOCODI END ) AS TIPOGRUPOCODI,
      coalesce(TIPOGENERRER,'N') TIPOGENERRER,COALESCE(GRUPOTIPOCOGEN, 'N') GRUPOTIPOCOGEN,COALESCE(GRUPOINTEGRANTE, 'N') GRUPOINTEGRANTE, tgenercodi, FENERGCODI, grupoactivo,catecodi
      FROM(
	      select a.* , ROW_NUMBER() OVER(PARTITION BY grupocodi  ORDER BY grupocodi,FECHADAT DESC) AS NUM
	      from (
		      select grupo.*,
		      nvl(pdat1.flag,'A') FLAG,nvl(pdat1.FECHADAT,SYSDATE) FECHADAT
		      from  (
			      select emp.emprcodi,emp.EMPRORDEN,emp.emprabrev,emp.emprnomb, gr.grupocodi, GR.GRUPOORDEN, gr.gruponomb, gr.grupoabrev,GRP.GRUPOORDEN CENTRALORDEN,grp.grupocodi grupopadre,
			      grp.gruponomb central, GR.TIPOGRUPOCODI,gr.TIPOGENERRER,gr.GRUPOTIPOCOGEN,gr.GRUPOINTEGRANTE, ft.tgenercodi, gr.FENERGCODI, gr.grupoactivo, gr.catecodi
			      from( SELECT GR.* FROM PR_GRUPO GR WHERE (GR.CATECODI=3 OR GR.CATECODI=5) and grupoactivo in ({1}) ORDER BY GR.GRUPOORDEN) gr
			      inner join(
				      SELECT grupocodi,EMPRCODI FROM
				      (
					      SELECT vwgr.HGRDATFECHA ,gr.GRUPOCODI, gr.gruponomb,vwgr.EMPRCODI
					      , ROW_NUMBER() OVER(PARTITION BY gr.GRUPOCODI ORDER BY gr.GRUPOCODI, vwgr.HGRDATFECHA desc, vwgr.Hgrdatestado desc) AS NUM_VIEW
					      ,vwgr.Hgrdatestado
					      from pr_grupo gr
					      inner join SI_HISEMPGRUPO_DATA vwgr on vwgr.HGRDATFECHA &lt;= TO_DATE('{0}','YYYY-MM-DD') and vwgr.GRUPOCODI = gr.GRUPOCODI
				      )rview
				      WHERE NUM_VIEW = 1
			      )vwgr on vwgr.grupocodi=gr.grupocodi
			      inner join (SELECT * FROM SI_EMPRESA WHERE (emprestado = '{2}' or '-1' = '{2}') and EMPRSEIN='S' AND EMPRESTADO&lt;>'E' AND EMPRCODI > 0 ORDER BY EMPRORDEN) emp on vwgr.emprcodi = emp.emprcodi
			      left join si_fuenteenergia ft on ft.fenergcodi = gr.fenergcodi
			      inner join pr_grupo grp on gr.grupopadre = grp.grupocodi
		      )grupo
		      left join(
			      SELECT p1.GRUPOCODI, p1.formuladat flag, p1.FECHADAT
			      FROM PR_GRUPODAT p1
			      WHERE p1.concepcodi = 258 and p1.formuladat in ('N','S')

			      UNION ALL

			      SELECT p1.GRUPOCODI,  (case when pR.tipogrupocodi &lt;> 10 then 'S' else 'N' end) as flag, to_date('1900-01-01','YYYY-MM-DD')
			      FROM PR_GRUPODAT p1
			      inner join pr_grupo pr on  p1.grupocodi = pr.grupocodi
			      WHERE p1.concepcodi = 258 and p1.formuladat in ('N','S')
		      ) pdat1 on pdat1.grupocodi = grupo.grupocodi and pdat1.FECHADAT &lt;= to_date('{0}','YYYY-MM-DD')
	      )a
      ) WHERE NUM = 1
      order by EMPRORDEN,emprnomb,GRUPOORDEN,GRUPONOMB
    </query>
  </Sql>

  <Sql>
    <key>ListarAllUnidadTermoelectrica</key>
    <query>
      select emp.emprcodi, emp.emprnomb, eqp.equicodi equipadre, trim(eqp.equinomb) central, eq.equicodi, eq.equiabrev gruponomb,  eq.grupocodi, grupo_eq.grupopadre grupopadre
      ,case when modo_esp.grupocodi is not null then 'S' else 'N' end  as modo_esp
      ,modos_cs.grupocodi GRUPOCODIMODO
      from eq_equipo eq
      inner join pr_grupo grupo_eq on grupo_eq.grupocodi = eq.grupocodi
      inner join eq_equipo eqp on eqp.equicodi = (case when eq.equipadre>0 then eq.equipadre else eq.equicodi end ) and eqp.famcodi in (5) and eq.famcodi in (3)
      inner join si_empresa emp on emp.emprcodi = eq.emprcodi and emp.EMPRESTADO &lt;> 'E'
      left join
      (
	      --Modo de Operacion de Ciclo Simple
	      select grupocodi,gruponomb, grupopadre,unidad,equipadre, central from
	      (
		      select distinct gr.grupocodi, gr.gruponomb, eqp.equicodi equipadre, eqp.equinomb central, gr.grupopadre , grp.gruponomb as unidad
		      from pr_grupo gr
		      inner join pr_grupo grp on grp.grupocodi = gr.grupopadre --and gr.FENERGCODI = grp.FENERGCODI --se comenta por el caso chilina diesel
		      inner join eq_equipo t on t.grupocodi = gr.grupopadre
		      inner join
		      (
			      --centrales termo
			      select eq2.equicodi, eq2.equinomb
			      from eq_equipo eq
			      inner join eq_equipo eq2 on eq2.equicodi = eq.equipadre
			      inner join eq_familia fm on fm.famcodi = eq2.famcodi
			      where eq.famcodi in (2,3) and eq2.famcodi = 5 and eq.equiestado in ('A','B','P')
			      group by eq2.equicodi, eq2.equinomb
		      )eqp on   eqp.equicodi = t.equipadre
		      where gr.GRUPOESTADO in ('A','B','P') and t.grupocodi > 0 and gr.grupocodi not in (select distinct grupocodicc from pr_grupocc)
	      )
	      group by grupocodi,gruponomb, grupopadre, unidad,equipadre, central having count(*) = 1

      )modos_cs  on modos_cs.grupopadre = eq.grupocodi and eqp.equicodi = modos_cs.equipadre

      left join
      (
	      --Modo de operacion de Unidades Especiales
	      select grupocodi,gruponomb from
	      (
		      --Obtener modos de operacion que no tengan CC
		      select eq.equipadre, 0 idtv, eq.equicodi,eq.equinomb, pg.*, pgp.FENERGCODI as FENERGPADRE
		      from pr_grupo pg
		      inner join pr_grupo pgp on pgp.grupocodi = pg.grupopadre
		      inner join eq_equipo eq on eq.grupocodi = pg.grupopadre
		      where pg.grupopadre in
		      (
			      --Obtener las unidad de las centrales Termoelectricas
			      select distinct eq.grupocodi
			      from EQ_EQUIPO eq
			      inner join eq_equipo eqp on eqp.equicodi = eq.equipadre
			      where eq.grupocodi > 0 and eq.famcodi = 3 and eqp.famcodi = 5
		      )
		      and pg.GRUPOESTADO in ('A','B','P') and eq.equiestado in ('A','B','P')  and eq.equipadre >0
		      and pg.Grupocodi  not in  (select distinct cc.grupocodicc  from pr_grupocc cc)
	      ) modo_cs
	      group by grupocodi,gruponomb
	      having count(*) > 0

      )modo_esp on modo_esp.grupocodi = modos_cs.grupocodi

      where eq.famcodi = 3 AND EQ.GRUPOCODI >0 and eq.equiestado in ('A','B','P')
      order by 2,4,6
    </query>
  </Sql>

  <Sql>
    <key>ListarModoOperacionXFamiliaAndEmpresa</key>
    <query>
      select pg.*, fe.FENERGNOMB
      from pr_grupo pg
      left join SI_FUENTEENERGIA fe on fe.fenergcodi = pg.fenergcodi
      where
      pg.grupopadre in (
      select distinct grupocodi
      from EQ_EQUIPO t
      inner join (
      select famcodipadre,codipadre,nombrecentral from
      (
      select eq.*, fm.famnomb,fm.famabrev, fm.famcodi famcodipadre, eq2.equinomb nombrecentral, eq2.equicodi codipadre
      from eq_equipo eq
      inner join eq_equipo eq2 on eq2.equicodi = eq.equipadre
      inner join eq_familia fm on fm.famcodi = eq2.famcodi
      where eq.emprcodi in ({1}) and eq.famcodi in (2,3) and eq.equiestado = 'A'
      union
      select eq.*, fm.famnomb, fm.famabrev,fm.famcodi famcodipadre, eq.equinomb nombrecentral, eq.equicodi codipadre
      from eq_equipo eq
      inner join eq_familia fm on fm.famcodi = eq.famcodi
      where eq.emprcodi in ({1}) and eq.famcodi in (37, 39) and eq.equiestado = 'A'
      )
      group by famcodipadre,codipadre,nombrecentral
      ) central on t.equipadre=central.codipadre
      where central.famcodipadre in ({0})  and grupocodi>0
      ) and GRUPOACTIVO ='S'

    </query>
  </Sql>

  <Sql>
    <key>ListarAllGrupoRER</key>
    <query>
      SELECT * FROM
      (
        SELECT pg.grupoactivo,emp.emprcodi, emp.emprnomb, pg.grupocodi, pg.gruponomb, fe.FENERGCODI, fe.FENERGNOMB, tg.TGENERCODI, tg.TGENERNOMB,pg.GRUPOTIPOCOGEN
        ,vwgr.HGRDATFECHA, vwgr.HGRDATESTADO, ROW_NUMBER() OVER(PARTITION BY pg.GRUPOCODI ORDER BY pg.GRUPOCODI,vwgr.HGRDATFECHA desc, vwgr.Hgrdatestado desc) AS NUM_VIEW
        from pr_grupo pg
        inner join SI_HISEMPGRUPO_DATA vwgr on vwgr.HGRDATFECHA &lt;= to_date('{0}','YYYY-MM-DD') and vwgr.GRUPOCODI = pg.GRUPOCODI
        inner join si_empresa emp on emp.emprcodi = vwgr.emprcodi
        inner join si_fuenteenergia fe on pg.FENERGCODI = fe.FENERGCODI
        inner join si_tipogeneracion tg on tg.tgenercodi = fe.tgenercodi
        where (pg.tipogenerrer = 'S') --and pg.grupoactivo = 'S'
      )where NUM_VIEW = 1 and HGRDATESTADO = 'I'
    </query>
  </Sql>

  <Sql>
    <key>ListarAllGrupoCoGeneracion</key>
    <query>
      SELECT * FROM
      (
        SELECT pg.grupoactivo,emp.emprcodi, emp.emprnomb, pg.grupocodi, pg.gruponomb, fe.FENERGCODI, fe.FENERGNOMB, tg.TGENERCODI, tg.TGENERNOMB,pg.GRUPOTIPOCOGEN
        ,vwgr.HGRDATFECHA, vwgr.HGRDATESTADO, ROW_NUMBER() OVER(PARTITION BY pg.GRUPOCODI ORDER BY pg.GRUPOCODI,vwgr.HGRDATFECHA desc, vwgr.Hgrdatestado desc) AS NUM_VIEW
        from pr_grupo pg
        inner join SI_HISEMPGRUPO_DATA vwgr on vwgr.HGRDATFECHA &lt;= to_date('{0}','YYYY-MM-DD') and vwgr.GRUPOCODI = pg.GRUPOCODI
        inner join si_empresa emp on emp.emprcodi = vwgr.emprcodi
        inner join si_fuenteenergia fe on pg.FENERGCODI = fe.FENERGCODI
        inner join si_tipogeneracion tg on tg.tgenercodi = fe.tgenercodi
        where (pg.GRUPOTIPOCOGEN = 'S') --and pg.grupoactivo = 'S'
      )where NUM_VIEW = 1 and HGRDATESTADO = 'I'
    </query>
  </Sql>
  <!--FIN PR5-->

  <Sql>
    <key>ListaByGrupopadre</key>
    <query>
      select c.equicodi, b.equinomb, a.* from pr_grupo a
      inner join EQ_EQUIPO b on b.grupocodi = a.grupopadre and b.equiestado = 'A' and b.equicodi in ({0})
      inner join eq_equipo c on c.grupocodi = a.grupocodi
      and a.grupoactivo = 'S'
    </query>
  </Sql>
  
  <!--Pruebas aleatorias-->
  <Sql>
    <key>ListaModoOperacionDeEquipo</key>
    <query>
      select
      trim(a.gruponomb)||' ('||trim(b.emprabrev)||'). ACTIVO: '||a.grupoactivo gruponomb,
      a.grupocodi
      from
      pr_grupo A, si_empresa B
      where
      a.emprcodi=b.emprcodi and grupopadre in
      (select grupocodi from eq_equipo where equicodi in ({0}) and grupocodi>0) and catecodi={1}
      order by
      a.grupoactivo desc, a.gruponomb
    </query>
  </Sql>
  
  <!--Fin Pruebas aleatorias-->
  <Sql>
    <key>ListaPrGrupoCC</key>
    <query>
      select * from pr_grupocc
    </query>
  </Sql>
  
  <Sql>
		<key>ListaUnidadesXModoOperacionIndisponibilidad</key>
		<query>
			select eq.equipadre,pg.grupopadre idtv, eq.equicodi,eq.equinomb, pg.*, pgp.FENERGCODI as FENERGPADRE from pr_grupo pg
			inner join pr_grupo pgp on pgp.grupocodi = pg.grupopadre
			inner join pr_grupocc cc on cc.grupocodicc = pg.grupocodi
			inner join eq_equipo eq on eq.grupocodi = cc.grupocodidet
			where
			pg.grupopadre in (select distinct grupocodi from EQ_EQUIPO t where (t.equipadre = {0} or '0' = '{0}') and grupocodi>0) and
			pg.GRUPOACTIVO ='S'
		</query>
  </Sql>

  <Sql>
    <key>ListGrupoPorCategoriaPaginado</key>
    <query>
      select * from (
      SELECT
      gru.*,
      (row_number() over (order by gru.gruponomb)) as r
      FROM pr_grupo gru
      WHERE
      gru.catecodi = {0} and
      (trim(gru.grupoestado) = '{1}' or '{1}' = '-1'))
      where
      (r >= ((({2}-1) * {3}) + 1) and r &lt; (({2} * {3}) + 1 )) or ({2} = -1 and {3} = -1)
      ORDER BY gruponomb asc
    </query>
  </Sql>

  <Sql>
    <key>ListaCompensacionGrupo</key>
    <query>
      SELECT GRUPOCODI,GRUPONOMB 
      FROM PR_GRUPO WHERE GRUPOCODI IN (SELECT GRUPOCODI FROM VCE_COMP_REGULAR_DET WHERE PECACODI = {0} AND CRDETCOMPENSACION IS NOT NULL) 
      ORDER BY GRUPONOMB
    </query>
  </Sql>
  

  <!--Region Transferencia de Equipos-->
  <Sql>
    <key>ListadoPrGrupoByEmpresa</key>
    <query>
      select *
      from pr_grupo
      where emprcodi= {0}
      --and trim(grupoestado)='A'
    </query>
  </Sql>
 <!--FIN Region Transferencia de Equipos-->

<!--INICIO CURVA COMBUSTIBLE-->

  <Sql>
    <key>ListarDetalleGrupoCurva</key>
    <query>
      select
      g.GRUPOCODI,
      g.GRUPONOMB,
      g.CURVCODI,
      c.CURVGRUPOCODIPRINCIPAL
      from
      pr_grupo g join PR_CURVA c  on g.CURVCODI = c.CURVCODI
      where
      c.CURVCODI = {0}
    </query>
  </Sql>

  <Sql>
    <key>ObtenerGruposPorCodigo</key>
    <query>
      select
      GRUPOCODI,
      GRUPONOMB
      from
      pr_grupo
      where
      GRUPOPADRE = {0} AND GRUPOACTIVO = 'S'
    </query>
  </Sql>

  <Sql>
    <key>ObtenerCentralesPorGrupoCurva</key>
    <query>
      select
      grupocodi,
      gruponomb
      from
      pr_grupo
      where
      catecodi in (4, 6) and grupotipo = '{0}'
      and grupoactivo = 'S'
      order by gruponomb asc
    </query>
  </Sql>

  <Sql>
    <key>UpdateNCP</key>
    <query>
      update pr_grupo
      set
      GRUPOCODINCP = :GRUPOCODINCP
      where
      grupocodi = :grupocodi
    </query>
  </Sql>

  <Sql>
    <key>ObtenerNCP</key>
    <query>
      select
      GRUPOCODINCP
      from
      pr_grupo
      where
      grupocodi = '{0}'
    </query>
  </Sql>
  
  <!--CURVA COMBUSTIBLE-->

  <!--INICIO MigracionSGOCOES-GrupoB-->
  
  <Sql>
    <key>ListaPrGruposPaginado</key>
    <query>
      select * from (
          select gru.*,
          emp.emprnomb,
          cat.CATENOMB,
          tipoarea.tareaabrev || ' ' || ar.areanomb as areadesc,
          (row_number() over (order by emp.emprnomb,gru.gruponomb)) as r
          FROM pr_grupo gru
          INNER JOIN si_empresa emp on emp.emprcodi=gru.emprcodi
          INNER JOIN pr_categoria cat on cat.catecodi=gru.catecodi
          left JOIN eq_area ar on ar.areacodi = gru.areacodi
          left join eq_tipoarea tipoarea on ar.tareacodi = tipoarea.tareacodi
          WHERE
          gru.grupocodi > 0 and
          (emp.emprcodi= {0} or -2= {0})and
          (cat.catecodi in ({1}) or '-2'='{1}') and
          (lower(nvl(gru.gruponomb,' ')) like lower('%{2}%') ) AND
          (trim(gru.GRUPOACTIVO) = '{3}' or '-1' = '{3}')
          and ( ( '{6}' = '-1' and '{7}' = '-1') or gru.GRUPORESERVAFRIA = '{6}' or gru.GRUPONODOENERGETICO = '{7}') 
          ORDER BY emp.emprnomb, gru.gruponomb
      )
      where
      (r >= ((({4}-1) * {5}) + 1) and r &lt; (({4} * {5}) + 1 )) or ({4} = -1 and {5} = -1)
    </query>
  </Sql>

  <Sql>
    <key>TotalPrGrupos</key>
    <query>
      SELECT
      count(*)
      FROM pr_grupo gru
      INNER JOIN si_empresa emp on emp.emprcodi=gru.emprcodi
      INNER JOIN pr_categoria cat on cat.catecodi=gru.catecodi
      INNER JOIN eq_area a on a.areacodi=gru.areacodi
      WHERE
      gru.grupocodi > 0 and
      (emp.emprcodi= {0} or -2= {0})and
      (cat.catecodi in ({1}) or '-2'='{1}') and
      (lower(nvl(gru.gruponomb,' ')) like lower('%{2}%') ) and
      (trim(gru.GRUPOACTIVO) = '{3}' or '-1' = '{3}')
      and ( ( '{4}' = '-1' and '{5}' = '-1') or gru.GRUPORESERVAFRIA = '{4}' or gru.GRUPONODOENERGETICO = '{5}')
    </query>
  </Sql>
  
  <!--FIN MigracionSGOCOES-GrupoB-->
    
    <Sql>
    <key>GetListModosOperacion</key>
    <query>

      select mo.grupocodi,mo.gruponomb, mo.grupoactivo
      ,(select round(sum(hophorfin-hophorini)*24,2) from eve_horaoperacion ho where ho.grupocodi =mo.grupocodi and  hophorini >= to_date('{0}','YYYYMM') and hophorini &lt; add_months(to_date('{0}','YYYYMM'),1) ) HorasOperacion
      ,case when (Select count(*) from vce_datcalculo ca where ca.pecacodi= {2} and ca.grupocodi = mo.grupocodi) = 0 then 'Nuevo' else '' end as calificacion
      ,case when (Select count(*) from vce_grupo_excluido ex where ex.pecacodi= {1} and ex.grupocodi = mo.grupocodi) > 0 then 'Incluir' else 'Excluir' end as accioncalculo
      from pr_grupo mo 
      where mo.catecodi=2
      and (mo.grupoactivo='S'
      or mo.grupocodi in (select grupocodi from eve_horaoperacion where hophorini >= to_date('{0}','YYYYMM') and hophorini &lt; add_months(to_date('{0}','YYYYMM'),1) ))
      order by mo.gruponomb
    </query>
  </Sql>
  
  <Sql>
    <key>GetListModosIds</key>
    <query>
      select mo.grupocodi
      from pr_grupo mo
      where mo.catecodi=2
      and (mo.grupoactivo='S'
      or mo.grupocodi in (select grupocodi from eve_horaoperacion where hophorini >= to_date('{0}','DD/MM/YYYY') and hophorini &lt; last_day(to_date('{0}','DD/MM/YYYY')) ))
    </query>
  </Sql>

  <Sql>
    <key>GetMOXensayo</key>
    <query>
      select * from pr_grupo where grupocodi in (select grupocodi from en_ensayomodo where ensayocodi = {0})
    </query>
  </Sql>

  <!--INICIO Titularidad-Instalaciones-Empresas-->
  <Sql>
    <key>ListarGrupoByMigracodi</key>
    <query>
      select gr.grupocodi
      ,gr.grupoABREV
      ,gr.grupoNOMB
      ,emp.EMPRCODI
      ,emp.EMPRNOMB
      ,emp2.EMPRNOMB AS EMPRNOMB_ORIGEN
      ,a.AREACODI
      ,a.AREANOMB
      ,gr.GRUPOESTADO
      ,cate.CATENOMB
      , gr.GRUPOESTADO
      from pr_grupo gr
      inner join si_empresa emp on emp.emprcodi=gr.emprcodi
      inner join pr_categoria cate on cate.catecodi=gr.catecodi
      inner join eq_area a on a.areacodi=gr.areacodi
      inner join si_tipoempresa te on te.tipoemprcodi=emp.tipoemprcodi
      inner join SI_HISEMPGRUPO grm on grm.grupocodi=gr.grupocodi
      INNER JOIN SI_MIGRACION mig on mig.migracodi =grm.migracodi
      INNER JOIN si_migraemprorigen eo on eo.migracodi= grm.migracodi
      inner join si_empresa emp2 on emp2.emprcodi=eo.emprcodi
      where
      ( mig.MIGRACODI = {0}) and
      lower(gr.GRUPONOMB) like '%%'
      order by cate.catenomb,gr.GRUPONOMB
    </query>
  </Sql>

  <!--FIN Titularidad-Instalaciones-Empresas-->
  
  <!--INICIO numerales datos base -->
  <Sql>
    <key>ListaDatosBase_5_6_3</key>
    <query>
      select G.Gruponomb,GRUPOCODI,GRUPOPADRE, TRIM(GRUPOCOMB) AS COMB ,LASTDATE from pr_grupo G
      where grupocomb is not null order by grupopadre
    </query>
  </Sql>
  <!--FIN numerales datos base -->

  <!--SIOSEIN-->

  <Sql>
    <key>ListByIds</key>
    <query>
      select pr2.grupopadre grupocentral,fe.fenergnomb,
      emp.emprnomb,
      pr.*
      from pr_grupo pr
      left join si_fuenteenergia fe on fe.fenergcodi=pr.fenergcodi
      left join  pr_grupo pr2 on pr2.grupocodi=pr.grupopadre
      left join si_empresa emp on pr.emprcodi = emp.emprcodi
      where pr.grupocodi in ({0})
    </query>
  </Sql>

  <!--END SIOSEIN-->

  <!--INICIO Pron칩stico de la demanda-->
  <Sql>
    <key>ListaBarrasxCategoria</key>
    <query>
      select
      grupocodi,
      gruponomb,
      catecodi
      from pr_grupo
      where catecodi = :catecodi
    </query>
  </Sql>

  <Sql>
    <key>ListaBarrasCPDisponible</key>
    <query>
      select
      grupocodi,
      gruponomb,
      catecodi
      from pr_grupo
      where catecodi = :catecodi and grupocodi not in (      select prnredbarracp from prn_reduccionred where prnvercodi = :prnvercodi
      union
      select prnredbarrapm from prn_reduccionred where prnvercodi = :prnvercodi)
    </query>
  </Sql>
  <!--FIN Pron칩stico de la demanda-->
  
  <!--INICIO C치lculo de Consumo de Combustible-->

  <Sql>
    <key>UpdateOsinergcodi</key>
    <query>
      update pr_grupo
      set
      osinergcodi = :osinergcodi
      where
      grupocodi = :grupocodi
    </query>
  </Sql>

  <!--FIN C치lculo de Consumo de Combustible-->

  <Sql>
    <key>UpdateSddp</key>
    <query>
      update pr_grupo
      set
      GRUPOCODISDDP = :grupocodisddp
      where
      grupocodi = :grupocodi
    </query>
  </Sql>

	<Sql>
		<key>ListarGrupoPadre</key>
		<query>
			select pr.*,
			gp.gruponomb as GRUPONOMBPADRE
			from pr_grupo pr
			left join pr_grupo gp on gp.grupocodi = pr.grupopadre
			inner join si_empresa emp on pr.emprcodi = emp.emprcodi
			where (pr.grupoactivo = 'S' or 'S'=' ') and (emp.emprcodi != 1)
		</query>
	</Sql>

	<Sql>
		<key>ListGrupoDespacho</key>
		<query>
			select * from
			(
			select total.*,(row_number() over (order by total.grupocodi asc)) as r from (
			select pr.* , emp.emprnomb,
			case pr.grupopadre
			when -1 then null
			when 0 then null
			else pr.grupopadre
			end as GRUPOCODIPADRE,
			case pr.grupopadre
			when -1 then null
			when 0 then null
			else gp.gruponomb
			end as GRUPONOMBPADRE, cat.catenomb
			from pr_grupo pr
			left join pr_grupo gp on gp.grupocodi = pr.grupopadre
			inner join si_empresa emp on pr.emprcodi = emp.emprcodi
			inner join pr_categoria cat on cat.catecodi = pr.catecodi
			where (pr.grupoactivo = 'S' or 'S'=' ') and (emp.emprcodi in {0} or {0} = -1) and (emp.emprcodi != 1)
			and pr.catecodi in (3,4,5,6,15,16,17,18)
			)total
			)
			where (r >= ((({1}-1) * {2}) + 1) and r&lt; (({1} *{2}) + 1 )) or ({1} = -1 and {2} = -1)
		</query>
	</Sql>
	<Sql>
		<key>ListGrupoDespachoXFiltro</key>
		<query>
			SELECT COUNT(*)
			from pr_grupo pr
			left join pr_grupo gp on gp.grupocodi = pr.grupopadre
			inner join si_empresa emp on pr.emprcodi = emp.emprcodi
			inner join pr_categoria cat on cat.catecodi = pr.catecodi
			where (pr.grupoactivo = 'S' or 'S'=' ') and (emp.emprcodi in {0} or {0} = -1) and (emp.emprcodi != 1)
			and pr.catecodi in (3,4,5,6,15,16,17,18)
		</query>
	</Sql>
  <!--INICIO Mejoras Yupana -->
  <Sql>
    <key>ListaEquiposXModoOperacion</key>
    <query>
      select eq.famcodi, eq.equicodi, pg.* from pr_grupo pg
      inner join pr_grupocc cc on cc.grupocodicc = pg.grupocodi
      inner join eq_equipo eq on eq.grupocodi = cc.grupocodidet
      where pg.grupocodi in( {0}) and eq.equiestado = 'A'
      union
      select eq.famcodi,eq.equicodi, pg.* from pr_grupo pg
      inner join eq_equipo eq on eq.grupocodi = pg.grupopadre
      where pg.grupocodi in({0}) and pg.grupocodi not in (
      select cc.grupocodicc  from pr_grupocc cc where cc.grupocodicc = pg.grupocodi
      ) and eq.equiestado = 'A'
      union
      select eq.famcodi,eq.equicodi, pg.* from pr_grupo pg
      inner join pr_grupo pg2 on pg2.grupocodi = pg.grupopadre
      inner join eq_equipo eq on eq.grupocodi = pg2.grupopadre
      where pg.grupocodi in (
      select cc.grupocodicc  from pr_grupocc cc where cc.grupocodicc = pg.grupocodi
      ) and pg.grupocodi in ({0}) and eq.equiestado = 'A'
      union
      select eq.famcodi,eq.equicodi, pg.* from pr_grupo pg
      inner join pr_grupo pgp on pgp.grupocodi = pg.grupopadre
      inner join eq_equipo eq on eq.grupocodi = pgp.grupopadre
      where pg.grupocodi in ({0}) and pg.grupocodi not in (
      select cc.grupocodicc  from pr_grupocc cc where cc.grupocodicc = pg.grupocodi
      ) and eq.equiestado = 'A'
    </query>
  </Sql>
  <!--FIN Mejoras Yupana-->

	<Sql>
		<key>GruposModificados</key>
		<query>
			select
			p.grupocodi,
			p.gruponomb,
			p.grupoabrev,
			pa.gruponomb as grupopadre,
			e.emprnomb,
			c.catenomb,
			f.fenergnomb,
			tg.tipogruponomb,
			p.tipogenerrer,
			p.osinergcodi,
			p.grupointegrante,
			p.grupotipocogen,
			p.gruponodoenergetico,
			p.gruporeservafria,
			p.grupoactivo,
			p.grupoestado,
			p.lastuser,
			p.lastdate
			from pr_grupo p
			inner join si_empresa e on e.emprcodi = p.emprcodi
			inner join pr_categoria c on c.catecodi = p.catecodi
			inner join pr_grupo pa on pa.grupocodi = p.grupopadre
			inner join si_fuenteenergia f on f.fenergcodi = p.fenergcodi
			inner join pr_tipogrupo tg on tg.tipogrupocodi = p.tipogrupocodi
			where p.catecodi in (2,3,4,5,6,15,16,17,18,9,14)
			and p.lastdate >=  to_date('{0}', 'DD-MM-YYYY HH24:MI') and
			p.lastdate &lt;=  to_date('{1}', 'DD-MM-YYYY HH24:MI')
		</query>
	</Sql>

  <Sql>
    <key>GetDatosGrupo</key>
    <query>
      select
      g.*,
      emp.emprnomb,
      cat.catenomb,
      tipoarea.tareaabrev || ' ' || ar.areanomb as areadesc
      from pr_grupo g
      inner join si_empresa emp on emp.emprcodi= g.emprcodi
      inner join pr_categoria cat on cat.catecodi= g.catecodi
      left join eq_area ar on ar.areacodi = g.areacodi
      left join eq_tipoarea tipoarea on ar.tareacodi = tipoarea.tareacodi
      where g.grupocodi = {0}
    </query>
  </Sql>

  <Sql>
    <key>ListarPorEmpresaPropietaria</key>
    <query>
      select
      g.grupocodi,
      g.catecodi,
      g.grupocodi as idElemento,
      emp1.emprcodi as idempresaelemento,
      emp1.emprnomb as nombempresaelemento,
      null as idempresacopelemento,
      null as nombempresacopelemento,
      g.gruponomb  as nombreelemento,
      c.catenomb as tipoelemento,
      ar.areanomb as areaelemento,
      g.grupoestado as estadoelemento,
      ar.areacodi
      from pr_grupo g
      inner join si_empresa emp1 on emp1.emprcodi = g.emprcodi
      inner join pr_categoria c on c.catecodi = g.catecodi
      inner join eq_area ar on ar.areacodi = g.areacodi
      where
      (g.grupoestado = 'A' or g.grupoestado = 'F')
      and g.emprcodi = {0} and
      (g.catecodi = {1} or '-1' = '{1}')
    </query>
  </Sql>
  
  <!--FIN Mejoras Yupana-->

	<!--Inicio DemandaDPO-->
	<Sql>
		<key>ListaBarrasByCodigos</key>
		<query>
			select
			grupocodi,
			gruponomb,
			grupoabrev
			from pr_grupo
			where grupocodi in ({0})
		</query>
	</Sql>
	<!--Fin DemandaDPO-->>
</Sqls>
