<?xml version="1.0" encoding="utf-8" ?>
<Sqls>

  <Sql>
    <key>GetMaxId</key>
    <query>
       select nvl(max(rcproucodi), 0) + 1 from rca_cuadro_prog_usuario
    </query>
  </Sql>

  <Sql>
    <key>Save</key>
    <query>
      insert into rca_cuadro_prog_usuario(
      rcproucodi,
      rccuadcodi,
      emprcodi,
      equicodi,
      rcproudemanda,
      rcproudemandareal,
      rcproufuente,
      rcproudemandaracionar,
      rcprouestregistro,
      rcproucargadisponible,
      rcproufactork,
      rcproudemandaatender,
      rcprouemprcodisuministrador,
      rcprouusucreacion,
      rcproufeccreacion,
      rcproucargarechazarcoord,
      rccuadhorinicoord,
      rccuadhorfincoord,
      rcproucargarechazarejec,
      rccuadhoriniejec,
      rccuadhorfinejec
      )
      values(
      :rcproucodi,
      :rccuadcodi,
      :emprcodi,
      :equicodi,
      :rcproudemanda,
      :rcproudemandareal,
      :rcproufuente,
      :rcproudemandaracionar,
      :rcprouestregistro,
      :rcproucargadisponible,
      :rcproufactork,
      :rcproudemandaatender,
      {0},
      :rcprouusucreacion,
      :rcproufeccreacion,
      :rcproucargarechazarcoord,
      :rccuadhorinicoord,
      :rccuadhorfincoord,
      :rcproucargarechazarejec,
      :rccuadhoriniejec,
      :rccuadhorfinejec
      )
    </query>
  </Sql>

  <Sql>
    <key>Update</key>
    <query>
      update rca_cuadro_prog_usuario
      set
      rcprouusumodificacion = :rcprouusumodificacion,
      rcproufecmodificacion = :rcproufecmodificacion,
      rccuadcodi = :rccuadcodi,
      emprcodi = :emprcodi,
      equicodi = :equicodi,
      rcproudemanda = :rcproudemanda,
      rcproudemandareal = :rcproudemandareal,
      rcproufuente = :rcproufuente,
      rcproudemandaracionar = :rcproudemandaracionar,
      rcprouestregistro = :rcprouestregistro,
      rcproucargadisponible =:rcproucargadisponible,
      rcproufactork =:rcproufactork,
      rcproudemandaatender =:rcproudemandaatender,
      rcprouemprcodisuministrador = {0},
      rcproucargarechazarcoord = :rcproucargarechazarcoord,
      rccuadhorinicoord = :rccuadhorinicoord,
      rccuadhorfincoord = :rccuadhorfincoord,
      rcproucargarechazarejec = :rcproucargarechazarejec,
      rccuadhoriniejec = :rccuadhoriniejec,
      rccuadhorfinejec = :rccuadhorfinejec
      where
      rcproucodi = :rcproucodi
    </query>
  </Sql>

  <Sql>
    <key>Delete</key>
    <query>
       delete from rca_cuadro_prog_usuario
       where
           rcproucodi = :rcproucodi
    </query>
  </Sql>

  <Sql>
    <key>GetById</key>
    <query>
       select
           rcprouusumodificacion,
           rcproufecmodificacion,
           rcproucodi,
           rccuadcodi,
           emprcodi,
           equicodi,
           rcproudemanda,
           rcproufuente,
           rcproudemandaracionar,
           rcprouestregistro,
           rcprouusucreacion,
           rcproufeccreacion,
           rcproucargarechazarcoord,
           rccuadhorinicoord,
           rccuadhorfincoord,
           rcproucargarechazarejec,
           rccuadhoriniejec,
           rccuadhorfinejec
       from
           rca_cuadro_prog_usuario
       where
           rcproucodi = :rcproucodi
    </query>
  </Sql>

  <Sql>
    <key>List</key>
    <query>
       select
           rcprouusumodificacion,
           rcproufecmodificacion,
           rcproucodi,
           rccuadcodi,
           emprcodi,
           equicodi,
           rcproudemanda,
           rcproufuente,
           rcproudemandaracionar,
           rcprouestregistro,
           rcprouusucreacion,
           rcproufeccreacion,
           rcproucargarechazarcoord,
           rccuadhorinicoord,
           rccuadhorfincoord,
           rcproucargarechazarejec,
           rccuadhoriniejec,
           rccuadhorfinejec
       from
           rca_cuadro_prog_usuario
    </query>
  </Sql>

  <Sql>
    <key>GetByCriteria</key>
    <query>
       select
           rcprouusumodificacion,
           rcproufecmodificacion,
           rcproucodi,
           rccuadcodi,
           emprcodi,
           equicodi,
           rcproudemanda,
           rcproufuente,
           rcproudemandaracionar,
           rcprouestregistro,
           rcprouusucreacion,
           rcproufeccreacion,
           rcproucargarechazarcoord,
           rccuadhorinicoord,
           rccuadhorfincoord,
           rcproucargarechazarejec,
           rccuadhoriniejec,
           rccuadhorfinejec
       from
           rca_cuadro_prog_usuario
    </query>
  </Sql>

  <Sql>
    <key>ListProgramaRechazoCarga</key>
    <query>
      SELECT 1 AS ORDEN, PU.EMPRCODI,PU.EQUICODI, NVL(EM.EMPRRAZSOCIAL, EM.EMPRNOMB) AS EMPRESA, SUMI.EMPRNOMB SUMINISTRADOR, AR.AREANOMB AS SUBESTACION, EQ.EQUINOMB AS PUNTOMEDICION
      ,PU.RCPROUDEMANDA ,PU.RCPROUFUENTE, PU.RCPROUCARGADISPONIBLE, PU.RCPROUFACTORK, PU.RCPROUDEMANDARACIONAR, RCPROUDEMANDAATENDER, PU.RCPROUDEMANDAREAL
      ,PU.RCPROUCODI, SUMI.EMPRCODI AS RCPROUEMPRCODISUMINISTRADOR, EQ.OSINERGCODI
      ,RCPROUCARGARECHAZARCOORD, RCCUADHORINICOORD, RCCUADHORFINCOORD, RCPROUCARGARECHAZAREJEC, RCCUADHORINIEJEC, RCCUADHORFINEJEC
      FROM RCA_CUADRO_PROG_USUARIO PU LEFT JOIN EQ_EQUIPO EQ ON PU.EQUICODI =  EQ.EQUICODI LEFT JOIN SI_EMPRESA EM ON EQ.EMPRCODI = EM.EMPRCODI
      LEFT JOIN EQ_AREA AR ON EQ.AREACODI = AR.AREACODI
      LEFT JOIN SI_EMPRESA SUMI ON PU.RCPROUEMPRCODISUMINISTRADOR = SUMI.EMPRCODI
      WHERE PU.RCPROUESTREGISTRO = '1' {0}
      ORDER BY 1,4,5,6,7
    </query>
  </Sql>
  
  <Sql>
    <key>ListEmpresasProgramaRechazoCarga</key>
    <query>
      SELECT EMP.EMPRCODI,EQ.EQUICODI,NVL(EMP.EMPRRAZSOCIAL, EMP.EMPRNOMB) AS EMPRESA,NVL(EMPSUM.EMPRRAZSOCIAL,EMPSUM.EMPRNOMB) AS SUMINISTRADOR,
      EMPSUM.EMPRCODI AS RCPROUEMPRCODISUMINISTRADOR
      ,AR.AREANOMB AS SUBESTACION,EQ.EQUINOMB AS PUNTOMEDICION,DE.{0} AS DEMANDA
      ,DE.RCDEUTFUENTE AS RCDEULFUENTE

      FROM RCA_DEMANDA_USUARIO_TMP DE JOIN EQ_EQUIPO EQ ON DE.EQUICODI = EQ.EQUICODI
      JOIN SI_EMPRESA EMP ON EQ.EMPRCODI = EMP.EMPRCODI
      JOIN SI_EMPRESA EMPSUM ON DE.EMPRCODISUMIN = EMPSUM.EMPRCODI
      LEFT JOIN EQ_AREA AR ON EQ.AREACODI = AR.AREACODI
      WHERE 1=1 
      {1}

      ORDER BY 3,4,5,6
    </query>
  </Sql>

  <Sql>
    <key>ListSubEstacion</key>
    <query>
      SELECT A.AREACODI, TRIM(NVL(A.AREANOMB,'SIN SUBESTACION'))||' ['||AREAABREV||']' AS AREANOMB
      FROM EQ_AREA A
      WHERE A.TAREACODI = 1 AND A.AREAESTADO = 'A'
      {0}
      ORDER BY AREANOMB
    </query>
  </Sql>

  <Sql>
    <key>ListEnvioArchivoMagnitud</key>
    <query>
      SELECT CP.RCPROUEMPRCODISUMINISTRADOR, ES.EMPRRAZSOCIAL  AS SUMINISTRADOR, CL.EMPRRAZSOCIAL AS EMPRESA,AR.AREANOMB AS SUBESTACION, EQ.EQUINOMB AS PUNTOMEDICION,
      CP.RCPROUDEMANDAREAL AS RCPROUDEMANDA, CP.RCPROUDEMANDARACIONAR, EJEP.RCEJEUCARGARECHAZADA AS RCEJEUCARGARECHAZADAPRELIMINAR ,EJEP.RCEJEUFECHORINICIO AS RCEJEUFECHORINICIOPRELIMINAR
      ,EJEP.RCEJEUFECHORFIN AS RCEJEUFECHORFINPRELIMINAR,EJED.RCEJEUCARGARECHAZADA,EJED.RCEJEUFECHORINICIO,EJED.RCEJEUFECHORFIN

      ,CASE WHEN EJEP.RCEJEUCARGARECHAZADA IS NOT NULL OR EJED.RCEJEUCARGARECHAZADA IS NOT NULL THEN 'S' ELSE 'N' END AS CUMPLIO

      FROM RCA_CUADRO_PROG_USUARIO CP JOIN SI_EMPRESA ES ON CP.RCPROUEMPRCODISUMINISTRADOR = ES.EMPRCODI

      JOIN EQ_EQUIPO EQ ON CP.EQUICODI = EQ.EQUICODI

      LEFT JOIN SI_EMPRESA CL ON CP.EMPRCODI = CL.EMPRCODI

      LEFT JOIN EQ_AREA AR ON EQ.AREACODI = AR.AREACODI

      LEFT JOIN (SELECT * FROM RCA_CUADRO_EJEC_USUARIO WHERE RCEJEUTIPOREPORTE = 'P' ) EJEP ON CP.RCPROUCODI = EJEP.RCPROUCODI

      LEFT JOIN (SELECT * FROM RCA_CUADRO_EJEC_USUARIO WHERE RCEJEUTIPOREPORTE = 'D' ) EJED ON CP.RCPROUCODI = EJED.RCPROUCODI

      WHERE {0} AND RCPROUESTREGISTRO = '1'
    </query>
  </Sql>


  <Sql>
    <key>ListSuministrador</key>
    <query>
      SELECT EMPRCODI,NVL(EMPRRAZSOCIAL,EMPRNOMB) AS SUMINISTRADOR FROM SI_EMPRESA
      WHERE EMPRCODI IN (SELECT RCPROUEMPRCODISUMINISTRADOR FROM RCA_CUADRO_PROG_USUARIO WHERE RCCUADCODI = :RCCUADCODI AND RCPROUEMPRCODISUMINISTRADOR IS NOT NULL) ORDER BY 2
    </query>
  </Sql>

  <Sql>
    <key>SqlUpdateEstado</key>
    <query>
      UPDATE RCA_CUADRO_PROG_USUARIO set RCPROUESTREGISTRO = {1} WHERE RCCUADCODI = {0}
    </query>
  </Sql>
  
  <Sql>
    <key>ListZonas</key>
    <query>
      SELECT AREACODI,AREANOMB FROM EQ_AREA WHERE AREAESTADO = 'A' AND  ANIVELCODI = :ANIVELCODI
    </query>
  </Sql>

  <Sql>
    <key>EliminarDemandaUsuarioLibre</key>
    <query>
      DELETE FROM RCA_DEMANDA_USUARIO_TMP      
    </query>
  </Sql>
  
  <Sql>
    <key>CargarDemandaUsuarioLibre</key>
    <query>
      INSERT INTO RCA_DEMANDA_USUARIO_TMP(EQUICODI,RCDEUTDEMANDAHP,RCDEUTDEMANDAHFP,RCDEUTFUENTE,OSINERGCODI, PTOMEDICODI, EMPRCODISUMIN)
      SELECT DE.EQUICODI,DE.RCDEULDEMANDAHP,DE.RCDEULDEMANDAHFP,'PR16',EQ.OSINERGCODI, DE.PTOMEDICODI, DE.EMPRCODI
      FROM VW_DEMANDA_USUARIO DE JOIN EQ_EQUIPO EQ ON DE.EQUICODI = EQ.EQUICODI
      WHERE DE.RCDEULPERIODO = (SELECT MAX(RCDEULPERIODO) FROM VW_DEMANDA_USUARIO)
    </query>
  </Sql>

  <Sql>
    <key>CargarDemandaUsuarioLibreSicli</key>
    <query>
      INSERT INTO RCA_DEMANDA_USUARIO_TMP(EQUICODI,RCDEUTDEMANDAHP,RCDEUTDEMANDAHFP,RCDEUTFUENTE,OSINERGCODI)
      SELECT PTO.EQUICODI,{0},'SICLI-'||'{1}',EQ.OSINERGCODI      
      FROM ME_MEDICION96 ME JOIN ME_PTOMEDICION PTO ON ME.PTOMEDICODI = PTO.PTOMEDICODI JOIN EQ_EQUIPO EQ ON PTO.EQUICODI = EQ.EQUICODI
      WHERE ME.LECTCODI = :LECTCODI AND ME.TIPOINFOCODI = :TIPOINFOCODI {2}

    </query>
  </Sql>
  
  <Sql>
    <key>ActualizarDemandaUsuarioLibre</key>
    <query>
      UPDATE RCA_DEMANDA_USUARIO_TMP SET (RCDEUTDEMANDAHP,RCDEUTDEMANDAHFP,RCDEUTFUENTE) = (
      SELECT ME.H23 AS HFP , ME.H38 AS HP, 'PR03' FROM ME_MEDICION48 ME JOIN (
      SELECT PTOMEDICODI,LECTCODI,TIPOINFOCODI,MAX(MEDIFECHA) AS MEDIFECHA FROM ME_MEDICION48
      WHERE MEDIFECHA IN (TO_DATE('{0}','DD/MM/YYYY')-7,TO_DATE('{0}','DD/MM/YYYY')-14,TO_DATE('{0}','DD/MM/YYYY')-21)
      AND LECTCODI = 46 AND TIPOINFOCODI = 20 group by PTOMEDICODI, LECTCODI, TIPOINFOCODI) RES ON ME.PTOMEDICODI = RES.PTOMEDICODI
      AND ME.MEDIFECHA = RES.MEDIFECHA AND ME.LECTCODI = RES.LECTCODI AND ME.TIPOINFOCODI = RES.TIPOINFOCODI
      JOIN ME_PTOMEDICION PTO ON ME.PTOMEDICODI = PTO.PTOMEDICODI
      JOIN EQ_EQUIPO EQ ON PTO.EQUICODI = EQ.EQUICODI
      WHERE EQ.OSINERGCODI = RCA_DEMANDA_USUARIO_TMP.OSINERGCODI
      )
      WHERE OSINERGCODI IN (
      SELECT EQ.OSINERGCODI FROM ME_MEDICION48 ME JOIN (
      SELECT PTOMEDICODI,LECTCODI,TIPOINFOCODI,MAX(MEDIFECHA) AS MEDIFECHA FROM ME_MEDICION48
      WHERE MEDIFECHA IN (TO_DATE('{0}','DD/MM/YYYY')-7,TO_DATE('{0}','DD/MM/YYYY')-14,TO_DATE('{0}','DD/MM/YYYY')-21)
      AND LECTCODI = 46 AND TIPOINFOCODI = 20 GROUP BY PTOMEDICODI, LECTCODI, TIPOINFOCODI) RES ON ME.PTOMEDICODI = RES.PTOMEDICODI
      AND ME.MEDIFECHA = RES.MEDIFECHA AND ME.LECTCODI = RES.LECTCODI AND ME.TIPOINFOCODI = RES.TIPOINFOCODI
      JOIN ME_PTOMEDICION PTO ON ME.PTOMEDICODI = PTO.PTOMEDICODI
      JOIN EQ_EQUIPO EQ ON PTO.EQUICODI = EQ.EQUICODI
      WHERE NVL(EQ.OSINERGCODI,'0') &#60;> '0'
      )
    </query>
  </Sql>

  <Sql>
    <key>ListarAntiguedadDatos</key>
    <query>
      SELECT NVL(MONTHS_BETWEEN(TO_DATE(TO_CHAR(SYSDATE,'YYYYMM'),'YYYYMM'), TO_DATE(MAX(RCDEULPERIODO),'YYYYMM') ),999)  MESES
      FROM RCA_DEMANDA_USUARIO
    </query>
  </Sql>
  
  <Sql>
    <key>ListarUltimoPeriodo</key>
    <query>
      SELECT MAX(PSICLIANIOMESPERREM) AS PERIODO FROM IIO_PERIODO_SICLI WHERE PSICLICERRADO = '1'
    </query>
  </Sql> 

  <Sql>
    <key>ReporteTotalDatos</key>
    <query>
      SELECT NVL(CL.EMPRRAZSOCIAL,CL.EMPRNOMB) AS EMPRESA,ES.EMPRNOMB AS SUMINISTRADOR,AR.AREANOMB AS SUBESTACION
      ,EJE.RCEJEUCARGARECHAZADA,TO_CHAR(EJE.RCEJEUFECHORINICIO,'HH24:MI:SS') AS RCCUADHORINIEJEC,
      TO_CHAR(EJE.RCEJEUFECHORFIN,'HH24:MI:SS') AS RCCUADHORFINEJEC,ROUND((EJE.RCEJEUFECHORFIN - EJE.RCEJEUFECHORINICIO) * (60 * 24),2) AS DURACION
      FROM RCA_CUADRO_PROG P JOIN RCA_CUADRO_PROG_USUARIO PU ON P.RCCUADCODI = PU.RCCUADCODI
      JOIN RCA_CUADRO_EJEC_USUARIO EJE ON PU.RCPROUCODI = EJE.RCPROUCODI
      LEFT JOIN SI_EMPRESA ES ON PU.RCPROUEMPRCODISUMINISTRADOR = ES.EMPRCODI
      LEFT JOIN EQ_EQUIPO EQ ON PU.EQUICODI = EQ.EQUICODI
      LEFT JOIN SI_EMPRESA CL ON PU.EMPRCODI = CL.EMPRCODI
      LEFT JOIN EQ_AREA AR ON EQ.AREACODI = AR.AREACODI
      WHERE EJE.RCEJEUTIPOREPORTE = 'D' AND  P.RCCUADCODEVENTOCTAF = :RCCUADCODEVENTOCTAF {0}
      AND TRIM(PU.RCCUADHORINICOORD) IS NOT NULL
    </query>
  </Sql>

  <Sql>
    <key>ReporteDemoraEjecucion</key>
    <query>
      SELECT NVL(CL.EMPRRAZSOCIAL,CL.EMPRNOMB) AS EMPRESA,ES.EMPRNOMB AS SUMINISTRADOR
      ,TO_CHAR(CASE WHEN PU.RCCUADHORINICOORD IS NOT NULL THEN TO_DATE(TO_CHAR(P.RCCUADFECHORINICIO,'DD/MM/YYYY')||' '||PU.RCCUADHORINICOORD,'DD/MM/YYYY HH24:MI') ELSE P.RCCUADFECHORINICIO END,'HH24:MI:SS DD.MM.YYYY') AS RCCUADHORINICOORD
      ,TO_CHAR(EJE.RCEJEUFECHORINICIO,'HH24:MI:SS DD.MM.YYYY') AS RCCUADHORINIEJEC
      ,ROUND((EJE.RCEJEUFECHORINICIO - CASE WHEN PU.RCCUADHORINICOORD IS NOT NULL THEN TO_DATE(TO_CHAR(P.RCCUADFECHORINICIO,'DD/MM/YYYY')||' '||PU.RCCUADHORINICOORD,'DD/MM/YYYY HH24:MI') ELSE P.RCCUADFECHORINICIO END) * (60 * 24),2) - 15 AS DURACION
      FROM RCA_CUADRO_PROG P JOIN RCA_CUADRO_PROG_USUARIO PU ON P.RCCUADCODI = PU.RCCUADCODI
      JOIN RCA_CUADRO_EJEC_USUARIO EJE ON PU.RCPROUCODI = EJE.RCPROUCODI
      LEFT JOIN SI_EMPRESA ES ON PU.RCPROUEMPRCODISUMINISTRADOR = ES.EMPRCODI
      LEFT JOIN EQ_EQUIPO EQ ON PU.EQUICODI = EQ.EQUICODI
      LEFT JOIN SI_EMPRESA CL ON PU.EMPRCODI = CL.EMPRCODI
      LEFT JOIN EQ_AREA AR ON EQ.AREACODI = AR.AREACODI
      WHERE ROUND((EJE.RCEJEUFECHORINICIO - (CASE WHEN PU.RCCUADHORINICOORD IS NOT NULL THEN TO_DATE(TO_CHAR(P.RCCUADFECHORINICIO,'DD/MM/YYYY')||' '||PU.RCCUADHORINICOORD,'DD/MM/YYYY HH24:MI') ELSE P.RCCUADFECHORINICIO END))*(60*24),2) > 15
      AND EJE.RCEJEUTIPOREPORTE = 'D' AND  P.RCCUADCODEVENTOCTAF = :RCCUADCODEVENTOCTAF {0} 
      AND TRIM(PU.RCCUADHORINICOORD) IS NOT NULL
    </query>
  </Sql>

  <Sql>
    <key>ReporteDemoraReestablecimiento</key>
    <query>
      SELECT NVL(CL.EMPRRAZSOCIAL,CL.EMPRNOMB) AS EMPRESA,ES.EMPRNOMB AS SUMINISTRADOR
      ,TO_CHAR(CASE WHEN PU.RCCUADHORFINCOORD IS NOT NULL THEN TO_DATE(TO_CHAR(P.RCCUADFECHORFIN,'DD/MM/YYYY')||' '||PU.RCCUADHORFINCOORD,'DD/MM/YYYY HH24:MI') ELSE P.RCCUADFECHORFIN END,'HH24:MI:SS DD.MM.YYYY') AS RCCUADHORFINCOORD
      ,TO_CHAR(EJE.RCEJEUFECHORFIN,'HH24:MI:SS DD.MM.YYYY') AS RCCUADHORFINEJEC
      ,ROUND((EJE.RCEJEUFECHORFIN - CASE WHEN PU.RCCUADHORFINCOORD IS NOT NULL THEN TO_DATE(TO_CHAR(P.RCCUADFECHORFIN,'DD/MM/YYYY')||' '||PU.RCCUADHORFINCOORD,'DD/MM/YYYY HH24:MI') ELSE P.RCCUADFECHORFIN END) * (60 * 24),2) - 15 AS DURACION
      FROM RCA_CUADRO_PROG P JOIN RCA_CUADRO_PROG_USUARIO PU ON P.RCCUADCODI = PU.RCCUADCODI
      JOIN RCA_CUADRO_EJEC_USUARIO EJE ON PU.RCPROUCODI = EJE.RCPROUCODI
      LEFT JOIN SI_EMPRESA ES ON PU.RCPROUEMPRCODISUMINISTRADOR = ES.EMPRCODI
      LEFT JOIN EQ_EQUIPO EQ ON PU.EQUICODI = EQ.EQUICODI
      LEFT JOIN SI_EMPRESA CL ON PU.EMPRCODI = CL.EMPRCODI
      LEFT JOIN EQ_AREA AR ON EQ.AREACODI = AR.AREACODI
      WHERE EJE.RCEJEUTIPOREPORTE = 'D' AND P.RCCUADCODEVENTOCTAF = :RCCUADCODEVENTOCTAF {0}
      AND (EJE.RCEJEUFECHORFIN - (CASE WHEN PU.RCCUADHORFINCOORD IS NOT NULL THEN TO_DATE(TO_CHAR(P.RCCUADFECHORFIN,'DD/MM/YYYY')||' '||PU.RCCUADHORFINCOORD,'DD/MM/YYYY HH24:MI') ELSE P.RCCUADFECHORFIN END))*(60*24) > 15 
      AND TRIM(PU.RCCUADHORINICOORD) IS NOT NULL
    </query>
  </Sql>

  <Sql>
    <key>ReporteInterrupcionesMenores</key>
    <query>
      SELECT NVL(CL.EMPRRAZSOCIAL,CL.EMPRNOMB) AS EMPRESA,ES.EMPRNOMB AS SUMINISTRADOR
      ,EJE.RCEJEUCARGARECHAZADA
      ,TO_CHAR(EJE.RCEJEUFECHORINICIO,'HH24:MI:SS DD.MM.YYYY') AS RCEJEUFECHORINICIO
      ,TO_CHAR(EJE.RCEJEUFECHORFIN,'HH24:MI:SS DD.MM.YYYY') AS RCEJEUFECHORFIN
      ,ROUND((EJE.RCEJEUFECHORFIN - EJE.RCEJEUFECHORINICIO) * (60 * 24),2) AS DURACION
      FROM RCA_CUADRO_PROG P JOIN RCA_CUADRO_PROG_USUARIO PU ON P.RCCUADCODI = PU.RCCUADCODI
      JOIN RCA_CUADRO_EJEC_USUARIO EJE ON PU.RCPROUCODI = EJE.RCPROUCODI
      LEFT JOIN SI_EMPRESA ES ON PU.RCPROUEMPRCODISUMINISTRADOR = ES.EMPRCODI
      LEFT JOIN EQ_EQUIPO EQ ON PU.EQUICODI = EQ.EQUICODI
      LEFT JOIN SI_EMPRESA CL ON PU.EMPRCODI = CL.EMPRCODI
      LEFT JOIN EQ_AREA AR ON EQ.AREACODI = AR.AREACODI
      WHERE EJE.RCEJEUTIPOREPORTE = 'D' AND P.RCCUADCODEVENTOCTAF = :RCCUADCODEVENTOCTAF {0}
      AND (EJE.RCEJEUFECHORFIN - EJE.RCEJEUFECHORINICIO)* (60 * 24) &#60; 3
      AND TRIM(PU.RCCUADHORINICOORD) IS NOT NULL
    </query>
  </Sql>

  <Sql>
    <key>ReporteDemorasFinalizar</key>
    <query>
      SELECT NVL(CL.EMPRRAZSOCIAL,CL.EMPRNOMB) AS EMPRESA
      ,EJE.RCEJEUCARGARECHAZADA
      ,TO_CHAR(EJE.RCEJEUFECHORINICIO,'HH24:MI:SS DD.MM.YYYY') AS RCEJEUFECHORINICIO
      ,TO_CHAR(EJE.RCEJEUFECHORFIN,'HH24:MI:SS DD.MM.YYYY') AS RCEJEUFECHORFIN
      --,ROUND((CASE WHEN PU.RCCUADHORFINCOORD IS NOT NULL THEN TO_DATE(TO_CHAR(P.RCCUADFECHORFIN,'DD/MM/YYYY')||' '||PU.RCCUADHORFINCOORD,'DD/MM/YYYY HH24:MI') ELSE P.RCCUADFECHORFIN END - EJE.RCEJEUFECHORINICIO) * (60 * 24),2) + 15 AS DURACION
      --,TO_CHAR(CASE WHEN PU.RCCUADHORFINCOORD IS NOT NULL THEN TO_DATE(TO_CHAR(P.RCCUADFECHORFIN,'DD/MM/YYYY')||' '||PU.RCCUADHORFINCOORD,'DD/MM/YYYY HH24:MI') ELSE P.RCCUADFECHORFIN END +(1/1440*15),'HH24:MI:SS DD.MM.YYYY')  AS RCCUADFECHORFINCOORD
      ,CASE WHEN (EJE.RCEJEUFECHORFIN - (CASE WHEN PU.RCCUADHORFINCOORD IS NOT NULL THEN TO_DATE(TO_CHAR(P.RCCUADFECHORFIN,'DD/MM/YYYY')||' '||PU.RCCUADHORFINCOORD,'DD/MM/YYYY HH24:MI') ELSE P.RCCUADFECHORFIN END))*(60*24) > 15
      THEN
      TO_CHAR(CASE WHEN PU.RCCUADHORFINCOORD IS NOT NULL THEN TO_DATE(TO_CHAR(P.RCCUADFECHORFIN,'DD/MM/YYYY')||' '||PU.RCCUADHORFINCOORD,'DD/MM/YYYY HH24:MI') ELSE P.RCCUADFECHORFIN END +(1/1440*15),'HH24:MI:SS DD.MM.YYYY')
      ELSE TO_CHAR(EJE.RCEJEUFECHORFIN,'HH24:MI:SS DD.MM.YYYY')  END
      AS RCCUADFECHORFINCOORD
      ,CASE WHEN (EJE.RCEJEUFECHORFIN - (CASE WHEN PU.RCCUADHORFINCOORD IS NOT NULL THEN TO_DATE(TO_CHAR(P.RCCUADFECHORFIN,'DD/MM/YYYY')||' '||PU.RCCUADHORFINCOORD,'DD/MM/YYYY HH24:MI') ELSE P.RCCUADFECHORFIN END))*(60*24) > 15
      THEN
      ROUND((CASE WHEN PU.RCCUADHORFINCOORD IS NOT NULL THEN TO_DATE(TO_CHAR(P.RCCUADFECHORFIN,'DD/MM/YYYY')||' '||PU.RCCUADHORFINCOORD,'DD/MM/YYYY HH24:MI') +(1/1440*15) ELSE P.RCCUADFECHORFIN END - EJE.RCEJEUFECHORINICIO) * (60 * 24),2)
      ELSE
      ROUND((EJE.RCEJEUFECHORFIN - EJE.RCEJEUFECHORINICIO) * (60 * 24),2)
      END AS DURACION
      FROM RCA_CUADRO_PROG P JOIN RCA_CUADRO_PROG_USUARIO PU ON P.RCCUADCODI = PU.RCCUADCODI
      JOIN RCA_CUADRO_EJEC_USUARIO EJE ON PU.RCPROUCODI = EJE.RCPROUCODI
      LEFT JOIN SI_EMPRESA ES ON PU.RCPROUEMPRCODISUMINISTRADOR = ES.EMPRCODI
      LEFT JOIN EQ_EQUIPO EQ ON PU.EQUICODI = EQ.EQUICODI
      LEFT JOIN SI_EMPRESA CL ON PU.EMPRCODI = CL.EMPRCODI
      LEFT JOIN EQ_AREA AR ON EQ.AREACODI = AR.AREACODI
      WHERE EJE.RCEJEUTIPOREPORTE = 'D' AND P.RCCUADCODEVENTOCTAF = :RCCUADCODEVENTOCTAF {0}
      AND (EJE.RCEJEUFECHORFIN - EJE.RCEJEUFECHORINICIO)* (60 * 24) >= 3
      --AND (EJE.RCEJEUFECHORFIN - (CASE WHEN PU.RCCUADHORFINCOORD IS NOT NULL THEN TO_DATE(TO_CHAR(P.RCCUADFECHORFIN,'DD/MM/YYYY')||' '||PU.RCCUADHORFINCOORD,'DD/MM/YYYY HH24:MI') ELSE P.RCCUADFECHORFIN END))*(60*24) > 15
      AND TRIM(PU.RCCUADHORINICOORD) IS NOT NULL
      AND EJE.RCEJEUCARGARECHAZADA > 0
    </query>
  </Sql>

  <Sql>
    <key>ReporteDemorasResarcimiento</key>
    <query>
      SELECT NVL(CL.EMPRRAZSOCIAL,CL.EMPRNOMB) AS EMPRESA
      ,EJE.RCEJEUCARGARECHAZADA
      ,TO_CHAR(EJE.RCEJEUFECHORINICIO,'HH24:MI:SS DD.MM.YYYY') AS RCEJEUFECHORINICIO
      ,TO_CHAR(EJE.RCEJEUFECHORFIN,'HH24:MI:SS DD.MM.YYYY') AS RCEJEUFECHORFIN
      --,ROUND((CASE WHEN PU.RCCUADHORFINCOORD IS NOT NULL THEN TO_DATE(TO_CHAR(P.RCCUADFECHORFIN,'DD/MM/YYYY')||' '||PU.RCCUADHORFINCOORD,'DD/MM/YYYY HH24:MI') ELSE P.RCCUADFECHORFIN END - EJE.RCEJEUFECHORINICIO) * (60 * 24),2) + 15 AS DURACION
      ,CASE WHEN (EJE.RCEJEUFECHORFIN - (CASE WHEN PU.RCCUADHORFINCOORD IS NOT NULL THEN TO_DATE(TO_CHAR(P.RCCUADFECHORFIN,'DD/MM/YYYY')||' '||PU.RCCUADHORFINCOORD,'DD/MM/YYYY HH24:MI') ELSE P.RCCUADFECHORFIN END))*(60*24) > 15
      THEN
      TO_CHAR(CASE WHEN PU.RCCUADHORFINCOORD IS NOT NULL THEN TO_DATE(TO_CHAR(P.RCCUADFECHORFIN,'DD/MM/YYYY')||' '||PU.RCCUADHORFINCOORD,'DD/MM/YYYY HH24:MI') ELSE P.RCCUADFECHORFIN END +(1/1440*15),'HH24:MI:SS DD.MM.YYYY')
      ELSE TO_CHAR(EJE.RCEJEUFECHORFIN,'HH24:MI:SS DD.MM.YYYY')  END
      AS RCCUADFECHORFINCOORD
      , CASE WHEN (EJE.RCEJEUFECHORFIN - (CASE WHEN PU.RCCUADHORFINCOORD IS NOT NULL THEN TO_DATE(TO_CHAR(P.RCCUADFECHORFIN,'DD/MM/YYYY')||' '||PU.RCCUADHORFINCOORD,'DD/MM/YYYY HH24:MI') ELSE P.RCCUADFECHORFIN END))*(60*24) > 15
      THEN
      ROUND((CASE WHEN PU.RCCUADHORFINCOORD IS NOT NULL THEN TO_DATE(TO_CHAR(P.RCCUADFECHORFIN,'DD/MM/YYYY')||' '||PU.RCCUADHORFINCOORD,'DD/MM/YYYY HH24:MI') +(1/1440*15) ELSE P.RCCUADFECHORFIN END - EJE.RCEJEUFECHORINICIO) * (60 * 24),2)
      ELSE
      ROUND((EJE.RCEJEUFECHORFIN - EJE.RCEJEUFECHORINICIO) * (60 * 24),2)
      END AS DURACION
      FROM RCA_CUADRO_PROG P JOIN RCA_CUADRO_PROG_USUARIO PU ON P.RCCUADCODI = PU.RCCUADCODI
      JOIN RCA_CUADRO_EJEC_USUARIO EJE ON PU.RCPROUCODI = EJE.RCPROUCODI
      LEFT JOIN SI_EMPRESA ES ON PU.RCPROUEMPRCODISUMINISTRADOR = ES.EMPRCODI
      LEFT JOIN EQ_EQUIPO EQ ON PU.EQUICODI = EQ.EQUICODI
      LEFT JOIN SI_EMPRESA CL ON PU.EMPRCODI = CL.EMPRCODI
      LEFT JOIN EQ_AREA AR ON EQ.AREACODI = AR.AREACODI
      WHERE EJE.RCEJEUTIPOREPORTE = 'D' AND P.RCCUADCODEVENTOCTAF = :RCCUADCODEVENTOCTAF {0}
      AND (EJE.RCEJEUFECHORFIN - EJE.RCEJEUFECHORINICIO)* (60 * 24) >= 3
      --AND (EJE.RCEJEUFECHORFIN - (CASE WHEN PU.RCCUADHORFINCOORD IS NOT NULL THEN TO_DATE(TO_CHAR(P.RCCUADFECHORFIN,'DD/MM/YYYY')||' '||PU.RCCUADHORFINCOORD,'DD/MM/YYYY HH24:MI') ELSE P.RCCUADFECHORFIN END))*(60*24) > 15
      AND TRIM(PU.RCCUADHORINICOORD) IS NOT NULL
      AND EJE.RCEJEUCARGARECHAZADA > 0
    </query>
  </Sql>

  <Sql>    
    <key>DeleteRcaMedidorMinutoTmp</key>
    <query>
      DELETE FROM RCA_MEDIDOR_MINUTO_TMP WHERE RCMEMICODEVENTOCTAF = '{0}'
    </query>
  </Sql>

  <Sql>
    <key>DeleteRcaEvaluacionTmp</key>
    <query>
      DELETE FROM RCA_EVALUACION_RMC_TMP WHERE RCERMCCODEVENTOCTAF = '{0}'
    </query>
  </Sql>
  <Sql>
    <key>DeleteRcaResulEvaluacionTmp</key>
    <query>
      DELETE FROM RCA_RESULT_EVAL_RMC_TMP WHERE RCREEVCODEVENTOCTAF = '{0}'
    </query>
  </Sql>

  <Sql>
    <key>ObtenerDatosEvaluacionCumplimiento</key>
    <query>
      SELECT EMPRCODI,EQUICODI,MIN(RCEJEDFECHOR) AS RCEJEUFECHORINICIO, MAX(RCEJEDFECHOR) AS RCEJEUFECHORFIN
      FROM RCA_CUADRO_PROG CP JOIN RCA_CUADRO_PROG_USUARIO PU ON CP.RCCUADCODI = PU.RCCUADCODI
      JOIN RCA_CUADRO_EJEC_USUARIO UE ON PU.RCPROUCODI = UE.RCPROUCODI
      join RCA_CUADRO_EJEC_USU_DET UD ON UE.rcejeucodi = UD.rcejeucodi
      WHERE CP.RCCUADCODEVENTOCTAF = '{0}'
      AND UE.RCEJEUTIPOREPORTE='D'
      AND (RCEJEUFECHORFIN - RCEJEUFECHORINICIO)*24*60 > 15
      GROUP BY EMPRCODI,EQUICODI
    </query>
  </Sql>

  <Sql>
    <key>InsertarTablaTempEvaluacionCumplimiento</key>
    <query>
      INSERT INTO RCA_MEDIDOR_MINUTO_TMP(RCMEMICODEVENTOCTAF,EQUICODI,EMPRCODI,RCMEMIFECHOR)
      SELECT '{0}',{1},{2}, TO_DATE('{3}','DD/MM/YYYY HH24:MI')+ (rownum-1)/24/60 AS DIAS_MES
      FROM DUAL
      CONNECT BY LEVEL &#60;= (SELECT (TO_DATE('{4}','DD/MM/YYYY HH24:MI') - TO_DATE('{3}','DD/MM/YYYY HH24:MI') )*24*60 + 1 FROM DUAL)
    </query>
  </Sql>

  <Sql>
    <key>ActualizacionCalculoPorMinutoEvaluacionCumplimiento</key>
    <query>
      UPDATE RCA_MEDIDOR_MINUTO_TMP SET RCMEMIPOTENCIA = (
      SELECT ROUND(POTENCIA_INI + ((RCMEMIFECHOR-INTERVALOINI)/(INTERVALOFIN-INTERVALOINI))*(POTENCIA_FIN-POTENCIA_INI),3) FROM (
      SELECT I1.EQUICODI,I1.RCEJEDFECHOR AS INTERVALOINI,I1.RCEJEDPOTENCIA AS POTENCIA_INI,I2.RCEJEDFECHOR AS INTERVALOFIN,I2.RCEJEDPOTENCIA AS POTENCIA_FIN
      FROM (SELECT EQUICODI,RCEJEDFECHOR,RCEJEDPOTENCIA,ROWNUM AS INTERVALO FROM (
      SELECT EQUICODI,RCEJEDFECHOR,RCEJEDPOTENCIA
      FROM RCA_CUADRO_PROG CP JOIN RCA_CUADRO_PROG_USUARIO PU ON CP.RCCUADCODI = PU.RCCUADCODI JOIN RCA_CUADRO_EJEC_USUARIO UE ON PU.RCPROUCODI = UE.RCPROUCODI
      join RCA_CUADRO_EJEC_USU_DET UD ON UE.rcejeucodi = UD.rcejeucodi
      WHERE CP.RCCUADCODEVENTOCTAF = '{0}'
      AND UE.RCEJEUTIPOREPORTE='D' ORDER BY EQUICODI,RCEJEDFECHOR)) I1 JOIN (SELECT EQUICODI,RCEJEDFECHOR,RCEJEDPOTENCIA,ROWNUM AS INTERVALO FROM (
      SELECT EQUICODI,RCEJEDFECHOR,RCEJEDPOTENCIA
      FROM RCA_CUADRO_PROG CP JOIN RCA_CUADRO_PROG_USUARIO PU ON CP.RCCUADCODI = PU.RCCUADCODI JOIN RCA_CUADRO_EJEC_USUARIO UE ON PU.RCPROUCODI = UE.RCPROUCODI
      join RCA_CUADRO_EJEC_USU_DET UD ON UE.rcejeucodi = UD.rcejeucodi
      WHERE CP.RCCUADCODEVENTOCTAF = '{0}'
      AND UE.RCEJEUTIPOREPORTE='D' ORDER BY EQUICODI,RCEJEDFECHOR)) I2 ON I1.EQUICODI = I2.EQUICODI AND  I1.INTERVALO = (I2.INTERVALO-1)
      ) R
      WHERE RCA_MEDIDOR_MINUTO_TMP.EQUICODI = R.EQUICODI AND RCA_MEDIDOR_MINUTO_TMP.RCMEMIFECHOR>=R.INTERVALOINI AND RCA_MEDIDOR_MINUTO_TMP.RCMEMIFECHOR &#60; R.INTERVALOFIN )
    WHERE RCMEMICODEVENTOCTAF = '{0}'

    </query>
  </Sql>

  <Sql>
    <key>RegistrarIntervaloEvaluacionCumplimiento</key>
    <query>
      INSERT INTO RCA_EVALUACION_RMC_TMP(RCERMCCODEVENTOCTAF,EQUICODI,EMPRCODI,RCERMCFECHORINI,RCERMCFECHORFIN,RCERMCPOTENCIARECHAZAR,RCEJEUCODI)
      SELECT CP.RCCUADCODEVENTOCTAF,PU.EQUICODI,PU.EMPRCODI
      ,(CASE WHEN PU.RCCUADHORINICOORD IS NOT NULL THEN TO_DATE(TO_CHAR(CP.RCCUADFECHORINICIO,'DD/MM/YYYY')||' '||PU.RCCUADHORINICOORD,'DD/MM/YYYY HH24:MI') ELSE CP.RCCUADFECHORINICIO END)  + (1/24/60)*15
      --,UE.RCEJEUFECHORINICIO
      ,(CASE WHEN PU.RCCUADHORFINCOORD IS NOT NULL THEN TO_DATE(TO_CHAR(CP.RCCUADFECHORINICIO,'DD/MM/YYYY')||' '||PU.RCCUADHORFINCOORD,'DD/MM/YYYY HH24:MI') ELSE CP.RCCUADFECHORFIN END)
      ,NVL(PU.RCPROUCARGARECHAZARCOORD,PU.RCPROUDEMANDARACIONAR) AS POTENCIA_RECHAZAR,UE.RCEJEUCODI
      FROM RCA_CUADRO_PROG CP JOIN RCA_CUADRO_PROG_USUARIO PU ON CP.RCCUADCODI = PU.RCCUADCODI JOIN RCA_CUADRO_EJEC_USUARIO UE ON PU.RCPROUCODI = UE.RCPROUCODI
      WHERE CP.RCCUADCODEVENTOCTAF = '{0}'
      AND UE.RCEJEUTIPOREPORTE='D'
      AND (RCEJEUFECHORFIN - RCEJEUFECHORINICIO)*24*60 > 15
    </query>
  </Sql>
  
  <Sql>
    <key>ObtenerValoresEvaluacionCliente</key>
    <query>
      SELECT EQUICODI,RCERMCFECHORINI,RCERMCFECHORFIN FROM RCA_EVALUACION_RMC_TMP WHERE RCERMCCODEVENTOCTAF = '{0}' ORDER BY EQUICODI,RCERMCFECHORINI 
    </query>
  </Sql>
  <Sql>
    <key>ActualizarEvaluacionCliente</key>
    <query>
      UPDATE RCA_EVALUACION_RMC_TMP SET RCERMCGRUPO = {1}
      WHERE RCERMCCODEVENTOCTAF= '{0}' AND EQUICODI = :EQUICODI AND RCERMCFECHORINI = :RCERMCFECHORINI
      AND RCERMCFECHORFIN = :RCERMCFECHORFIN     

    </query>
  </Sql>
  
  <Sql>
    <key>ObtenerValoresGeneralesEvaluacionCumplimiento</key>
    <query>
      SELECT EQUICODI,RCERMCGRUPO,MIN(RCERMCFECHORINI) AS RCERMCFECHORINI FROM RCA_EVALUACION_RMC_TMP WHERE RCERMCCODEVENTOCTAF = '{0}' GROUP BY EQUICODI, RCERMCGRUPO
    </query>
  </Sql>

  <Sql>
    <key>ObtenerValorPromedioEvaluacionCumplimiento</key>
    <query>
      SELECT NVL(ROUND(AVG(RCMEMIPOTENCIA),2),0) AS V_POT_PROMEDIO
      FROM RCA_MEDIDOR_MINUTO_TMP WHERE RCMEMICODEVENTOCTAF= '{0}' AND EQUICODI = {1}
      AND RCMEMIFECHOR BETWEEN TO_DATE('{2}','DD/MM/YYYY HH24:MI') - (1/24) AND TO_DATE('{2}','DD/MM/YYYY HH24:MI') - (1/24/60)*15

    </query>
  </Sql>

  <Sql>
    <key>ActualizarValorPromedioEvaluacionCumplimiento</key>
    <query>
      UPDATE RCA_EVALUACION_RMC_TMP
      SET RCERMCPOTENCIAPROMPREVIA = {2}, RCERMCPOTENCIANORECHAZADA = CASE WHEN NVL(RCERMCPOTENCIARECHAZAR,0) > NVL({2},0) THEN 0 ELSE NVL({2},0) - NVL(RCERMCPOTENCIARECHAZAR,0)  END
      WHERE RCERMCCODEVENTOCTAF= '{0}' AND EQUICODI = {1} AND RCERMCGRUPO = {3}

    </query>
  </Sql>

  <Sql>
    <key>ObtenerDatosCalculoFinalEvaluacionCumplimiento</key>
    <query>
      SELECT RCERMCCODEVENTOCTAF, EQUICODI, EMPRCODI, RCERMCFECHORINI, RCERMCFECHORFIN, RCERMCPOTENCIARECHAZAR, RCERMCPOTENCIANORECHAZADA,
            RCERMCENERGIADEBIORECHAZAR, RCERMCPOTENCIAPROMPREVIA, RCERMCGRUPO, RCEJEUCODI, RCERMCPOTENCIARECHAZADA
      FROM RCA_EVALUACION_RMC_TMP WHERE RCERMCCODEVENTOCTAF = '{0}' ORDER BY EQUICODI

    </query>
  </Sql>

  <Sql>
    <key>ActualizarDatosCalculoFinalEvaluacionCumplimiento</key>
    <query>
      UPDATE RCA_MEDIDOR_MINUTO_TMP
      SET RCMEMIPOTENCIANORECHAZADA = CASE WHEN NVL(RCMEMIPOTENCIA,0) > NVL({2},0) THEN
      CASE WHEN NVL(RCMEMIPOTENCIA,0) > NVL({1},0) THEN NVL({1},0) - NVL({2},0)
      ELSE NVL(RCMEMIPOTENCIA,0) - NVL({2},0) END
      ELSE 0 END
      WHERE RCMEMICODEVENTOCTAF= '{0}' AND EQUICODI = :EQUICODI
      AND RCMEMIFECHOR BETWEEN TO_DATE('{3}','DD/MM/YYYY HH24:MI') AND  TO_DATE('{4}','DD/MM/YYYY HH24:MI')

    </query>
  </Sql>
  
  <Sql>
    <key>ActualizarDatosCalculoFinal2EvaluacionCumplimiento</key>
    <query>
      UPDATE RCA_EVALUACION_RMC_TMP
      SET RCERMCENERGIADEBIORECHAZAR = CASE WHEN RCERMCFECHORFIN >= RCERMCFECHORINI THEN (RCERMCFECHORFIN-RCERMCFECHORINI)*24*60*RCERMCPOTENCIANORECHAZADA END
      WHERE RCERMCCODEVENTOCTAF= '{0}' AND EQUICODI = :EQUICODI

    </query>
  </Sql>
  
   <Sql>
    <key>InsertarResultadoEvaluacionFinal</key>
    <query>
      INSERT INTO RCA_RESULT_EVAL_RMC_TMP(RCREEVCODEVENTOCTAF,EQUICODI,RCREEVGRUPO,RCREEVFECHORINI,RCREEVFECHORFIN,RCREEVENERGIAHABRIAGENERADO,RCREEVENERGIADEBIORECHAZARRMC,RCREEVPOTENCIAPROMPREVIA)
      SELECT RCERMCCODEVENTOCTAF,EQUICODI,RCERMCGRUPO,MIN(RCERMCFECHORINI) AS HORINI,MAX(RCERMCFECHORFIN) AS HORFIN
      ,CASE WHEN MAX(RCERMCFECHORFIN) >= MIN(RCERMCFECHORINI) THEN (MAX(RCERMCFECHORFIN)- MIN(RCERMCFECHORINI))*24*60*MAX(RCERMCPOTENCIAPROMPREVIA) END  AS RCREEVENERGIAHABRIAGENERADO    
      ,SUM(RCERMCENERGIADEBIORECHAZAR) AS RCREEVENERGIADEBIORECHAZARRMC
      ,MAX(RCERMCPOTENCIAPROMPREVIA)
      FROM RCA_EVALUACION_RMC_TMP where RCERMCCODEVENTOCTAF = '{0}'
      GROUP BY RCERMCCODEVENTOCTAF,EQUICODI,RCERMCGRUPO

    </query>
  </Sql>
  <Sql>
    <key>ActualizarResultadoEvaluacionFinal</key>
    <query>
      UPDATE RCA_RESULT_EVAL_RMC_TMP SET RCREEVENERGIADEBIORECHAZARTOT = NVL(RCREEVENERGIAHABRIAGENERADO,0) - NVL(RCREEVENERGIADEBIORECHAZARRMC,0)
      WHERE RCREEVCODEVENTOCTAF = '{0}' AND  NVL(RCREEVENERGIAHABRIAGENERADO,0) >= NVL(RCREEVENERGIADEBIORECHAZARRMC,0)    

    </query>
  </Sql>
   <Sql>
    <key>ActualizarResultadoEvaluacionFinal2</key>
    <query>
      UPDATE RCA_RESULT_EVAL_RMC_TMP SET RCREEVENERGIANORECHAZADATOT = (SELECT SUM(RCMEMIPOTENCIANORECHAZADA) FROM RCA_MEDIDOR_MINUTO_TMP M 
                                        WHERE M.RCMEMICODEVENTOCTAF = RCA_RESULT_EVAL_RMC_TMP.RCREEVCODEVENTOCTAF
                                        AND M.EQUICODI = RCA_RESULT_EVAL_RMC_TMP.EQUICODI
                                        AND M.RCMEMIFECHOR BETWEEN RCA_RESULT_EVAL_RMC_TMP.RCREEVFECHORINI AND RCA_RESULT_EVAL_RMC_TMP.RCREEVFECHORFIN
                                        )
    WHERE RCREEVCODEVENTOCTAF = '{0}' 

    </query>
  </Sql>
  <Sql>
    <key>ActualizarResultadoEvaluacionFinal3</key>
    <query>
      UPDATE RCA_RESULT_EVAL_RMC_TMP SET RCREEVFACTOREVALRMC = CASE WHEN RCREEVENERGIADEBIORECHAZARTOT > 0 THEN 1 - (RCREEVENERGIANORECHAZADATOT/RCREEVENERGIADEBIORECHAZARTOT) END
    WHERE RCREEVCODEVENTOCTAF = '{0}' 

    </query>
  </Sql>
  
  <Sql>
    <key>ActualizarResultadoEvaluacionFinalPotenciaRechazada</key>
    <query>
     UPDATE RCA_EVALUACION_RMC_TMP SET RCERMCPOTENCIARECHAZADA = RCERMCPOTENCIAPROMPREVIA - (SELECT ROUND(AVG(RCMEMIPOTENCIA),2) FROM RCA_MEDIDOR_MINUTO_TMP M 
                                        WHERE M.RCMEMICODEVENTOCTAF = RCA_EVALUACION_RMC_TMP.RCERMCCODEVENTOCTAF
                                        AND M.EQUICODI = RCA_EVALUACION_RMC_TMP.EQUICODI
                                        AND M.RCMEMIFECHOR BETWEEN RCA_EVALUACION_RMC_TMP.RCERMCFECHORINI AND RCA_EVALUACION_RMC_TMP.RCERMCFECHORFIN
                                        )
    WHERE RCERMCCODEVENTOCTAF = '{0}'

    </query>
  </Sql>
  
  <Sql>
    <key>ActualizarResultadoEvaluacionFinalPotenciaRechazadaEvaluacion</key>
    <query>
      UPDATE RCA_RESULT_EVAL_RMC_TMP SET RCREEVPOTENCIARECHAZADA = RCREEVPOTENCIAPROMPREVIA - (SELECT ROUND(AVG(RCMEMIPOTENCIA),2) FROM RCA_MEDIDOR_MINUTO_TMP M 
                                        WHERE M.RCMEMICODEVENTOCTAF = RCA_RESULT_EVAL_RMC_TMP.RCREEVCODEVENTOCTAF
                                        AND M.EQUICODI = RCA_RESULT_EVAL_RMC_TMP.EQUICODI
                                        AND M.RCMEMIFECHOR BETWEEN RCA_RESULT_EVAL_RMC_TMP.RCREEVFECHORINI AND RCA_RESULT_EVAL_RMC_TMP.RCREEVFECHORFIN
                                        )
    WHERE RCREEVCODEVENTOCTAF = '{0}'

    </query>
  </Sql>

  <Sql>
    <key>ReporteEvaluacionCumplimiento</key>
    <query>
      SELECT NVL(CL.EMPRRAZSOCIAL,CL.EMPRNOMB) AS EMPRESA,ES.EMPRNOMB AS SUMINISTRADOR
      ,PU.RCPROUCARGARECHAZARCOORD
      ,TO_CHAR(CASE WHEN PU.RCCUADHORINICOORD IS NOT NULL THEN TO_DATE(TO_CHAR(P.RCCUADFECHORINICIO,'DD/MM/YYYY')||' '||PU.RCCUADHORINICOORD,'DD/MM/YYYY HH24:MI') ELSE P.RCCUADFECHORINICIO END,'HH24:MI:SS DD.MM.YYYY') AS RCCUADFECHORINICOORD
      ,TO_CHAR(CASE WHEN PU.RCCUADHORFINCOORD IS NOT NULL THEN TO_DATE(TO_CHAR(P.RCCUADFECHORFIN,'DD/MM/YYYY')||' '||PU.RCCUADHORFINCOORD,'DD/MM/YYYY HH24:MI') ELSE P.RCCUADFECHORFIN END,'HH24:MI:SS DD.MM.YYYY') AS RCCUADFECHORFINCOORD
      ,EV.RCREEVPOTENCIAPROMPREVIA
      ,TO_CHAR(EV.RCREEVFECHORINI - 1/24,'HH24:MI:SS DD.MM.YYYY') AS HORINIPREVIO
      ,TO_CHAR(EV.RCREEVFECHORINI - 1/24/60*15,'HH24:MI:SS DD.MM.YYYY') AS HORFINPREVIO
      ,RMC.RCERMCPOTENCIARECHAZADA AS RCEJEUCARGARECHAZADA
      ,TO_CHAR(RMC.RCERMCFECHORINI,'HH24:MI:SS DD.MM.YYYY') AS RCEJEUFECHORINICIO
      ,TO_CHAR(RMC.RCERMCFECHORFIN,'HH24:MI:SS DD.MM.YYYY') AS RCEJEUFECHORFIN
      ,CASE WHEN EV.RCREEVFACTOREVALRMC >= 0.95 THEN 'CUMPLIO      ('||ROUND(EV.RCREEVFACTOREVALRMC*100,2)||' % > 95%)' ELSE 'NO CUMPLIO      ('||ROUND(EV.RCREEVFACTOREVALRMC*100,2)||' % &#60; 95%)' END AS EVALUACION

      FROM RCA_CUADRO_PROG P JOIN RCA_CUADRO_PROG_USUARIO PU ON P.RCCUADCODI = PU.RCCUADCODI
      JOIN RCA_CUADRO_EJEC_USUARIO EJE ON PU.RCPROUCODI = EJE.RCPROUCODI
      LEFT JOIN SI_EMPRESA ES ON PU.RCPROUEMPRCODISUMINISTRADOR = ES.EMPRCODI
      LEFT JOIN EQ_EQUIPO EQ ON PU.EQUICODI = EQ.EQUICODI
      LEFT JOIN SI_EMPRESA CL ON PU.EMPRCODI = CL.EMPRCODI
      LEFT JOIN EQ_AREA AR ON EQ.AREACODI = AR.AREACODI
      LEFT JOIN RCA_EVALUACION_RMC_TMP RMC ON P.RCCUADCODEVENTOCTAF = RMC.RCERMCCODEVENTOCTAF AND PU.EQUICODI = RMC.EQUICODI AND EJE.RCEJEUCODI = RMC.RCEJEUCODI
      LEFT JOIN RCA_RESULT_EVAL_RMC_TMP EV ON RMC.RCERMCCODEVENTOCTAF = EV.RCREEVCODEVENTOCTAF AND RMC.EQUICODI = EV.EQUICODI AND RMC.RCERMCGRUPO = EV.RCREEVGRUPO
      WHERE P.RCCUADCODEVENTOCTAF = :RCCUADCODEVENTOCTAF {0}
      AND TRIM(PU.RCCUADHORINICOORD) IS NOT NULL
      AND (RCEJEUFECHORFIN - RCEJEUFECHORINICIO)*24*60 > 15
      ORDER BY 1,2,P.RCCUADFECHORINICIO

    </query>
  </Sql>

  <Sql>
    <key>ReporteInterrupInformeTecnico</key>
    <query>
      SELECT NVL(CL.EMPRRAZSOCIAL,CL.EMPRNOMB) AS EMPRESA,ES.EMPRNOMB AS SUMINISTRADOR,AR.AREANOMB AS SUBESTACION
      ,PU.RCPROUCARGARECHAZARCOORD
      ,TO_CHAR(CASE WHEN PU.RCCUADHORINICOORD IS NOT NULL THEN TO_DATE(TO_CHAR(P.RCCUADFECHORINICIO,'DD/MM/YYYY')||' '||PU.RCCUADHORINICOORD,'DD/MM/YYYY HH24:MI') ELSE P.RCCUADFECHORINICIO END,'HH24:MI:SS DD.MM.YYYY') AS RCCUADFECHORINICOORD
      ,TO_CHAR(CASE WHEN PU.RCCUADHORFINCOORD IS NOT NULL THEN TO_DATE(TO_CHAR(P.RCCUADFECHORFIN,'DD/MM/YYYY')||' '||PU.RCCUADHORFINCOORD,'DD/MM/YYYY HH24:MI') ELSE P.RCCUADFECHORFIN END,'HH24:MI:SS DD.MM.YYYY') AS RCCUADFECHORFINCOORD
      ,EJE.RCEJEUCARGARECHAZADA
      ,TO_CHAR(EJE.RCEJEUFECHORINICIO,'HH24:MI:SS DD.MM.YYYY') AS RCEJEUFECHORINICIO
      ,TO_CHAR(EJE.RCEJEUFECHORFIN,'HH24:MI:SS DD.MM.YYYY') AS RCEJEUFECHORFIN
      ,ROUND((EJE.RCEJEUFECHORFIN - EJE.RCEJEUFECHORINICIO) * (60 * 24),2) AS DURACION

      FROM RCA_CUADRO_PROG P JOIN RCA_CUADRO_PROG_USUARIO PU ON P.RCCUADCODI = PU.RCCUADCODI
      JOIN RCA_CUADRO_EJEC_USUARIO EJE ON PU.RCPROUCODI = EJE.RCPROUCODI
      LEFT JOIN SI_EMPRESA ES ON PU.RCPROUEMPRCODISUMINISTRADOR = ES.EMPRCODI
      LEFT JOIN EQ_EQUIPO EQ ON PU.EQUICODI = EQ.EQUICODI
      LEFT JOIN SI_EMPRESA CL ON PU.EMPRCODI = CL.EMPRCODI
      LEFT JOIN EQ_AREA AR ON EQ.AREACODI = AR.AREACODI
      WHERE EJE.RCEJEUTIPOREPORTE = 'D' AND  P.RCCUADCODEVENTOCTAF = :RCCUADCODEVENTOCTAF  {0}
      AND ROUND((EJE.RCEJEUFECHORFIN - EJE.RCEJEUFECHORINICIO) * (60 * 24),2) >= 3 
      AND TRIM(PU.RCCUADHORINICOORD) IS NOT NULL
    </query>
  </Sql>

</Sqls>
