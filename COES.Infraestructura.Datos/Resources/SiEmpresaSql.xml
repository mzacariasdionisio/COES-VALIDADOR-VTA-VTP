<?xml version="1.0" encoding="utf-8" ?>
<Sqls>

  <Sql>
    <key>GetMaxId</key>
    <query>
      select nvl(max(emprcodi), 0) + 1 from si_empresa
    </query>
  </Sql>
    
  <Sql>
    <key>Save</key>
    <query>
      insert into si_empresa(
      emprcodi,
      emprnomb,
      tipoemprcodi,
      emprdire,
      emprtele,
      emprnumedocu,
      tipodocucodi,
      emprruc,
      emprabrev,
      emprorden,
      emprdom,
      emprsein,
      emprrazsocial,
      emprcoes,
      lastuser,
      lastdate,
      inddemanda,
      emprestado,
      emprdomiciliada,
      emprambito,
      emprrubro,
      empragente,
      emprnombrecomercial,
      emprdomiciliolegal,
      emprsigla,
      emprnumpartidareg,
      emprtelefono,
      emprfax,
      emprpagweb,
      emprcartaadjunto,
      emprestadoregistro,
      emprfecinscripcion,
      emprcartaadjuntofilename,
      emprcondicion,
      emprnroconstancia,
      emprnroregistro,
      emprusucreacion,
      emprfeccreacion,
      emprusumodificacion,
      emprfecmodificacion,
      emprindproveedor
      )
      values(
      :emprcodi,
      :emprnomb,
      :tipoemprcodi,
      :emprdire,
      :emprtele,
      :emprnumedocu,
      :tipodocucodi,
      :emprruc,
      :emprabrev,
      :emprorden,
      :emprdom,
      :emprsein,
      :emprrazsocial,
      :emprcoes,
      :lastuser,
      :lastdate,
      :inddemanda,
      :emprestado,
      :emprdomiciliada,
      :emprambito,
      :emprrubro,
      :empragente,
      :emprnombrecomercial,
      :emprdomiciliolegal,
      :emprsigla,
      :emprnumpartidareg,
      :emprtelefono,
      :emprfax,
      :emprpagweb,
      :emprcartaadjunto,
      :emprestadoregistro,
      :emprfecinscripcion,
      :emprcartaadjuntofilename,
      :emprcondicion,
      :emprnroconstancia,
      :emprnroregistro,
      :emprusucreacion,
      :emprfeccreacion,
      :emprusumodificacion,
      :emprfecmodificacion,
      :emprindproveedor
      )
    </query>
  </Sql>

  <Sql>
    <key>Update</key>
    <query>
		update si_empresa
		set
		emprnomb = :emprnomb,
		emprabrev = :emprabrev,
		tipoemprcodi = :tipoemprcodi,
		emprdire = :emprdire,
		emprtele = :emprtele,
		emprnumedocu = :emprnumedocu,
		tipodocucodi = :tipodocucodi,
		emprruc = :emprruc,
		emprcodosinergmin = :emprcodosinergmin,
		emprorden = :emprorden,
		emprdom = :emprdom,
		emprsein = :emprsein,
		emprrazsocial = :emprrazsocial,
		emprcoes = :emprcoes,
		lastuser = :lastuser,
		lastdate = :lastdate,
		inddemanda = :inddemanda,
		emprestado = :emprestado,
		emprdomiciliada = :emprdomiciliada,
		emprambito = :emprambito,
		emprrubro = :emprrubro,
		empragente = :empragente,
		--emprnombrecomercial = :emprnombrecomercial,
		--emprdomiciliolegal = :emprdomiciliolegal,
		--emprsigla = :emprsigla,
		--emprnumpartidareg = :emprnumpartidareg,
		--emprtelefono = :emprtelefono,
		--emprfax = :emprfax,
		--emprpagweb = :emprpagweb,
		--emprcartaadjunto = :emprcartaadjunto,
		--emprestadoregistro = :emprestadoregistro,
		--emprfecinscripcion = :emprfecinscripcion,
		--emprcartaadjuntofilename = :emprcartaadjuntofilename,
		--emprcondicion = :emprcondicion,
		--emprnroconstancia = :emprnroconstancia,
		--emprnroregistro = :emprnroregistro,
		emprusumodificacion = :emprusumodificacion,
		emprfecmodificacion = :emprfecmodificacion,
		emprindproveedor = :emprindproveedor
		where
		emprcodi = :emprcodi
	</query>
  </Sql>

  <Sql>
    <key>UpdateRI</key>
    <query>
      update si_empresa
      set
      emprnomb = :emprnomb,
      tipoemprcodi = :tipoemprcodi,
      emprdire = :emprdire,
      emprtele = :emprtele,
      emprnumedocu = :emprnumedocu,
      tipodocucodi = :tipodocucodi,
      emprruc = :emprruc,
      emprabrev = :emprabrev,
      emprorden = :emprorden,
      emprdom = :emprdom,
      emprsein = :emprsein,
      emprrazsocial = :emprrazsocial,
      emprcoes = :emprcoes,
      lastuser = :lastuser,
      lastdate = :lastdate,
      inddemanda = :inddemanda,
      emprestado = :emprestado,
      emprdomiciliada = :emprdomiciliada,
      emprambito = :emprambito,
      emprrubro = :emprrubro,
      empragente = :empragente,
      emprnombrecomercial = :emprnombrecomercial,
      emprdomiciliolegal = :emprdomiciliolegal,
      emprsigla = :emprsigla,
      emprnumpartidareg = :emprnumpartidareg,
      emprtelefono = :emprtelefono,
      emprfax = :emprfax,
      emprpagweb = :emprpagweb,
      emprcartaadjunto = :emprcartaadjunto,
      emprestadoregistro = :emprestadoregistro,
      emprfecinscripcion = :emprfecinscripcion,
      emprcartaadjuntofilename = :emprcartaadjuntofilename,
      emprcondicion = :emprcondicion,
      emprnroconstancia = :emprnroconstancia,
      emprnroregistro = :emprnroregistro,
      emprusumodificacion = :emprusumodificacion,
      emprfecmodificacion = :emprfecmodificacion,
      emprindproveedor = :emprindproveedor
      where
      emprcodi = :emprcodi
    </query>
  </Sql>

  <Sql>
    <key>Delete</key>
    <query>
      delete from si_empresa
      where
      emprcodi = :emprcodi
    </query>
  </Sql>

  <Sql>
    <key>GetById</key>
    <query>
      select
      emp.emprcodi,
      emp.emprnomb,
      emp.tipoemprcodi,
      emp.emprdire,
      emp.emprtele,
      emp.emprnumedocu,
      emp.tipodocucodi,
      emp.emprruc,
      emp.emprabrev,
      emp.emprorden,
      emp.emprdom,
      emp.emprsein,
      emp.emprrazsocial,
      emp.emprcoes,
      emp.lastuser,
      emp.lastdate,
      emp.compcode,
      emp.inddemanda,
      emp.emprestado,
      emp.emprcodosinergmin,
      emp.emprdomiciliada,
      emp.emprambito,
      emp.emprrubro,
      emp.empragente,
      emp.SCADACODI,
      temp.Tipoemprdesc,
      emp.emprindproveedor
      from si_empresa emp
      inner join SI_TIPOEMPRESA temp on temp.TIPOEMPRCODI = emp.TIPOEMPRCODI
      where
      emp.emprcodi = :emprcodi
    </query>
  </Sql>

  <Sql>
    <key>ActualizarEstado</key>
    <query>
      update si_empresa
      set
      emprestado = :emprestado,
      lastuser = :lastuser,
      lastdate = :lastdate
      where
      emprcodi = :emprcodi
    </query>
  </Sql>
  

  <Sql>
    <key>List</key>
    <query>
      select
      emprcodi,
      emprnomb,
      tipoemprcodi,
      emprdire,
      emprtele,
      emprnumedocu,
      tipodocucodi,
      emprruc,
      emprabrev,
      emprorden,
      emprdom,
      emprsein,
      emprrazsocial,
      emprcoes,
      lastuser,
      lastdate,
      compcode,
      inddemanda,
      emprestado,
      EMPRCODOSINERGMIN,
      emprdomiciliada,
      emprambito,
      emprrubro,
      empragente,
      SCADACODI
      from
      si_empresa
      where
      tipoemprcodi = :tipoemprcodi
      order by 2 asc
    </query>
  </Sql>
  
  <Sql>
    <key>ListGeneral</key>
    <query>
      select
      emprcodi,
      emprnomb,
      tipoemprcodi,
      emprdire,
      emprtele,
      emprnumedocu,
      tipodocucodi,
      emprruc,
      emprabrev,
      emprorden,
      emprdom,
      emprsein,
      emprrazsocial,
      emprcoes,
      lastuser,
      lastdate,
      compcode,
      inddemanda,
      emprestado,
      emprcodosinergmin,
      emprdomiciliada,
      emprambito,
      emprrubro,
      empragente,
      scadacodi
      from
      si_empresa
      where
      emprcodi not in(0,-1)
      order by 2 asc
    </query>
  </Sql>

  <Sql>
    <key>GetByCriteria</key>
    <query>
      select
      *
      from
      si_empresa
      where
      (tipoemprcodi in ({0}) or '{0}' = '-1' ) and emprsein = 'S'
      order by 2 asc

    </query>
  </Sql>

  <Sql>
    <key>ListarEmpresaDevolucion</key>
    <query>
      select
      e.emprcodi,
      e.emprnomb,
      e.tipoemprcodi,
      e.emprdire,
      e.emprtele,
      e.emprnumedocu,
      e.tipodocucodi,
      e.emprruc,
      e.emprabrev,
      e.emprorden,
      e.emprdom,
      e.emprsein,
      e.emprrazsocial,
      e.emprcoes,
      e.lastuser,
      e.lastdate,
      e.compcode,
      e.inddemanda,
      e.emprestado,
      e.emprcodosinergmin,
      e.emprdomiciliada,
      e.emprambito,
      e.emprrubro,
      e.empragente,
      e.scadacodi,
      te.TIPOEMPRDESC
      from
      si_empresa e
      inner join si_tipoempresa te on te.tipoemprcodi = nvl(e.tipoemprcodi, -1)
      where
      emprcodi not in(0,-1)
      order by 2 asc
    </query>
  </Sql>
  
  <Sql>
    <key>GetEmpresaSistemaPorTipo</key>
    <query>
      select
      emprcodi,
      emprnomb,
      tipoemprcodi,
      emprdire,
      emprtele,
      emprnumedocu,
      tipodocucodi,
      emprruc,
      emprabrev,
      emprorden,
      emprdom,
      emprsein,
      emprrazsocial,
      emprcoes,
      lastuser,
      lastdate,
      compcode,
      inddemanda,
      emprestado,
      emprcodosinergmin,
      emprdomiciliada,
      emprambito,
      emprrubro,
      empragente,
      SCADACODI
      from
      si_empresa
      where
      (tipoemprcodi in ({0}) or '{0}' = '-1' ) and emprsein = 'S' and emprcodi > 0 and emprestado = 'A'
      order by 2 asc

    </query>
  </Sql>

  <Sql>
    <key>GetEmpresasSein</key>
    <query>
      select *
      from
      si_empresa
      where emprsein = 'S' and emprcodi > 0 and emprestado = 'A'
      order by 2 asc
    </query>
  </Sql>

  <Sql>
    <key>GetByUser</key>
    <query>
      select
      em.emprcodi,
      emprnomb,
      tipoemprcodi,
      emprdire,
      emprtele,
      emprnumedocu,
      tipodocucodi,
      emprruc,
      emprabrev,
      emprorden,
      emprdom,
      emprsein,
      emprrazsocial,
      emprcoes,
      em.lastuser,
      em.lastdate,
      em.Compcode,
      inddemanda,
      emprestado,
      EMPRCODOSINERGMIN,
      emprdomiciliada,
      emprambito,
      emprrubro,
      empragente,
      scadacodi
      from
      si_empresa em
      inner join fw_user_x_empresa ue on ue.emprcodi = em.emprcodi
      inner join fw_user us on us.usercode = ue.usercode
      where us.userlogin = '{0}'
    </query>
  </Sql>

  <Sql>
    <key>GetEmpresasxCombustible</key>
    <query>
      select distinct gp.emprcodi emprcodi , emp.emprnomb  from  pr_grupo gp
      inner join si_empresa emp on emp.emprcodi = gp.emprcodi
      where catecodi in (2,3,4) and fenergcodi in ({0})
      order by emp.emprnomb
    </query>
  </Sql>

  <Sql>
    <key>GetEmpresasxCombustiblexUsuario</key>
    <query>
      select distinct gp.emprcodi emprcodi , emp.emprnomb  from  pr_grupo gp
      inner join si_empresa emp on emp.emprcodi = gp.emprcodi
      inner join fw_user_x_empresa ue on ue.emprcodi = emp.emprcodi
      where catecodi in (2,3,4) and fenergcodi in ({0}) and ue.usercode = '{1}'
      order by emp.emprnomb
    </query>
  </Sql>

  <Sql>
    <key>ListComboEmprGeneradora</key>
    <query>
      select * from si_empresa where tipoemprcodi in(3) order by emprnomb asc
    </query>
  </Sql>

  <Sql>
    <key>ListComboClientes</key>
    <query>
      select * from si_empresa where tipoemprcodi in(2,4) order by emprnomb asc
    </query>
  </Sql>

  <Sql>
    <key>ListEmprResponsables</key>
    <query>
      select * from si_empresa where tipoemprcodi in(:criterio) order by emprnomb asc
    </query>
  </Sql>

  <Sql>
    <key>ListInfoCliente</key>
    <query>
      select * from si_empresa where tipoemprcodi in(2,4) and UPPER(emprnomb) = UPPER(:emprnomb)
      order by emprnomb asc
    </query>
  </Sql>

  <Sql>
    <key>ListarPorTipoEmpresa</key>
    <query>
      select
      *
      from
      si_empresa
      where
      (tipoemprcodi = :tipoemprcodi or -2=:tipoemprcodi) and emprsein = 'S' and emprcodi> 0 and emprestado != 'E'
      order by 2 asc
    </query>
  </Sql>

  <Sql>
    <key>ListResponsable</key>
    <query>
      select
      *
      from
      si_empresa
      where
      emprcodi not in(0,-1) and
      UPPER(emprnomb) = UPPER(:emprnomb)
    </query>
  </Sql>

	<Sql>
		<key>GetEmpresasHidro</key>
    <query>
      select emp.emprnomb,emp.emprcodi from si_empresa emp where emp.emprcodi
      in (
      select distinct wvpt.emprcodi from eq_equipo eq
      inner join me_ptomedicion pto on pto.equicodi = eq.equicodi
      inner join me_hojaptomed hp on hp.ptomedicodi = pto.ptomedicodi
      inner join Si_Hisemppto_Data wvpt on wvpt.ptomedicodi = pto.ptomedicodi
      inner join me_formato f on f.formatcodi = hp.formatcodi
      inner join me_lectura l on l.lectcodi = f.lectcodi
      where l.origlectcodi = 16 )
      order by 1
    </query>
	</Sql>
  <Sql>
    <key>ObtenerEquiposCuencaHidro</key>
    <query>
      select eq_familia.famabrev || ' - ' ||  eq_equipo.equiabrev || ' (' || eq_equipo.equicodi || ')' as equinomb, eq_equipo.equicodi
      from eq_equipo, eq_familia where eq_familia.famcodi=eq_equipo.famcodi and eq_equipo.equiestado != 'B'
      and  eq_equipo.famcodi = 41
      order by  eq_familia.famabrev, eq_equipo.equiabrev
    </query>
  </Sql>

	<Sql>
		<key>GetEmpresasPtoMedicion</key>
		<query>
			select emp.emprnomb,emp.emprcodi from sic.si_empresa emp where emp.emprcodi
			in (
			select distinct pto.emprcodi from sic.eq_equipo eq
			inner join sic.me_ptomedicion pto on pto.equicodi = eq.equicodi and pto.emprcodi>0
			where pto.ptomediestado='A' and origlectcodi=38
			)
			order by 1
		</query>
	</Sql>

  <Sql>
    <key>GetEmpresasFormatoxUsuario</key>
    <query>
      select  distinct emp.* from me_hojaptomed hoja inner join me_ptomedicion pto on hoja.ptomedicodi = pto.ptomedicodi
      inner join SI_HISEMPPTO_DATA vwpt on vwpt.HPTDATFECHA &lt;= sysdate and (vwpt.PTOMEDICODI = pto.PTOMEDICODI OR vwpt.PTOMEDICODIOLD = pto.PTOMEDICODI)
      inner join si_empresa emp on vwpt.emprcodi = emp.emprcodi
      where hoja.formatcodi = {0} and emp.emprcodi = {1} order by emp.emprnomb asc
    </query>
  </Sql>

  <Sql>
    <key>GetEmpresasFormato</key>
    <query>
		select  distinct emp.* from me_hojaptomed hoja inner join me_ptomedicion pto on hoja.ptomedicodi = pto.ptomedicodi 
		inner join SI_HISEMPPTO_DATA vwpt on vwpt.HPTDATFECHA &lt;= sysdate and (vwpt.PTOMEDICODI = pto.PTOMEDICODI OR vwpt.PTOMEDICODIOLD = pto.PTOMEDICODI)
		inner join si_empresa emp on vwpt.emprcodi = emp.emprcodi
		where hoja.formatcodi in ({0}) --AND EMPRESTADO = 'A' 
		order by emp.emprnomb asc
	</query>
  </Sql>
	
	
  <Sql>
    <key>GetEmpresasSEINFormato</key>
    <query>
		select  distinct emp.* from me_hojaptomed hoja inner join me_ptomedicion pto on hoja.ptomedicodi = pto.ptomedicodi 
		inner join SI_HISEMPPTO_DATA vwpt on vwpt.HPTDATFECHA &lt;= sysdate and (vwpt.PTOMEDICODI = pto.PTOMEDICODI OR vwpt.PTOMEDICODIOLD = pto.PTOMEDICODI)
		inner join si_empresa emp on vwpt.emprcodi = emp.emprcodi
		where hoja.formatcodi in ({0}) and emp.emprestado = 'A' and emp.emprcoes = 'S'
		order by emp.emprnomb asc
	</query>
  </Sql>
	

	<Sql>
		<key>GetEmpresasFormatoPorEstado</key>
		<query>
			select  distinct emp.* from me_hojaptomed hoja inner join me_ptomedicion pto on hoja.ptomedicodi = pto.ptomedicodi
			inner join SI_HISEMPPTO_DATA vwpt on vwpt.HPTDATFECHA &lt;= sysdate and (vwpt.PTOMEDICODI = pto.PTOMEDICODI OR vwpt.PTOMEDICODIOLD = pto.PTOMEDICODI)
			inner join si_empresa emp on vwpt.emprcodi = emp.emprcodi
			where hoja.formatcodi in ({0}) AND emp.EMPRESTADO = '{1}'
			order by emp.emprnomb asc
		</query>
	</Sql>

	<Sql>
		<key>GetEmpresasActivaFormato</key>
		<query>
			select  distinct emp.* from me_hojaptomed hoja inner join me_ptomedicion pto on hoja.ptomedicodi = pto.ptomedicodi and ptomediestado = 'A'
			inner join SI_HISEMPPTO_DATA vwpt on vwpt.HPTDATFECHA &lt;= sysdate and (vwpt.PTOMEDICODI = pto.PTOMEDICODI OR vwpt.PTOMEDICODIOLD = pto.PTOMEDICODI) and hptdatptoestado = 'I'
			inner join si_empresa emp on vwpt.emprcodi = emp.emprcodi and emprestado = 'A'
			where hoja.formatcodi in ({0}) and hptoactivo = 1 and emprestado = 'A' order by emp.emprnomb asc
		</query>
	</Sql>
  
  <Sql>
    <key>ObtenerNroRegistroBusqueda</key>
    <query>
      select
      count(*) as contador
      from si_empresa empresa inner join si_tipoempresa tipoempresa
      on empresa.tipoemprcodi = tipoempresa.tipoemprcodi
      where
      (upper(empresa.emprnomb) like upper('%{0}%') or upper(empresa.emprabrev) like upper('%{0}%') or '{0}' = '-1') and
      (empresa.emprruc like '{1}' or '{1}' = '-1') and
      (empresa.tipoemprcodi = {2} or {2} = -2) and
      (empresa.emprsein = '{3}' or '{3}' = '-1') and
      (empresa.emprestado = '{4}' or '{4}' = '-1') and
      (empresa.emprestado != 'E')
    </query>
  </Sql>

  <Sql>
    <key>BuscarEmpresas</key>
    <query>
      select * from (
      select
      empresa.emprcodi,
      empresa.emprnomb,
      empresa.tipoemprcodi,
      empresa.emprdire,
      empresa.emprtele,
      empresa.emprnumedocu,
      empresa.tipodocucodi,
      empresa.emprruc,
      empresa.emprabrev,
      empresa.emprorden,
      empresa.emprdom,
      empresa.emprsein,
      empresa.emprrazsocial,
      empresa.emprcoes,
      empresa.lastuser,
      empresa.lastdate,
      empresa.compcode,
      empresa.inddemanda,
      case empresa.emprestado when 'A' then 'Activo' when 'B' then 'Baja' when 'E' then 'Eliminado' else '' end as emprestado,
      tipoempresa.tipoemprdesc,
      empresa.EMPRCODOSINERGMIN,
      empresa.emprdomiciliada,
      empresa.emprambito,
      empresa.emprrubro,
      empresa.empragente,
      empresa.Emprusucreacion,
      empresa.Emprfeccreacion,
      empresa.Emprusumodificacion,
      empresa.Emprfecmodificacion,
      SCADACODI,
      (row_number() over (order by empresa.emprcodi desc)) as r
      from si_empresa empresa inner join si_tipoempresa tipoempresa
      on empresa.tipoemprcodi = tipoempresa.tipoemprcodi
      where
      (upper(empresa.emprnomb) like upper('%{0}%') or upper(empresa.emprabrev) like upper('%{0}%') or '{0}' = '-1') and
      (empresa.emprruc like '{1}' or '{1}' = '-1') and
      (empresa.tipoemprcodi = {2} or {2} = -2) and
      (empresa.emprsein = '{3}' or '{3}' = '-1') and
      (empresa.emprestado = '{4}' or '{4}' = '-1') and
      (empresa.emprestado != 'E')
      order by empresa.emprnomb asc
      )
      where (r >= ((({5}-1) * {6}) + 1) and r &lt; (({5} * {6}) + 1 )) or ({5} = -1 and {6} = -1)
    </query>
  </Sql>

  <Sql>
    <key>ExportarEmpresas</key>
    <query>
      select
      empresa.emprcodi,
      empresa.emprnomb,
      empresa.tipoemprcodi,
      empresa.emprdire,
      empresa.emprtele,
      empresa.emprnumedocu,
      empresa.tipodocucodi,
      empresa.emprruc,
      empresa.emprabrev,
      empresa.emprorden,
      empresa.emprdom,
      empresa.emprsein,
      empresa.emprrazsocial,
      empresa.emprcoes,
      empresa.lastuser,
      empresa.lastdate,
      empresa.compcode,
      empresa.inddemanda,
      case empresa.emprestado when 'A' then 'Activo' when 'B' then 'Baja' when 'E' then 'Eliminado' else '' end as emprestado,
      tipoempresa.tipoemprdesc,
      empresa.EMPRCODOSINERGMIN,
      empresa.emprdomiciliada,
      empresa.emprambito,
      empresa.emprrubro,
      empresa.empragente,
      empresa.SCADACODI,
      (row_number() over (order by empresa.emprcodi desc)) as r
      from si_empresa empresa inner join si_tipoempresa tipoempresa
      on empresa.tipoemprcodi = tipoempresa.tipoemprcodi
      where
      (upper(empresa.emprnomb) like upper('%{0}%') or upper(empresa.emprabrev) like upper('%{0}%') or '{0}' = '-1') and
      (empresa.emprruc like '{1}' or '{1}' = '-1') and
      (empresa.tipoemprcodi = {2} or {2} = -2) and
      (empresa.emprsein = '{3}' or '{3}' = '-1') and
      (empresa.emprestado = '{4}' or '{4}' = '-1') and
      (empresa.emprestado != 'E')
      order by empresa.emprnomb asc
    </query>
  </Sql>
  
  <Sql>
    <key>VerificarExistenciaNombre</key>
    <query>
      select count(*) as contador from si_empresa
      where upper(emprnomb) = upper(:emprnomb) and emprestado = 'A'
    </query>
  </Sql>

  <Sql>
    <key>VerificarExistenciaRuc</key>
    <query>
      select count(*) as contador from si_empresa
      where emprruc = :emprruc and emprestado = 'A'
    </query>
  </Sql>

  <Sql>
    <key>ObtenerEmpresaPorRuc</key>
    <query>
      select * from si_empresa
      where trim(emprruc) = '{0}' and emprestado = 'A'
    </query>
  </Sql>

  <Sql>
    <key>ListaEmpresasPorTipoCumplimiento</key>
    <query>
      SELECT emp.EMPRCODI ,
      emp.EMPRNOMB ,
      emp.EMPRRUC ,
      NVL(emp.EMPRRAZSOCIAL, ' - SIN RAZON SOCIAL - ') AS ETIQUETA
      FROM SI_EMPRESA emp
      WHERE emp.TIPOEMPRCODI IN (2, 4)
      AND emp.TIPOEMPRCODI    = {0} AND emp.EMPRRAZSOCIAL IS NOT NULL
      AND emp.EMPRESTADO = 'A'
      ORDER BY emp.EMPRRAZSOCIAL
    </query>
  </Sql>

  <Sql>
    <key>ListaEmailUsuariosEmpresas</key>
    <query>
      SELECT usua.EMPRCODI AS EMPRCODI,
      usua.EMPRNOMB AS EMPRNOMB,
      usua.USEREMAIL AS USEREMAIL
      FROM VW_FW_USUARIOS_X_MODDULO usua
      WHERE usua.MODCODI = {2}
      AND NOT EXISTS
      (SELECT 1
      FROM SI_CORREO mail
      WHERE mail.CORRFECHAPERIODO = '{0}'
      AND mail.EMPRCODI           = usua.EMPRCODI
      AND mail.CORRTO             = usua.USEREMAIL
      )
      AND NOT EXISTS
      (SELECT 1
      FROM ME_ENVIO envi
      WHERE TO_CHAR(ENVIOFECHAPERIODO, 'MM YYYY') = '{0}'
      AND envi.FORMATCODI                         = {1}
      AND envi.EMPRCODI                           = usua.EMPRCODI)
    </query>
  </Sql>
    
  <Sql>
    <key>ListaEmpresasSuministrador</key>
    <query>
      SELECT EMPRCODI,
      NVL(EMPRRAZSOCIAL,EMPRNOMB) AS EMPRNOMB
      FROM SI_EMPRESA
      WHERE TIPOEMPRCODI IN (2,3)
      AND EMPRESTADO      ='A'
      ORDER BY EMPRNOMB
    </query>
  </Sql>

  <Sql>
    <key>ActualizarRucFicticio</key>
    <query>
      update si_empresa
      set emprruc = :emprruc
      where emprcodi = :emprcodi
    </query>
  </Sql>

  <Sql>
    <key>ObtenerEmpresasPuntosMedicion</key>
    <query>
          select distinct emp.* from si_empresa emp
      where emp.emprcodi in (
      
      select distinct emprcodi from me_ptomedicion 
      union all
      select distinct eq.emprcodi from me_ptomedicion pto inner join eq_equipo eq on pto.equicodi = eq.equicodi
      )
    </query>
  </Sql>
  
  <Sql>
    <key>GetByCodOsinergmin</key>
    <query>
      SELECT EMPRCODI, EMPRCODOSINERGMIN, EMPRNOMB, EMPRRAZSOCIAL FROM SI_EMPRESA WHERE EMPRCODOSINERGMIN = '{0}' AND EMPRESTADO = 'A'
    </query>
  </Sql>
  <!--JDEL [19/10/2016] - ALPHA - INICIO-->
  <Sql>
    <key>ObtenerEmpresaOsinergmin</key>
    <query>
      SELECT EMPRCODI,
      EMPRNOMB
      FROM SI_EMPRESA WHERE TRIM(EMPRCODOSINERGMIN) = TRIM({0})
    </query>
  </Sql>
  <!--JDEL [19/10/2016] - ALPHA - FIN-->

  <!--alpha.HDT - Inicio 26/10/2016: Se agregó la columna emprcodosinergmin.-->
  <Sql>
    <key>GetByIdOsinergmin</key>
    <query>
      select
      emprcodi,
      emprnomb,
      tipoemprcodi,
      emprdire,
      emprtele,
      emprnumedocu,
      tipodocucodi,
      emprruc,
      emprabrev,
      emprorden,
      emprdom,
      emprsein,
      emprrazsocial,
      emprcoes,
      lastuser,
      lastdate,
      compcode,
      inddemanda,
      emprestado,
      emprcodosinergmin,
      emprdomiciliada,
      emprambito,
      emprrubro,
      empragente,
      SCADACODI
      from
      si_empresa
      where
      emprcodi = :emprcodi
    </query>
  </Sql>
  <!--alpha.HDT - Inicio 31/10/2016: Se agregó la columna emprcodosinergmin.-->
  <Sql>
    <key>UpdateOsinergmin</key>
    <query>
      update si_empresa
      set
      emprnomb = :emprnomb,
      tipoemprcodi = :tipoemprcodi,
      emprdire = :emprdire,
      emprtele = :emprtele,
      emprnumedocu = :emprnumedocu,
      tipodocucodi = :tipodocucodi,
      emprruc = :emprruc,
      emprabrev = :emprabrev,
      emprorden = :emprorden,
      emprdom = :emprdom,
      emprsein = :emprsein,
      emprrazsocial = :emprrazsocial,
      emprcoes = :emprcoes,
      lastuser = :lastuser,
      lastdate = :lastdate,
      inddemanda = :inddemanda,
      emprestado = :emprestado,
      emprcodosinergmin = :emprcodosinergmin
      where
      emprcodi = :emprcodi
    </query>
  </Sql>

  <Sql>
    <key>ListaEmpresasXTipoEmpresa</key>
    <query>
      select
      emprcodi,
      emprnomb,
      tipoemprcodi,
      emprdire,
      emprtele,
      emprnumedocu,
      tipodocucodi,
      emprruc,
      emprabrev,
      emprorden,
      emprdom,
      emprsein,
      emprrazsocial,
      emprcoes,
      lastuser,
      lastdate,
      compcode,
      inddemanda,
      emprestado,
      emprcodosinergmin,
      SCADACODI
      from
      si_empresa
      where
      tipoemprcodi in ({0}
      and emprsein = 'S'
      order by 2 asc
    </query>
  </Sql>

  <Sql>
    <key>ListarEmpresasxTipoEquipos</key>
    <query>
      select distinct emp.emprcodi, emp.emprnomb,emp.emprrazsocial, emp.emprorden, emp.emprabrev,
      Temp.Tipoemprcodi, Temp.Tipoemprdesc
      from eq_equipo eq
      inner join Si_Hisempeq_Data vweq on vweq.equicodi = eq.equicodi
      inner join si_empresa emp on vweq.emprcodi = emp.emprcodi
      inner join si_tipoempresa temp on Temp.Tipoemprcodi = emp.tipoemprcodi
      where ('{0}'='-1' or eq.famcodi in ({0}) )
      and ('{1}'='-1' or Temp.Tipoemprcodi in ({1}) ) -- and emp.emprestado = 'A'
      and (eq.equiestado = '{2}' or '{2}'='-1')
      order by emp.emprnomb
    </query>
  </Sql>
  
  <!--alpha.JDEL - Inicio 19/12/2016: Se obtendra el emprcodi desde el codigo de osinergmin.-->
  <Sql>
    <key>ListMaestroEmpresa</key>
    <query>
      SELECT emp.EMPRCODI
      , emp.EMPRRAZSOCIAL
      , emp.EMPRCODOSINERGMIN
      , tie.TIPOEMPRDESC
      FROM SI_EMPRESA emp
      INNER JOIN SI_TIPOEMPRESA tie ON (emp.TIPOEMPRCODI = tie.TIPOEMPRCODI)
      WHERE emp.TIPOEMPRCODI IN (1,2, 3)
      AND emp.EMPRESTADO = 'A' {0}
      ORDER BY emp.TIPOEMPRCODI, emp.EMPRRAZSOCIAL
    </query>
  </Sql>

  <Sql>
    <key>ObtenerEmpresasGeneracion</key>
    <query>
      select emprcodi, emprnomb from si_empresa where emprsein = 'S' and emprcodi > 0
      and emprcodi in
      (
      select emprcodi from eq_equipo where famcodi = 4
      )
      order by emprnomb asc
    </query>
  </Sql>
    <!-- Inicio de Agregado - Sistema de Compensaciones -->
  <Sql>
    <key>ListaEmpresasCompensacion</key>
    <query>
      SELECT EMPRCODI,EMPRNOMB FROM SI_EMPRESA WHERE TIPOEMPRCODI=3 AND EMPRESTADO='A' ORDER BY EMPRNOMB
    </query>
  </Sql>
  
  <!--Fin de Agregado - Sistema deCompensaciones -->
<Sql>
    <key>ListaEmpresasSeleccionadas</key>
    <query>
      select
      emprcodi,
      emprnomb,
      tipoemprcodi,
      emprdire,
      emprtele,
      emprnumedocu,
      tipodocucodi,
      emprruc,
      emprabrev,
      emprorden,
      emprdom,
      emprsein,
      emprrazsocial,
      emprcoes,
      lastuser,
      lastdate,
      compcode,
      inddemanda,
      emprestado,
      emprcodosinergmin,
      emprdomiciliada,
      emprambito,
      emprrubro,
      empragente,
      SCADACODI
      from
      si_empresa
      where
      emprcodi not in(0,-1) and
      upper(emprsein) = decode('{0}','-1',upper(emprsein),upper('{0}')) and
      upper(emprcoes) = decode('{1}','-1',upper(emprcoes),upper('{1}')) and
      upper(emprambito) = decode('{2}','-1',upper(emprambito),upper('{2}')) and
      upper(emprdomiciliada) = decode('{3}','-1',upper(emprdomiciliada),upper('{3}')) and
      emprrubro = decode({4},0,emprrubro,{4}) and
      upper(empragente) = decode('{5}','-1',upper(empragente),upper('{5}')) and
      TIPOEMPRCODI = decode({6},0,TIPOEMPRCODI,{6})
      order by 2 asc
    </query>
  </Sql>
  <!-- alpha.HDT - 14/07/2017: Cambio para atender el requerimiento -->
  <Sql>
    <key>GetByRuc</key>
    <query>
      select
      emprcodi,
      emprnomb,
      tipoemprcodi,
      emprdire,
      emprtele,
      emprnumedocu,
      tipodocucodi,
      emprruc,
      emprabrev,
      emprorden,
      emprdom,
      emprsein,
      emprrazsocial,
      emprcoes,
      lastuser,
      lastdate,
      compcode,
      inddemanda,
      emprestado,
      emprcodosinergmin,
      emprdomiciliada,
      emprambito,
      emprrubro,
      empragente,
      SCADACODI
      from
      si_empresa
      where
      tipoemprcodi in (3, 4)
      and emprruc = '{0}'
      order by 2 asc
    </query>
  </Sql>

  <!--INICIO PR5-->
  <Sql>
    <key>ListarEmpresasXID</key>
    <query>
      select
      empr.*
      from
      si_empresa empr
      where
      empr.emprcodi in ({0})
    </query>
  </Sql>
  <!--FIN PR5-->

	<!--INICIO INDISPONIBILIDADES-->
	<Sql>
		<key>GetEmpresasConCentralTermoxUsuario</key>
		<query>
			SELECT EM.emprcodi,EM.EMPRNOMB
			FROM si_empresa EM
			LEFT JOIN EQ_EQUIPO EQ ON(EM.EMPRCODI = EQ.EMPRCODI)
			LEFT JOIN FW_USER_X_EMPRESA UE ON (UE.emprcodi = EM.emprcodi)
			LEFT JOIN fw_user us ON us.usercode = ue.usercode
			WHERE EQ.FAMCODI = 5 AND us.userlogin = '{0}' AND EQ.EQUIESTADO = 'A'
			GROUP BY (EM.emprcodi,EM.EMPRNOMB)
		</query>
	</Sql>

	<Sql>
		<key>GetEmpresasConCentralTermo</key>
		<query>
			SELECT EM.emprcodi,EM.EMPRNOMB
			FROM si_empresa EM
			LEFT JOIN EQ_EQUIPO EQ ON(EM.EMPRCODI = EQ.EMPRCODI)
			LEFT JOIN FW_USER_X_EMPRESA UE ON (UE.emprcodi = EM.emprcodi)
			WHERE EQ.FAMCODI = 5 AND EQ.EQUIESTADO = 'A'
			GROUP BY (EM.emprcodi,EM.EMPRNOMB)
		</query>
	</Sql>
	<!--DIN INDISPONBILIDADES-->

	<!-- Inicio de Agregado - Rechazo Carga -->
	<Sql>
		<key>ListaEmpresasRechazoCarga</key>
		<query>
			SELECT EMPRCODI, NVL(EMPRRAZSOCIAL,EMPRNOMB) AS EMPRRAZSOCIAL
			FROM SI_EMPRESA WHERE TIPOEMPRCODI = :TIPOEMPRCODI AND EMPRESTADO = :EMPRESTADO {0} ORDER BY NVL(EMPRRAZSOCIAL,EMPRNOMB)
		</query>
	</Sql>

	<!--Fin de Agregado - Sistema deCompensaciones -->

  <Sql>
    <key>ObtenerEmpresaPorTipo</key>
    <query>
      select empresa.emprcodi, empresa.emprnomb
      from  si_empresa empresa
      where empresa.emprcoes = 'S'
      and  (empresa.tipoemprcodi in ({0}) or '{0}' = '-1' )
      order by empresa.emprnomb asc
    </query>
  </Sql>

  <Sql>
    <key>ObtenerEmpresaPorTipoSEIN</key>
    <query>
      select empresa.emprcodi, empresa.emprnomb
      from  si_empresa empresa
      where empresa.emprsein = 'S'
      and  (empresa.tipoemprcodi in ({0}) or '{0}' = '-1' )
      order by empresa.emprnomb asc
    </query>
  </Sql>

<!--Region Transferencia de Equipos-->

<Sql>
  <key>GetEmpresasActivaBajas</key>
  <query>
    select
    emprcodi,
    emprnomb,
    tipoemprcodi,
    emprdire,
    emprtele,
    emprnumedocu,
    tipodocucodi,
    emprruc,
    emprabrev,
    emprorden,
    emprdom,
    emprsein,
    emprrazsocial,
    emprcoes,
    lastuser,
    lastdate,
    compcode,
    inddemanda,
    emprestado,
    emprcodosinergmin,
    emprdomiciliada,
    emprambito,
    emprrubro,
    empragente,
    SCADACODI
    from
    si_empresa
    where emprcodi not in (0,1,-1)
    and emprestado !='E'
    order by 2 asc
  </query>
</Sql>


  <Sql>
    <key>GetIdNameEmpresasActivaBajas</key>
    <query>
      select
      A.emprcodi,
      A.emprruc,
      A.Emprnomb,
      a.EMPRCODOSINERGMIN,
      trim(A.emprcodi)||' - '||A.emprnomb||'' AS EmprnombAnidado
      from
      si_empresa A
      where
      A.emprcodi not in (0, 1,-1)
      and A.emprestado !='E' and a.EMPRSEIN = 'S'
      order by A.EMPRNOMB asc
    </query>
  </Sql>

  <Sql>
    <key>ListarEmpresaEstadoActual</key>
    <query>
      select emp.emprcodi,emp.emprnomb, upper(trim(dat.EMPDATVALOR)) as EMPRESTADO, dat.EMPDATFECHA as EMPRESTADOFECHA
      from SI_EMPRESADAT dat
      inner join (
      select datmax.emprcodi, max(datmax.EMPDATFECHA) EMPDATFECHA
      from SI_EMPRESADAT datmax
      where datmax.consiscodi = 1 and datmax.EMPDATFECHA &lt;= to_date('{0}', 'YYYY-MM-DD')  group by datmax.emprcodi
      ) maxempr on maxempr.emprcodi = dat.emprcodi and maxempr.EMPDATFECHA = dat.EMPDATFECHA and dat.CONSISCODI = 1
      inner join si_empresa emp on emp.emprcodi = dat.emprcodi
      order by emp.emprnomb
    </query>
  </Sql>
  
  
  <!--FIN Transferencia de Equipos-->

  <!--INICIO MigracionSGOCOES-GrupoB-->

  <Sql>
    <key>ListarEmpresasxCategoria</key>
    <query>
      select distinct emp.emprcodi, emp.emprnomb
      from si_empresa emp
      inner join pr_grupo pr on pr.emprcodi = emp.emprcodi
      where pr.catecodi in ({0}) order by emp.emprnomb
    </query>
  </Sql>

  <!--FIN MigracionSGOCOES-GrupoB-->

  <!--INICIO INTERVENCIONES-->

  <Sql>
    <key>ListarComboEmpresasConsulta</key>
    <query>
      SELECT emp.EMPRCODI, emp.EMPRNOMB, emp.emprestado, emp.EMPRABREV
      FROM SI_EMPRESA emp
      INNER JOIN(
		    SELECT DISTINCT vweq.emprcodi
		    FROM EQ_EQUIPO eq
		    INNER JOIN SI_HISEMPEQ_DATA vweq on vweq.equicodi = eq.equicodi
		    INNER JOIN EQ_FAMILIA fam on fam.famcodi = eq.famcodi
		    and fam.tareacodi in (1,2,3,4,10,11,6)
		    ORDER BY 1
      )eq ON emp.EMPRCODI = EQ.EMPRCODI
      WHERE EMP.EMPRSEIN = 'S'
      ORDER BY EMPRNOMB ASC
    </query>
  </Sql>

  <Sql>
    <key>ActualizarAbreviatura</key>
    <query>
      update si_empresa
      set emprabrev = :emprabrev
      where emprcodi = :emprcodi
    </query>
  </Sql>

  <!--FIN INTERVENCIONES-->

  <!--INICIO MonitoreoMME-->
  <Sql>
    <key>ListarEmpresaIntegranteMonitoreoMME</key>
    <query>
      select emp.emprcodi, emp.emprnomb, emp.EMPRRAZSOCIAL from 
      (
          --Empresas Vigentes en un periodo determinado
          select  emprcodi,emprnomb, EMPRRAZSOCIAL from
          (
              select  emprcodi,emprnomb, EMPRRAZSOCIAL, empdatvalor from
              (
              select emp.emprcodi,emp.emprnomb, emp.EMPRRAZSOCIAL, edat.EMPDATFECHA, empdatvalor, ROW_NUMBER() OVER(PARTITION BY edat.emprcodi  ORDER BY edat.emprcodi, edat.EMPDATFECHA DESC) AS NUM
              from si_empresadat edat
              inner join si_empresa emp on emp.emprcodi = edat.EMPRCODI
              where edat.CONSISCODI = 1 and edat.EMPDATDELETED = 0 and edat.EMPDATFECHA &lt;= to_date('{0}', 'YYYY-MM-DD')
              order by emp.emprnomb
              ) where num = 1 and EMPDATVALOR = 'A'

              UNION ALL

              select  emprcodi,emprnomb, EMPRRAZSOCIAL, empdatvalor from
              (
              select emp.emprcodi,emp.emprnomb, emp.EMPRRAZSOCIAL, edat.EMPDATFECHA, empdatvalor
              from si_empresadat edat
              inner join si_empresa emp on emp.emprcodi = edat.EMPRCODI
              where edat.CONSISCODI = 1 and edat.EMPDATDELETED = 0 and edat.EMPDATFECHA > to_date('{0}', 'YYYY-MM-DD') AND edat.EMPDATFECHA &lt;= to_date('{1}', 'YYYY-MM-DD')
              order by emp.emprnomb
              ) WHERE EMPDATVALOR = 'A'
          )
          group by  emprcodi,emprnomb, EMPRRAZSOCIAL
      )emp
      where emp.emprcodi in 
      (      
          --Empresas que tienen Grupos Integrantes
          select emprcodi from
          (
              select grupo_intg.*,grupo_act.emprcodi from(
                  select grupo.grupocodi,gruponomb,grupo.grupointegrante from 
                  (
                        --grupos despacho Integrantes o No Integrantes
                        select GRUPOCODI,gruponomb,GRUPOINTEGRANTE,  ROW_NUMBER() OVER(PARTITION BY GRUPOCODI  ORDER BY GRUPOCODI, FECHADAT DESC) AS NUM
                        from 
                        (
                            SELECT p1.GRUPOCODI,pr.gruponomb, p1.formuladat GRUPOINTEGRANTE, p1.FECHADAT
                            FROM PR_GRUPODAT p1
                            inner join pr_grupo pr on  p1.grupocodi = pr.grupocodi
                            WHERE p1.concepcodi = 258 and p1.formuladat in ('N','S')  --Operacion COES
            
                            UNION ALL
                        
                            select gr.grupocodi, gr.gruponomb,gr.GRUPOINTEGRANTE,  to_date('1900-01-01','YYYY-MM-DD')  FECHADAT
                            from eq_equipo eq
                            inner join pr_grupo gr on gr.grupocodi = eq.grupocodi
                            where eq.famcodi in (4,5, 37, 39)  and eq.equiestado in ('A','B','P')
                            and gr.grupocodi > 0 --and gr.grupoactivo = 'S'  --and gr.GRUPOINTEGRANTE = 'S' --and emp.EMPRCOES = 'S'            
                        )where FECHADAT &lt;= to_date('{1}','YYYY-MM-DD')
                  )grupo 
                  where grupo.num= 1 and grupointegrante = 'S'
                  --order by emp.emprnomb, grupo.gruponomb desc
              )grupo_intg
              inner join(
                  --Grupos activos hasta de la Fecha de Inicio
                  SELECT * FROM
                  (     
                          SELECT gru.grupocodi, emp.emprcodi,
                          vwgr.HGRDATFECHA, vwgr.HGRDATESTADO, ROW_NUMBER() OVER(PARTITION BY gru.GRUPOCODI,emp.emprcodi ORDER BY gru.GRUPOCODI,emp.emprcodi,vwgr.HGRDATFECHA desc, vwgr.Hgrdatestado desc) AS NUM_VIEW
                          FROM PR_GRUPO gru
                          inner join SI_HISEMPGRUPO_DATA vwgr on vwgr.HGRDATFECHA &lt; to_date('{0}','YYYY-MM-DD') and (vwgr.GRUPOCODI = gru.GRUPOCODI)
                          INNER JOIN SI_EMPRESA emp ON emp.emprcodi = vwgr.emprcodi
                          WHERE gru.CATECODI IN (2,3,4,5,6,9,15,16,17,18)
                  )rview 
                  WHERE NUM_VIEW = 1 and HGRDATESTADO = 'I'

                  UNION ALL

                  --Grupos activos despues de la Fecha de Inicio
                  SELECT * FROM
                  (     
                          SELECT gru.grupocodi, emp.emprcodi,
                          vwgr.HGRDATFECHA, vwgr.HGRDATESTADO, ROW_NUMBER() OVER(PARTITION BY gru.GRUPOCODI,emp.emprcodi ORDER BY gru.GRUPOCODI,emp.emprcodi,vwgr.HGRDATFECHA desc, vwgr.Hgrdatestado desc) AS NUM_VIEW
                          FROM PR_GRUPO gru
                          inner join SI_HISEMPGRUPO_DATA vwgr on vwgr.HGRDATFECHA >= to_date('{0}','YYYY-MM-DD') and vwgr.HGRDATFECHA &lt;= to_date('{1}','YYYY-MM-DD') and (vwgr.GRUPOCODI = gru.GRUPOCODI)
                          INNER JOIN SI_EMPRESA emp ON emp.emprcodi = vwgr.emprcodi
                          WHERE gru.CATECODI IN (2,3,4,5,6,9,15,16,17,18)
                  )rview 
                  WHERE NUM_VIEW = 1 and HGRDATESTADO = 'I'
              )grupo_act on grupo_act.grupocodi = grupo_intg.grupocodi
          )
          group by emprcodi
      )
    </query>
  </Sql>
  <!--FIN MonitoreoMME-->

  <!--INICIO FIT- SEÑALES NO DISPONIBLES - ASOCIACION EMPRESAS-->
  <Sql>
    <key>UpdateAsociacionEmpresa</key>
    <query>
      update si_empresa
      set
      SCADACODI = :SCADACODI
      where
      emprcodi = :emprcodi
    </query>
  </Sql>


  <Sql>
    <key>EliminarAsociocionesEmpresa</key>
    <query>
      update si_empresa
      set
      SCADACODI = NULL
      where
      emprcodi = :emprcodi
    </query>
  </Sql>
  <!--FIN FIT- SEÑALES NO DISPONIBLES - ASOCIACION EMPRESAS-->

  <!--INICIO Titularidad-Instalaciones-Empresas-->
	<Sql>
		<key>ListarEmpresaVigenteByRango</key>
		<query>			
        --Empresas Vigentes en un periodo determinado
        select  emprcodi,emprnomb, EMPRRAZSOCIAL from
        (
            select  emprcodi,emprnomb, EMPRRAZSOCIAL, empdatvalor from
            (
            select emp.emprcodi,emp.emprnomb, emp.EMPRRAZSOCIAL, edat.EMPDATFECHA, empdatvalor, ROW_NUMBER() OVER(PARTITION BY edat.emprcodi  ORDER BY edat.emprcodi, edat.EMPDATFECHA DESC) AS NUM
            from si_empresadat edat
            inner join si_empresa emp on emp.emprcodi = edat.EMPRCODI
            where edat.CONSISCODI = 1 and edat.EMPDATDELETED = 0 and edat.EMPDATFECHA &lt;= to_date('{0}', 'YYYY-MM-DD')
            order by emp.emprnomb
            ) where num = 1 and EMPDATVALOR = 'A'

            UNION ALL

            select  emprcodi,emprnomb, EMPRRAZSOCIAL, empdatvalor from
            (
            select emp.emprcodi,emp.emprnomb, emp.EMPRRAZSOCIAL, edat.EMPDATFECHA, empdatvalor
            from si_empresadat edat
            inner join si_empresa emp on emp.emprcodi = edat.EMPRCODI
            where edat.CONSISCODI = 1 and edat.EMPDATDELETED = 0 and edat.EMPDATFECHA > to_date('{0}', 'YYYY-MM-DD') AND edat.EMPDATFECHA &lt;= to_date('{1}', 'YYYY-MM-DD')
            order by emp.emprnomb
            ) WHERE EMPDATVALOR = 'A'
        )
        group by  emprcodi,emprnomb, EMPRRAZSOCIAL
				order by emprnomb
		</query>
	</Sql>
	<!--FIN Titularidad-Instalaciones-Empresas-->

  <!--INICIO Mejoras IEOD-->
  <Sql>
    <key>ListarEmpresaPorOrigenPtoMedicion</key>
    <query>
      Select distinct emp.emprcodi , emp.emprnomb ,emp.scadacodi, emp.tipoemprcodi
      from si_empresa emp
      inner join me_ptomedicion pto on pto.emprcodi = emp.emprcodi
      where pto.ptomediestado ='A' and pto.origlectcodi = {0}
      order by emp.emprnomb
    </query>
  </Sql>
  
  <Sql>
    <key>ListarEmpresaScada</key>
    <query>
      select emp.emprcodi , emp.emprnomb ,emp.scadacodi, emp.tipoemprcodi
      from si_empresa emp
      where emp.scadacodi is not null
      and emp.emprestado = 'A'
      order by emprnomb
    </query>
  </Sql>
  
  <!--FIN Mejoras IEOD-->

  <!--INICIO FIT - VALORIZACIONES DIARIAS -->
  <Sql>
    <key>ListarEmpresasPorIDs</key>
    <query>
      select
      emprcodi,
      emprnomb,
      tipoemprcodi,
      emprdire,
      emprtele,
      emprnumedocu,
      tipodocucodi,
      emprruc,
      emprabrev,
      emprorden,
      emprdom,
      emprsein,
      emprrazsocial,
      emprcoes,
      lastuser,
      lastdate,
      compcode,
      inddemanda,
      emprestado,
      emprcodosinergmin,
      emprdomiciliada,
      emprambito,
      emprrubro,
      empragente,
      scadacodi
      from
      si_empresa
      where
      emprcodi in ({0}) or '{0}' = '-1'
      order by emprcodi asc
    </query>
  </Sql>

  <Sql>
    <key>ObtenerProveedores</key>
    <query>
		select emp.* from si_empresa emp
		where (emp.emprcoes = 'S' and emp.emprestado = 'A' and emp.emprestregint = 'A' and emp.emprcodi > 1 and  {0} = 2) or (
		emprindproveedor = 'S' and emp.emprestado = 'A' and {0} = 1
		) or
		(
		((emp.emprcoes = 'S' and emp.emprestado = 'A' and emp.emprestregint = 'A' and emp.emprcodi > 1) or  (emprindproveedor = 'S' and emp.emprestado = 'A')) and {0} = 0
		)
		order by emprnomb asc
	</query>
  </Sql>

  <Sql>
    <key>ObtenerEmpresasPortalTramite</key>
    <query>
      select * from (
      select
      emp.*, tipo.tipoemprdesc,
      (row_number() over (order by emp.emprcodi desc)) as r
      from si_empresa emp inner join si_tipoempresa tipo on emp.tipoemprcodi = tipo.tipoemprcodi
      where emp.emprestado = 'A' and (emp.tipoemprcodi = {1} or {1} = 0) and (emp.emprindusutramite = '{2}' or '{2}' = '-1')
      and ( ( '{0}' = 'S' and emp.emprcoes = '{0}' and emp.emprestregint = 'A') or ('{0}' = 'N' and emp.emprcoes = '{0}' and  emp.emprruc is not null and emp.emprrazsocial is not null)) and
      (emp.emprruc like '%{3}%' or '{3}' = '-1') and (lower(emp.emprnomb) like lower('%{4}%') or lower(emp.emprrazsocial) like lower('%{4}%') or '{4}' = '-1')
      order by emp.emprnomb)

      where (r >= ((({5}-1) * {6}) + 1) and r &lt; (({5} * {6}) + 1 )) or ({5} = -1 and {6} = -1)

    </query>
  </Sql>

  <Sql>
    <key>ObtenerNroRegistrosBusquedaTramite</key>
    <query>
      select count(*)
      from si_empresa emp inner join si_tipoempresa tipo on emp.tipoemprcodi = tipo.tipoemprcodi
      where emp.emprestado = 'A' and (emp.tipoemprcodi = {1} or {1} = 0) and (emp.emprindusutramite = '{2}' or '{2}' = '-1')
      and ( ( '{0}' = 'S' and emp.emprcoes = '{0}' and emp.emprestregint = 'A') or ('{0}' = 'N' and emp.emprcoes = '{0}' and  emp.emprruc is not null and emp.emprrazsocial is not null))
      and (emp.emprruc like '%{3}%' or '{3}' = '-1') and (lower(emp.emprnomb) like lower('%{4}%') or lower(emp.emprrazsocial) like lower('%{4}%') or '{4}' = '-1')
    </query>
  </Sql>

  <Sql>
    <key>ActualizarDatosUsuarioTramite</key>
    <query>
      update si_empresa set
      emprindusutramite = :emprindusutramite,
      emprfecusutramite = :emprfecusutramite
      where emprcodi = :emprcodi
    </query>
  </Sql>
  
  <!-- INICIO Aplicativo Extranet CTAF-->ss

  <Sql>
    <key>ListarEmpresasEventoCTAF</key>
    <query>
      SELECT emp.EMPRCODI, emp.EMPRNOMB, emp.TIPOEMPRCODI
      FROM SI_EMPRESA emp
      WHERE EMP.EMPRSEIN = 'S' AND emp.tipoemprcodi in(1,2,3,4) and emp.EMPRESTADO = 'A'
      UNION
      SELECT emp.emprcodi,emp.emprnomb, tip.tipoemprcodi 
      FROM si_empresa  emp
      inner join si_tipo_comportamiento tip on emp.emprcodi=tip.emprcodi
      where EMP.EMPRSEIN = 'S' AND tip.tipoemprcodi in(1,2,3,4) and emp.EMPRESTADO = 'A'
      ORDER BY EMPRNOMB
    </query>
  </Sql>

  <!-- FIN Aplicativo Extranet CTAF-->
  <Sql>
    <key>ListarEmpresasCentralesActivas</key>
    <query>
      select * from si_empresa e where e.emprcodi in (select distinct eq.emprcodi from eq_equipo eq where eq.famcodi in (4,5,37,39 ) and eq.equiestado='A') and  e.emprsein = 'S'
    </query>
  </Sql>


	<Sql>
		<key>EmpresaMigracion</key>
		<query>
			select m.emprcodi from si_migraemprorigen o
			inner join si_migracion m on m.migracodi = o.migracodi
            where o.emprcodi = {0}
		</query>
	</Sql>

  <!-- INICIO FICHA TÉCNICA-->
  <Sql>
    <key>ListarEmpresasFT</key>
    <query>
      select
      e.emprcodi,
      e.emprnomb,
      e.EMPRRAZSOCIAL,
      te.TIPOEMPRDESC
      from
      si_empresa e
      inner join si_tipoempresa te on te.tipoemprcodi = nvl(e.tipoemprcodi, -1)
      where
      emprcodi not in(0,-1) and emprestado = 'A'
      order by 2 asc
    </query>
  </Sql>
  <!-- FIN FICHA TÉCNICA-->

	<Sql>
		<key>BuscarEmpresasMME</key>
		<query>

			select distinct
			mme.emprmmecodi,
			emp.emprcodi,
			emp.EMPRRAZSOCIAL as emprnomb,
			emp.tipoemprcodi,
			tipo.tipoemprdesc,
			emp.emprruc,
			case emp.emprestado when 'A' then 'Activo' when 'B' then 'Baja' when 'E' then 'Eliminado' else '' end as emprestado,
			mme.emprfecparticipacion,
			mme.emprfecretiro,
			mme.emprcomentario,
			mme.emprusucreacion,
			mme.emprfeccreacion,
			mme.emprusumodificacion,
			mme.emprfecmodificacion
			from si_empresa_mme mme
			inner join si_empresa emp on mme.emprcodi = emp.emprcodi
			inner join si_tipoempresa tipo on mme.tipoemprcodi = tipo.tipoemprcodi
			where EMPRMMEESTADO = 1 and mme.TIPOEMPRCODI = {0}
			order by emp.EMPRRAZSOCIAL asc
		</query>
	</Sql>
	
	<Sql>
		<key>GetByIdMME</key>
		<query>
			select
			mme.emprmmecodi,
			mme.emprcodi,
			emp.EMPRRAZSOCIAL as emprnomb,
			emp.emprruc,
			mme.tipoemprcodi,
			temp.Tipoemprdesc,
			emp.emprestado,
			mme.emprfecparticipacion,
			mme.emprfecretiro,
			mme.emprcomentario,
			mme.emprmmeestado,
			mme.emprusucreacion,
			mme.emprfeccreacion,
			mme.emprusumodificacion,
			mme.emprfecmodificacion
			from si_empresa_mme mme
			inner join si_empresa emp on emp.emprcodi = mme.emprcodi
			inner join SI_TIPOEMPRESA temp on temp.TIPOEMPRCODI = mme.TIPOEMPRCODI
			where mme.emprcodi = :emprmmecodi
			and mme.emprmmeestado = 1
		</query>
	</Sql>

	<Sql>
		<key>GetMaxIdMME</key>
		<query>
			select nvl(max(emprmmecodi), 0) + 1 from si_empresa_mme
		</query>
	</Sql>

	<Sql>
		<key>SaveMME</key>
		<query>
			insert into si_empresa_mme(
			emprmmecodi,
			emprcodi,
			TIPOEMPRCODI,
			EMPRFECPARTICIPACION,
			EMPRFECRETIRO,
			EMPRCOMENTARIO,
			EMPRUSUCREACION,
			EMPRFECCREACION,
			EMPRMMEESTADO
			)
			values(
			:emprmmecodi,
			:emprcodi,
			:tipoemprcodi,
			:emprfecparticipacion,
			:emprfecretiro,
			:emprcomentario,
			:emprusucreacion,
			sysdate,
			1
			)
		</query>
	</Sql>

	<Sql>
		<key>UpdateMME</key>
		<query>
			update si_empresa_mme
			set
			emprusumodificacion = :emprusumodificacion,
			emprfecmodificacion = :emprfecmodificacion,
			EMPRMMEESTADO = 0
			where
			emprmmecodi = :emprmmecodi and
			emprcodi = :emprcodi
		</query>
	</Sql>
	
    <Sql>
		<key>BuscarHistorialEmpresasMME</key>
		<query>
			 select 
            emprfecparticipacion,
            emprfecretiro,
            emprcomentario,
            emprmmeestado,
            emprusucreacion,
            emprfeccreacion,
            emprusumodificacion,
            emprfecmodificacion
            from si_empresa_mme
            where emprcodi = {0}
            order by emprfeccreacion desc
		</query>
	</Sql>

	<Sql>
		<key>BuscarEmpresasporParticipante</key>
		<query>
			select distinct
			emp.emprrazsocial as emprnomb,
			emp.emprcodi
			from si_empresa emp
			inner join si_tipo_comportamiento comp on emp.emprcodi = comp.emprcodi
			inner join si_tipoempresa tipo on comp.tipoemprcodi = tipo.tipoemprcodi
			where
			(emprcoes = 'S' and emprestado = 'A' and emprestregint = 'A' and (tipo.tipoemprcodi = 3 and comp.tipoprincipal = 'S' or emp.emprcodi in (13,67)) and {0} = 3) or
			(emprcoes = 'S' and emprestado = 'A' and emprestregint = 'A' and (tipo.tipoemprcodi = 2 and comp.tipoprincipal = 'S' or emp.emprcodi in (12099)) and {0} = 2) or
			(emprcoes = 'S' and emprestado = 'A' and emprestregint = 'A' and (tipo.tipoemprcodi = 4 and comp.tipoprincipal = 'S' or emp.emprcodi in (67)) and {0} = 4)
			order by 1 asc
		</query>
	</Sql>

  <Sql>
    <key>ListarPorTipo</key>
    <query>
      select
      emprcodi, emprnomb
      from
      si_empresa
      where
      emprestado = 'A' and emprcodi not in(0,-1) and
      ('-2' = '{0}' or tipoemprcodi = {0}) order by 2 asc
    </query>
  </Sql>
  
  <!--Ficha Técnica inicio-->
  <Sql>
    <key>ListaEmpresasByTipo</key>
    <query>
      select
      emprcodi,
      emprnomb || ' - ' || emprestado emprnomb
      from si_empresa
      where tipoemprcodi in ({0}) and emprestado in ('A', 'B', 'E')
      order by emprnomb
    </query>
  </Sql>

  <Sql>
    <key>ListarEmpresaExtranetFT</key>
    <query>
      select
      emprcodi,
      emprnomb
      from si_empresa
      where emprcodi in
      (
      select distinct emprcodi from FT_EXT_ENVIO
      union
      select distinct emprcodi from FT_EXT_RELEMPETAPA
      UNION
      select distinct emprcodi from FT_EXT_PROYECTO
      )
      order by emprnomb
    </query>
  </Sql>
  <!--Ficha Técnica fin-->
  
  <!-- Inicio CPPA.ASSETEC.2024-->
  <Sql>
    <key>ListaEmpresasCPPA</key>
    <query>
      SELECT
      EMPRCODI,
      '[' || EMPRCODI || '] ' || TRIM(EMPRNOMB) ||
      CASE
      WHEN EMPRESTADO = 'B' THEN ' [' || 'BAJA' || ']'
      ELSE ''
      END AS EMPRNOMBCONCATENADO
      FROM
      SI_EMPRESA
      WHERE
      TIPOEMPRCODI IN (1, 2, 3, 4) and EMPRESTADO IN ('A','B')
      ORDER BY TRIM(EMPRNOMB)
    </query>
  </Sql>

  <Sql>
    <key>ListaEmpresasDescargaIntegrantes</key>
    <query>
      SELECT
      EMPRCODI,
      EMPRNOMB
      FROM SI_EMPRESA WHERE TIPOEMPRCODI = 3 or EMPRCODI = 11772 or EMPRCODI = 13 or EMPRCODI = 67
      ORDER BY EMPRNOMB
    </query>
  </Sql>
  <!-- Fin CPPA.ASSETEC.2024-->

	
	<!--Equipo Proteccion -->
	<Sql>
		<key>ListMaestroEmpresaProteccion</key>
		<query>
			select e.emprcodi||'='||trim(e.emprnomb) as emprabrev, e.emprnomb,e.emprrazsocial,te.tipoemprdesc
			from  si_empresa e left join si_tipoempresa te on e.tipoemprcodi=te.tipoemprcodi
			where e.emprsein = 'S'
			and e.emprcodi not in (0,-1)
			order by trim(e.emprnomb) asc
		</query>
	</Sql>
	
	
	<!--Equipo Proteccion Fin-->

	<!--Proyecto Actualizacion Inicio-->
	<Sql>
		<key>ObtenerEmpresaSEINProtecciones</key>
		<query>
			select empresa.emprcodi, empresa.emprnomb
			from  si_empresa empresa
			where empresa.emprsein = 'S'
			and empresa.emprcodi not in (0,-1)
			and empresa.emprestado = 'A'
			order by empresa.emprnomb asc
		</query>
	</Sql>
	<!--Proyecto Actualizacion Fin-->
  
</Sqls>
